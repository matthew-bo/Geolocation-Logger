(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[983],{21964:function(e,r,t){"use strict";t.d(r,{Z:function(){return j}});var a=t(63366),s=t(87462),n=t(67294),i=t(90512),o=t(94780),l=t(98216),d=t(90948),c=t(14136),u=t(49299),h=t(74423),p=t(49990),m=t(1588),x=t(34867);function b(e){return(0,x.ZP)("PrivateSwitchBase",e)}(0,m.Z)("PrivateSwitchBase",["root","checked","disabled","input","edgeStart","edgeEnd"]);var f=t(85893);let g=["autoFocus","checked","checkedIcon","className","defaultChecked","disabled","disableFocusRipple","edge","icon","id","inputProps","inputRef","name","onBlur","onChange","onFocus","readOnly","required","tabIndex","type","value"],v=e=>{let{classes:r,checked:t,disabled:a,edge:s}=e,n={root:["root",t&&"checked",a&&"disabled",s&&`edge${(0,l.Z)(s)}`],input:["input"]};return(0,o.Z)(n,b,r)},y=(0,d.ZP)(p.Z)(({ownerState:e})=>(0,s.Z)({padding:9,borderRadius:"50%"},"start"===e.edge&&{marginLeft:"small"===e.size?-3:-12},"end"===e.edge&&{marginRight:"small"===e.size?-3:-12})),Z=(0,d.ZP)("input",{shouldForwardProp:c.Z})({cursor:"inherit",position:"absolute",opacity:0,width:"100%",height:"100%",top:0,left:0,margin:0,padding:0,zIndex:1});var j=n.forwardRef(function(e,r){let{autoFocus:t,checked:n,checkedIcon:o,className:l,defaultChecked:d,disabled:c,disableFocusRipple:p=!1,edge:m=!1,icon:x,id:b,inputProps:j,inputRef:w,name:k,onBlur:C,onChange:P,onFocus:R,readOnly:S,required:F=!1,tabIndex:I,type:z,value:E}=e,q=(0,a.Z)(e,g),[N,L]=(0,u.Z)({controlled:n,default:!!d,name:"SwitchBase",state:"checked"}),_=(0,h.Z)(),B=c;_&&void 0===B&&(B=_.disabled);let J="checkbox"===z||"radio"===z,M=(0,s.Z)({},e,{checked:N,disabled:B,disableFocusRipple:p,edge:m}),U=v(M);return(0,f.jsxs)(y,(0,s.Z)({component:"span",className:(0,i.Z)(U.root,l),centerRipple:!0,focusRipple:!p,disabled:B,tabIndex:null,role:void 0,onFocus:e=>{R&&R(e),_&&_.onFocus&&_.onFocus(e)},onBlur:e=>{C&&C(e),_&&_.onBlur&&_.onBlur(e)},ownerState:M,ref:r},q,{children:[(0,f.jsx)(Z,(0,s.Z)({autoFocus:t,checked:n,defaultChecked:d,className:U.input,disabled:B,id:J?b:void 0,name:k,onChange:e=>{if(e.nativeEvent.defaultPrevented)return;let r=e.target.checked;L(r),P&&P(e,r)},readOnly:S,ref:w,required:F,ownerState:M,tabIndex:I,type:z},"checkbox"===z&&void 0===E?{}:{value:E},j)),N?o:x]}))})},52965:function(e,r,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/leaderboards",function(){return t(55268)}])},55268:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return el}});var a=t(85893),s=t(67294),n=t(5616),i=t(98456),o=t(93946),l=t(15861),d=t(46901),c=t(66242),u=t(69417),h=t(16628),p=t(78462),m=t(9875),x=t(59334),b=t(44732),f=t(88169),g=(0,f.Z)((0,a.jsx)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"}),"Add"),v=(0,f.Z)((0,a.jsx)("path",{d:"M10 6 8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"}),"ChevronRight"),y=t(92098),Z=t(11163),j=t(64666),w=t(37645),k=t(6514),C=t(61903),P=t(94054),R=t(33841),S=t(85945),F=t(18972),I=t(48885),z=t(63366),E=t(87462),q=t(90512),N=t(94780),L=t(2101),_=t(21964),B=(0,f.Z)((0,a.jsx)("path",{d:"M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"}),"CheckBoxOutlineBlank"),J=(0,f.Z)((0,a.jsx)("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"}),"CheckBox"),M=(0,f.Z)((0,a.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10H7v-2h10v2z"}),"IndeterminateCheckBox"),U=t(98216),O=t(28628),A=t(90948),T=t(14136),$=t(1588),H=t(34867);function G(e){return(0,H.ZP)("MuiCheckbox",e)}let W=(0,$.Z)("MuiCheckbox",["root","checked","disabled","indeterminate","colorPrimary","colorSecondary","sizeSmall","sizeMedium"]),Q=["checkedIcon","color","icon","indeterminate","indeterminateIcon","inputProps","size","className"],V=e=>{let{classes:r,indeterminate:t,color:a,size:s}=e,n={root:["root",t&&"indeterminate",`color${(0,U.Z)(a)}`,`size${(0,U.Z)(s)}`]},i=(0,N.Z)(n,G,r);return(0,E.Z)({},r,i)},Y=(0,A.ZP)(_.Z,{shouldForwardProp:e=>(0,T.Z)(e)||"classes"===e,name:"MuiCheckbox",slot:"Root",overridesResolver:(e,r)=>{let{ownerState:t}=e;return[r.root,t.indeterminate&&r.indeterminate,r[`size${(0,U.Z)(t.size)}`],"default"!==t.color&&r[`color${(0,U.Z)(t.color)}`]]}})(({theme:e,ownerState:r})=>(0,E.Z)({color:(e.vars||e).palette.text.secondary},!r.disableRipple&&{"&:hover":{backgroundColor:e.vars?`rgba(${"default"===r.color?e.vars.palette.action.activeChannel:e.vars.palette[r.color].mainChannel} / ${e.vars.palette.action.hoverOpacity})`:(0,L.Fq)("default"===r.color?e.palette.action.active:e.palette[r.color].main,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},"default"!==r.color&&{[`&.${W.checked}, &.${W.indeterminate}`]:{color:(e.vars||e).palette[r.color].main},[`&.${W.disabled}`]:{color:(e.vars||e).palette.action.disabled}})),X=(0,a.jsx)(J,{}),D=(0,a.jsx)(B,{}),K=(0,a.jsx)(M,{}),ee=s.forwardRef(function(e,r){var t,n;let i=(0,O.i)({props:e,name:"MuiCheckbox"}),{checkedIcon:o=X,color:l="primary",icon:d=D,indeterminate:c=!1,indeterminateIcon:u=K,inputProps:h,size:p="medium",className:m}=i,x=(0,z.Z)(i,Q),b=c?u:d,f=c?u:o,g=(0,E.Z)({},i,{color:l,indeterminate:c,size:p}),v=V(g);return(0,a.jsx)(Y,(0,E.Z)({type:"checkbox",inputProps:(0,E.Z)({"data-indeterminate":c},h),icon:s.cloneElement(b,{fontSize:null!=(t=b.props.fontSize)?t:p}),checkedIcon:s.cloneElement(f,{fontSize:null!=(n=f.props.fontSize)?n:p}),ownerState:g,ref:r,className:(0,q.Z)(v.root,m)},x,{classes:v}))});var er=t(31425),et=t(42498),ea=t(90109),es=t(70247);let en=[{value:"daily",label:"Daily"},{value:"weekly",label:"Weekly"},{value:"monthly",label:"Monthly"},{value:"yearly",label:"Yearly"},{value:"never",label:"Never"}];function ei(e){let{open:r,onClose:t,onGroupCreated:o}=e,{user:c}=(0,y.a)(),[h,b]=(0,s.useState)(""),[f,g]=(0,s.useState)("weekly"),[v,Z]=(0,s.useState)([]),[z,E]=(0,s.useState)([]),[q,N]=(0,s.useState)(!1),[L,_]=(0,s.useState)(null),[B,J]=(0,s.useState)(!1);(0,s.useEffect)(()=>{r&&(M(),b(""),g("weekly"),E([]),_(null))},[r]);let M=async()=>{N(!0);try{let e=await es.f.getFriends(c.uid);Z(e)}catch(e){console.error("Error fetching friends:",e),_("Failed to load friends list. Please try again.")}finally{N(!1)}},U=e=>{E(r=>r.includes(e)?r.filter(r=>r!==e):[...r,e])},O=async()=>{if(!h.trim()){_("Please enter a group name");return}if(0===z.length){_("Please select at least one friend");return}J(!0),_(null);try{let e={name:h.trim(),creatorId:c.uid,resetFrequency:f,members:[c.uid,...z],createdAt:(0,ea.Bt)(),lastReset:(0,ea.Bt)()};await (0,ea.ET)((0,ea.hJ)(et.db,"groups"),e);let r=z.map(e=>({userId:e,type:"group_add",message:"You've been added to the group \"".concat(h.trim(),'"'),read:!1,createdAt:(0,ea.Bt)()}));await Promise.all(r.map(e=>(0,ea.ET)((0,ea.hJ)(et.db,"notifications"),e))),o(),t()}catch(e){console.error("Error creating group:",e),_("Failed to create group. Please try again.")}finally{J(!1)}};return(0,a.jsxs)(j.Z,{open:r,onClose:t,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{bgcolor:"var(--background)",color:"var(--text-primary)",border:"1px solid var(--border-color)"}},children:[(0,a.jsx)(w.Z,{children:"Create New Group"}),(0,a.jsxs)(k.Z,{children:[L&&(0,a.jsx)(d.Z,{severity:"error",sx:{mb:2},children:L}),(0,a.jsx)(C.Z,{autoFocus:!0,margin:"dense",label:"Group Name",fullWidth:!0,value:h,onChange:e=>b(e.target.value),sx:{mb:2}}),(0,a.jsxs)(P.Z,{fullWidth:!0,sx:{mb:3},children:[(0,a.jsx)(R.Z,{children:"Reset Frequency"}),(0,a.jsx)(S.Z,{value:f,label:"Reset Frequency",onChange:e=>g(e.target.value),children:en.map(e=>{let{value:r,label:t}=e;return(0,a.jsx)(F.Z,{value:r,children:t},r)})})]}),(0,a.jsx)(l.Z,{variant:"subtitle1",gutterBottom:!0,children:"Select Friends"}),q?(0,a.jsx)(n.Z,{sx:{display:"flex",justifyContent:"center",py:2},children:(0,a.jsx)(i.Z,{size:24,sx:{color:"var(--beer-amber)"}})}):0===v.length?(0,a.jsx)(l.Z,{color:"var(--text-secondary)",sx:{textAlign:"center",py:2},children:"No friends found. Add some friends first!"}):(0,a.jsx)(p.Z,{sx:{maxHeight:300,overflow:"auto"},children:v.map(e=>{var r;return(0,a.jsxs)(m.ZP,{dense:!0,button:!0,onClick:()=>U(e.id),children:[(0,a.jsx)(I.Z,{children:(0,a.jsx)(ee,{edge:"start",checked:z.includes(e.id),tabIndex:-1,disableRipple:!0})}),(0,a.jsx)(x.Z,{primary:e.username||(null===(r=e.email)||void 0===r?void 0:r.split("@")[0]),secondary:e.email})]},e.id)})})]}),(0,a.jsxs)(er.Z,{children:[(0,a.jsx)(u.Z,{onClick:t,disabled:B,children:"Cancel"}),(0,a.jsx)(u.Z,{onClick:O,disabled:B||q||0===v.length,sx:{color:"var(--beer-amber)","&:hover":{bgcolor:"rgba(251, 192, 45, 0.1)"}},children:B?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i.Z,{size:20,sx:{mr:1}}),"Creating..."]}):"Create Group"})]})]})}let eo=e=>{let{delay:r,size:t,left:s}=e;return(0,a.jsx)("div",{className:"bubble",style:{width:t,height:t,left:"".concat(s,"%"),bottom:"-100px",animation:"float 3s infinite ease-in-out ".concat(r,"s"),opacity:.5*Math.random()+.1}})};function el(){let{user:e}=(0,y.a)(),r=(0,Z.useRouter)(),[t,f]=(0,s.useState)([]),[j,w]=(0,s.useState)(!0),[k,C]=(0,s.useState)(null),[P,R]=(0,s.useState)(!1),S=Array.from({length:8},(e,r)=>({id:r,size:20*Math.random()+10,left:100*Math.random(),delay:2*Math.random()}));(0,s.useEffect)(()=>{e&&F()},[e]);let F=async()=>{w(!0),C(null);try{let r=(0,ea.IO)((0,ea.hJ)(et.db,"groups"),(0,ea.ar)("members","array-contains",e.uid)),t=await (0,ea.PL)(r),a=await Promise.all(t.docs.map(async e=>{let r=e.data(),t=r.members.length;return{id:e.id,...r,memberCount:t}}));f(a)}catch(e){console.error("Error fetching groups:",e),C("Failed to load groups. Please try again.")}finally{w(!1)}},I=e=>{r.push("/leaderboards/".concat(e))};return j?(0,a.jsx)(n.Z,{sx:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,a.jsx)(i.Z,{sx:{color:"var(--beer-amber)"}})}):(0,a.jsxs)(n.Z,{sx:{minHeight:"100vh",pt:10,px:2,position:"relative",overflow:"hidden"},children:[S.map(e=>(0,a.jsx)(eo,{...e},e.id)),(0,a.jsxs)(n.Z,{sx:{maxWidth:800,mx:"auto",position:"relative",zIndex:1},children:[(0,a.jsxs)(n.Z,{sx:{textAlign:"center",mb:4},children:[(0,a.jsx)(o.Z,{sx:{width:80,height:80,mb:2,background:"var(--glass-background)","&:hover":{background:"var(--glass-background)"}},children:(0,a.jsx)(b.Z,{sx:{fontSize:40,color:"var(--beer-amber)"}})}),(0,a.jsx)(l.Z,{variant:"h4",className:"logo-text",gutterBottom:!0,children:"Leaderboards"})]}),k&&(0,a.jsx)(d.Z,{severity:"error",sx:{mb:4},children:k}),(0,a.jsx)(c.Z,{className:"glass-card",sx:{mb:4},children:(0,a.jsxs)(n.Z,{sx:{p:3},children:[(0,a.jsxs)(n.Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[(0,a.jsx)(l.Z,{variant:"h6",color:"var(--beer-amber)",children:"Your Groups"}),(0,a.jsx)(u.Z,{variant:"contained",startIcon:(0,a.jsx)(g,{}),onClick:()=>R(!0),sx:{bgcolor:"var(--beer-amber)","&:hover":{bgcolor:"var(--copper)"}},children:"Create Group"})]}),(0,a.jsx)(h.Z,{in:!0,children:(0,a.jsxs)(p.Z,{children:[t.map(e=>(0,a.jsxs)(m.ZP,{className:"glass-card",sx:{mb:2,cursor:"pointer",transition:"transform 0.2s ease-in-out","&:hover":{transform:"scale(1.02)"}},onClick:()=>I(e.id),children:[(0,a.jsx)(x.Z,{primary:e.name,secondary:"".concat(e.memberCount," members • Resets ").concat(e.resetFrequency),primaryTypographyProps:{className:"logo-text",sx:{fontSize:"1.1rem"}},secondaryTypographyProps:{sx:{color:"var(--text-secondary)"}}}),(0,a.jsx)(v,{sx:{color:"var(--beer-amber)"}})]},e.id)),0===t.length&&(0,a.jsx)(l.Z,{color:"var(--text-secondary)",sx:{textAlign:"center",fontStyle:"italic"},children:"No groups yet. Create one to start competing with friends!"})]})})]})})]}),(0,a.jsx)(ei,{open:P,onClose:()=>R(!1),onGroupCreated:F})]})}},70247:function(e,r,t){"use strict";t.d(r,{f:function(){return i}});var a=t(42498),s=t(90109);class n{async searchUsers(e,r){let t=(0,s.hJ)(a.db,"users"),n=e.toLowerCase(),i=(await (0,s.PL)(t)).docs.map(e=>({id:e.id,...e.data()})),[o,l]=await Promise.all([this.getFriends(r),this.getPendingRequests(r)]),d=new Set(o.map(e=>e.id)),c=new Set(l.map(e=>e.senderId));return i.filter(e=>{var t,a,s;return!(e.id===r||d.has(e.id)||c.has(e.id))&&((null===(t=e.username)||void 0===t?void 0:t.toLowerCase().includes(n))||(null===(a=e.email)||void 0===a?void 0:a.toLowerCase().includes(n))||(null===(s=e.displayName)||void 0===s?void 0:s.toLowerCase().includes(n))||"".concat(e.firstName," ").concat(e.lastName).toLowerCase().includes(n))})}async sendFriendRequest(e,r){if(await this.areFriends(e,r))throw Error("Users are already friends");if(await this.getExistingRequest(e,r))throw Error("A friend request already exists between these users");let t="".concat(e,"_").concat(r),n=(await (0,s.QT)((0,s.JU)(a.db,"users",e))).data();await (0,s.pl)((0,s.JU)(a.db,"friendRequests",t),{senderId:e,receiverId:r,senderUsername:n.username||n.displayName||"",senderEmail:n.email||"",senderPhotoURL:n.photoURL||"",status:"pending",createdAt:(0,s.Bt)()})}async acceptFriendRequest(e){let r=(0,s.JU)(a.db,"friendRequests",e),t=await (0,s.QT)(r);if(!t.exists())throw Error("Friend request not found");let{senderId:n,receiverId:i}=t.data(),o="".concat(n,"_").concat(i);await (0,s.pl)((0,s.JU)(a.db,"friendships",o),{user1:n,user2:i,createdAt:(0,s.Bt)()}),await (0,s.oe)(r)}async rejectFriendRequest(e){await (0,s.oe)((0,s.JU)(a.db,"friendRequests",e))}async getPendingRequests(e){try{let r=(0,s.IO)((0,s.hJ)(a.db,"friendRequests"),(0,s.ar)("receiverId","==",e),(0,s.ar)("status","==","pending"));return(await (0,s.PL)(r)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){return console.error("Error getting pending requests:",e),[]}}async getFriends(e){let r=(0,s.hJ)(a.db,"friendships"),t=(0,s.IO)(r,(0,s.or)((0,s.ar)("user1","==",e),(0,s.ar)("user2","==",e))),n=(await (0,s.PL)(t)).docs.map(e=>e.data()).map(r=>r.user1===e?r.user2:r.user1).map(e=>(0,s.QT)((0,s.JU)(a.db,"users",e)));return(await Promise.all(n)).filter(e=>e.exists()).map(e=>({id:e.id,...e.data(),isFriend:!0}))}async removeFriend(e,r){let t="".concat(e,"_").concat(r),n="".concat(r,"_").concat(e);try{await (0,s.oe)((0,s.JU)(a.db,"friendships",t))}catch(e){await (0,s.oe)((0,s.JU)(a.db,"friendships",n))}}async areFriends(e,r){try{let t="".concat(e,"_").concat(r),n="".concat(r,"_").concat(e),[i,o]=await Promise.all([(0,s.QT)((0,s.JU)(a.db,"friendships",t)),(0,s.QT)((0,s.JU)(a.db,"friendships",n))]);return i.exists()||o.exists()}catch(e){return console.error("Error checking friendship status:",e),!1}}async getSentRequests(e){try{let r=(0,s.IO)((0,s.hJ)(a.db,"friendRequests"),(0,s.ar)("senderId","==",e),(0,s.ar)("status","==","pending"));return(await (0,s.PL)(r)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){return console.error("Error getting sent requests:",e),[]}}async getExistingRequest(e,r){let t=(0,s.hJ)(a.db,"friendRequests"),n=(0,s.IO)(t,(0,s.ar)("senderId","==",e),(0,s.ar)("receiverId","==",r),(0,s.ar)("status","==","pending")),i=(0,s.IO)(t,(0,s.ar)("senderId","==",r),(0,s.ar)("receiverId","==",e),(0,s.ar)("status","==","pending")),[o,l]=await Promise.all([(0,s.PL)(n),(0,s.PL)(i)]),d=[...o.docs,...l.docs];return d.length>0?{id:d[0].id,...d[0].data()}:null}}let i=new n}},function(e){e.O(0,[903,636,969,774,888,179],function(){return e(e.s=52965)}),_N_E=e.O()}]);