(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[538],{64284:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/map",function(){return n(9994)}])},9994:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return R}});var r=n(85893),o=n(67294),a=n(5616),i=n(98456),l=n(66242),s=n(46656),d=n(65582),c=n(15861),u=n(61903),m=n(94054),p=n(85945),h=n(18972),x=n(50480),b=n(45843),g=n(69417),v=n(64666),k=n(37645),y=n(6514),f=n(58951),j=n(31425),S=n(5970),w=n(46901),Z=n(7415),C=n(50720),T=n(17389),D=n(92098),N=n(90109),I=n(42498);n(70247);var M=n(84105);let E={exportToExcel(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{if(!e||0===e.length){console.warn("No data to export");return}let n=new Date().toISOString().split("T")[0];t=t||"".concat(n,"-drink-log.xlsx");let r=e.map(e=>{var t,n,r,o,a,i;let l="N/A",s="N/A",d="N/A";if(e.timestamp){let t=new Date(1e3*e.timestamp.seconds);d=t.toISOString(),l=t.toISOString().split("T")[0],s=t.toTimeString().split(" ")[0]}let c=(null===(t=e.location)||void 0===t?void 0:t.lat)||(null===(r=e.location)||void 0===r?void 0:null===(n=r.coordinates)||void 0===n?void 0:n[1])||"N/A",u=(null===(o=e.location)||void 0===o?void 0:o.lng)||(null===(i=e.location)||void 0===i?void 0:null===(a=i.coordinates)||void 0===a?void 0:a[0])||"N/A";return{Brand:e.brand||"Unknown",Type:e.drinkType||"Unknown",Container:e.containerType||e.container||"Unknown",Amount:e.amount||"Unknown",Rating:e.rating||"N/A",Date:l,Time:s,Timestamp:d,Latitude:c,Longitude:u,Notes:e.notes||"","Added By":e.username||"Me"}}),o=M.P6.json_to_sheet(r),a=M.P6.book_new();M.P6.book_append_sheet(a,o,"Drinks");let i=(0,M.cW)(a,{bookType:"xlsx",type:"array"}),l=new Blob([i],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),s=window.URL.createObjectURL(l),d=document.createElement("a");d.href=s,d.setAttribute("download",t),document.body.appendChild(d),d.click(),document.body.removeChild(d)}catch(e){console.error("Error exporting to Excel:",e)}},exportToCsv:e=>{try{if(!e||0===e.length){console.warn("No data to export");return}let t=new Date().toISOString().split("T")[0],n=e.map(e=>{var t,n,r,o,a,i;let l="N/A",s="N/A",d="N/A";if(e.timestamp){let t=new Date(1e3*e.timestamp.seconds);d=t.toISOString(),l=t.toISOString().split("T")[0],s=t.toTimeString().split(" ")[0]}let c=(null===(t=e.location)||void 0===t?void 0:t.lat)||(null===(r=e.location)||void 0===r?void 0:null===(n=r.coordinates)||void 0===n?void 0:n[1])||"N/A",u=(null===(o=e.location)||void 0===o?void 0:o.lng)||(null===(i=e.location)||void 0===i?void 0:null===(a=i.coordinates)||void 0===a?void 0:a[0])||"N/A";return{Brand:e.brand||"Unknown",Type:e.drinkType||"Unknown",Container:e.containerType||e.container||"Unknown",Amount:e.amount||"Unknown",Rating:e.rating||"N/A",Date:l,Time:s,Timestamp:d,Latitude:c,Longitude:u,Notes:(e.notes||"").replace(/,/g," ")}}),r=Object.keys(n[0]).join(","),o=n.map(e=>Object.values(e).join(",")),a="data:text/csv;charset=utf-8,"+[r,...o].join("\n"),i=encodeURI(a),l=document.createElement("a");l.setAttribute("href",i),l.setAttribute("download","".concat(t,"-drink-log.csv")),document.body.appendChild(l),l.click(),document.body.removeChild(l)}catch(e){console.error("Error exporting to CSV:",e)}},exportToJson:e=>{try{if(!e||0===e.length){console.warn("No data to export");return}let t=new Date().toISOString().split("T")[0],n=e.map(e=>{let t=null,n=null,r=null;if(e.timestamp){let o=new Date(1e3*e.timestamp.seconds);r=o.toISOString(),t=o.toISOString().split("T")[0],n=o.toTimeString().split(" ")[0]}let o={};if(e.location){var a,i;o.lat=e.location.lat||(null===(a=e.location.coordinates)||void 0===a?void 0:a[1])||null,o.lng=e.location.lng||(null===(i=e.location.coordinates)||void 0===i?void 0:i[0])||null}return{id:e.id,brand:e.brand||null,drinkType:e.drinkType||null,containerType:e.containerType||e.container||null,amount:e.amount||null,rating:e.rating||null,date:t,time:n,timestamp:r,location:e.location?o:null,notes:e.notes||null}}),r=JSON.stringify(n,null,2),o=new Blob([r],{type:"application/json"}),a=URL.createObjectURL(o),i=document.createElement("a");i.setAttribute("href",a),i.setAttribute("download","".concat(t,"-drink-log.json")),document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(a)}catch(e){console.error("Error exporting to JSON:",e)}}};var A=n(63821),L=n(56143),O=n(39702),_=n(90948),B=n(5152);let z=n.n(B)()(()=>Promise.all([n.e(634),n.e(815),n.e(972)]).then(n.bind(n,38972)),{loadableGenerated:{webpack:()=>[38972]},ssr:!1,loading:()=>(0,r.jsx)(a.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:600,bgcolor:"#121212"},children:(0,r.jsx)(i.Z,{sx:{color:"var(--beer-amber)"}})})}),P=(0,_.ZP)(l.Z)(e=>{let{theme:t}=e;return{position:"absolute",top:100,right:20,zIndex:1,padding:t.spacing(3),width:300,background:"var(--glass-background)",backdropFilter:"blur(10px)",border:"1px solid var(--glass-border)"}});(0,_.ZP)(s.ZP)({color:"var(--beer-amber)","& .MuiSlider-thumb":{backgroundColor:"var(--beer-amber)"},"& .MuiSlider-track":{backgroundColor:"var(--beer-amber)"},"& .MuiSlider-rail":{backgroundColor:"var(--glass-border)"}});let U=e=>{let{delay:t,size:n,left:o}=e;return(0,r.jsx)("div",{className:"bubble",style:{width:n,height:n,left:"".concat(o,"%"),bottom:"-100px",animation:"float 3s infinite ease-in-out ".concat(t,"s"),opacity:.5*Math.random()+.1}})};function R(){let{user:e}=(0,D.a)(),[t,n]=(0,o.useState)([]),[l,s]=(0,o.useState)([]),[M,_]=(0,o.useState)([]),[B,R]=(0,o.useState)(!0),[F,J]=(0,o.useState)([]),[W,H]=(0,o.useState)(!0),[G,X]=(0,o.useState)(null),[V,q]=(0,o.useState)(null),[K,Q]=(0,o.useState)({drinkName:"",container:"",rating:"",startDate:null,endDate:null,timeRange:7,drinkType:"all"}),[Y,$]=(0,o.useState)(!1),[ee,et]=(0,o.useState)(null),[en,er]=(0,o.useState)(""),[eo,ea]=(0,o.useState)(!1),[ei,el]=(0,o.useState)({open:!1,message:"",severity:"success"}),[es,ed]=(0,o.useState)(!0),[ec,eu]=(0,o.useState)(""),[em,ep]=(0,o.useState)({x:0,y:0}),[eh,ex]=(0,o.useState)(!1),eb=Array.from({length:8},(e,t)=>({id:t,size:20*Math.random()+10,left:100*Math.random(),delay:2*Math.random()}));(0,o.useEffect)(()=>{e&&(async()=>{ed(!0);try{await Promise.all([eg(),ev()]),console.log("Map data loaded successfully")}catch(e){console.error("Error loading map data:",e),el({open:!0,message:"Error loading map data. Please try again.",severity:"error"})}finally{ed(!1)}})()},[e]);let eg=async()=>{try{let t=(0,N.IO)((0,N.hJ)(I.db,"drinks"),(0,N.ar)("userId","==",e.uid)),r=(await (0,N.PL)(t)).docs.map(e=>{var t;let n=e.data(),r=(null===(t=n.timestamp)||void 0===t?void 0:t.toDate)?n.timestamp.toDate():null;return{id:e.id,...n,timestamp:r}});return console.log("Fetched ".concat(r.length," drinks")),n(r),r}catch(e){throw console.error("Error fetching drinks:",e),e}},ev=async()=>{try{let t=(0,N.IO)((0,N.hJ)(I.db,"friendships"),(0,N.ar)("userId","==",e.uid)),n=(await (0,N.PL)(t)).docs.map(e=>e.data().friendId);if(n.length>0&&W){let e=n.map(async e=>{if(0===F.length||F.includes(e)){let t=(0,N.IO)((0,N.hJ)(I.db,"drinks"),(0,N.ar)("userId","==",e));return(await (0,N.PL)(t)).docs.map(t=>({id:t.id,...t.data(),friendId:e}))}return[]}),t=await Promise.all(e);_(t.flat())}else _([])}catch(e){console.error("Error fetching friends:",e)}},ek=(e,t)=>{Q(n=>({...n,[e]:t}))},ey=e=>Math.max(15,Math.min(40,2*e)),ef=e=>{let n=[...t,...M];"csv"===e?E.exportToCsv(n):"json"===e&&E.exportToJson(n)},ej=async()=>{if(ee&&en.trim()){ea(!0);try{let e={...ee.placeInfo||{},customName:en,isCustom:!0};await A.E.updateDrinkLocation(ee.id,e),n(t=>t.map(t=>t.id===ee.id?{...t,placeInfo:e}:t)),el({open:!0,message:"Location updated successfully!",severity:"success"})}catch(e){console.error("Error updating location:",e),el({open:!0,message:"Failed to update location.",severity:"error"})}finally{ea(!1),$(!1),et(null)}}},eS=e=>{let t=new Date().getHours();return ey(24)},ew=t.filter(e=>("all"===K.drinkType||e.drinkType===K.drinkType)&&(!K.startDate||!e.timestamp||!(e.timestamp<K.startDate))&&(!K.endDate||!e.timestamp||!(e.timestamp>K.endDate))),eZ=W?M.filter(e=>("all"===K.drinkType||e.drinkType===K.drinkType)&&(!K.startDate||!e.timestamp||!(e.timestamp<K.startDate))&&(!K.endDate||!e.timestamp||!(e.timestamp>K.endDate))):[];return(0,r.jsxs)(d.Z,{maxWidth:!1,disableGutters:!0,sx:{height:"calc(100vh - 64px)",mt:"64px",position:"relative",overflow:"hidden"},children:[eb.map(e=>(0,r.jsx)(U,{...e},e.id)),es?(0,r.jsx)(a.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",bgcolor:"#121212"},children:(0,r.jsx)(i.Z,{sx:{color:"var(--beer-amber)"}})}):(0,r.jsxs)(a.Z,{sx:{height:"100%",width:"100%",position:"relative",overflow:"hidden"},children:[(0,r.jsx)(z,{drinks:ew,friendDrinks:eZ,selectedDrink:G,setSelectedDrink:X,handleMouseMove:e=>{e.lngLat&&(eu(e.lngLat.lng.toFixed(4)+", "+e.lngLat.lat.toFixed(4)),ep({x:e.lngLat.lng,y:e.lngLat.lat}))},getMarkerSize:e=>eh?eS(e):24,getMarkerColor:(e,t)=>"friend"===t?"var(--friend-marker)":"var(--beer-amber)",onEditLocation:e=>{var t,n;et(e),er((null===(t=e.placeInfo)||void 0===t?void 0:t.customName)||(null===(n=e.placeInfo)||void 0===n?void 0:n.placeName)||""),$(!0)}}),V&&(0,r.jsxs)(a.Z,{sx:{position:"absolute",bottom:8,left:8,backgroundColor:"rgba(0, 0, 0, 0.7)",color:"white",padding:"4px 8px",borderRadius:1,fontSize:"0.875rem",zIndex:10},children:[V.lat,", ",V.lng]}),ec&&(0,r.jsx)(a.Z,{sx:{position:"absolute",left:em.x+10,top:em.y+10,backgroundColor:"rgba(0, 0, 0, 0.8)",color:"white",padding:1,borderRadius:1,fontSize:"0.8rem",pointerEvents:"none",zIndex:1e3,maxWidth:200},children:(0,r.jsx)(c.Z,{variant:"body2",sx:{fontSize:"0.8rem"},children:ec})}),(0,r.jsxs)(P,{children:[(0,r.jsx)(c.Z,{variant:"h6",gutterBottom:!0,children:"Map Controls"}),(0,r.jsxs)(a.Z,{sx:{mb:3},children:[(0,r.jsx)(c.Z,{variant:"subtitle2",gutterBottom:!0,color:"var(--text-secondary)",children:"Date Range"}),(0,r.jsx)(C._,{dateAdapter:Z.H,children:(0,r.jsxs)(a.Z,{sx:{display:"flex",gap:2,flexDirection:"column"},children:[(0,r.jsx)(T.M,{label:"Start Date",value:K.startDate,onChange:e=>ek("startDate",e),renderInput:e=>(0,r.jsx)(u.Z,{...e,size:"small",fullWidth:!0})}),(0,r.jsx)(T.M,{label:"End Date",value:K.endDate,onChange:e=>ek("endDate",e),renderInput:e=>(0,r.jsx)(u.Z,{...e,size:"small",fullWidth:!0})})]})})]}),(0,r.jsxs)(a.Z,{sx:{mb:3},children:[(0,r.jsx)(c.Z,{variant:"subtitle2",gutterBottom:!0,color:"var(--text-secondary)",children:"Drink Type"}),(0,r.jsx)(m.Z,{fullWidth:!0,size:"small",children:(0,r.jsxs)(p.Z,{value:K.drinkType,onChange:e=>ek("drinkType",e.target.value),displayEmpty:!0,children:[(0,r.jsx)(h.Z,{value:"all",children:"All Types"}),(0,r.jsx)(h.Z,{value:"beer",children:"Beer"}),(0,r.jsx)(h.Z,{value:"wine",children:"Wine"}),(0,r.jsx)(h.Z,{value:"cocktail",children:"Cocktail"}),(0,r.jsx)(h.Z,{value:"spirits",children:"Spirits"}),(0,r.jsx)(h.Z,{value:"other",children:"Other"})]})})]}),(0,r.jsxs)(a.Z,{sx:{mb:3},children:[(0,r.jsx)(c.Z,{variant:"subtitle2",gutterBottom:!0,color:"var(--text-secondary)",children:"Show Friends' Drinks"}),(0,r.jsx)(x.Z,{control:(0,r.jsx)(b.Z,{checked:W,onChange:e=>H(e.target.checked),sx:{"& .MuiSwitch-switchBase.Mui-checked":{color:"var(--beer-amber)"},"& .MuiSwitch-switchBase.Mui-checked + .MuiSwitch-track":{backgroundColor:"var(--beer-amber)"}}}),label:"Show Friends"})]}),(0,r.jsxs)(a.Z,{sx:{mb:3},children:[(0,r.jsx)(c.Z,{variant:"subtitle2",gutterBottom:!0,color:"var(--text-secondary)",children:"Marker Size by Hour"}),(0,r.jsx)(x.Z,{control:(0,r.jsx)(b.Z,{checked:eh,onChange:e=>ex(e.target.checked),sx:{"& .MuiSwitch-switchBase.Mui-checked":{color:"var(--beer-amber)"},"& .MuiSwitch-switchBase.Mui-checked + .MuiSwitch-track":{backgroundColor:"var(--beer-amber)"}}}),label:"Time-based Size"})]}),(0,r.jsxs)(a.Z,{sx:{display:"flex",justifyContent:"space-between",mt:2},children:[(0,r.jsx)(g.Z,{variant:"outlined",onClick:()=>{Q({drinkName:"",container:"",rating:"",startDate:null,endDate:null,timeRange:7,drinkType:"all"})},sx:{borderColor:"var(--beer-amber)",color:"var(--beer-amber)","&:hover":{borderColor:"var(--copper)",background:"rgba(255,255,255,0.03)"}},startIcon:(0,r.jsx)(L.Z,{}),children:"Clear Filters"}),(0,r.jsx)(g.Z,{variant:"outlined",onClick:()=>ef("excel"),sx:{borderColor:"var(--beer-amber)",color:"var(--beer-amber)","&:hover":{borderColor:"var(--copper)",background:"rgba(255,255,255,0.03)"}},startIcon:(0,r.jsx)(O.Z,{}),children:"Export"})]})]})]}),(0,r.jsxs)(v.Z,{open:Y,onClose:()=>!eo&&$(!1),children:[(0,r.jsx)(k.Z,{children:"Edit Location Name"}),(0,r.jsxs)(y.Z,{children:[(0,r.jsx)(f.Z,{sx:{mb:2},children:'Enter a descriptive name for this location (e.g., "Home", "Joe\'s Bar", etc.)'}),(0,r.jsx)(u.Z,{autoFocus:!0,margin:"dense",label:"Location Name",fullWidth:!0,value:en,onChange:e=>er(e.target.value),disabled:eo})]}),(0,r.jsxs)(j.Z,{children:[(0,r.jsx)(g.Z,{onClick:()=>$(!1),disabled:eo,children:"Cancel"}),(0,r.jsx)(g.Z,{onClick:ej,disabled:eo||!en.trim(),sx:{color:"var(--beer-amber)"},children:eo?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.Z,{size:20,sx:{mr:1}}),"Saving..."]}):"Save"})]})]}),(0,r.jsx)(S.Z,{open:ei.open,autoHideDuration:4e3,onClose:()=>el({...ei,open:!1}),anchorOrigin:{vertical:"top",horizontal:"center"},children:(0,r.jsx)(w.Z,{onClose:()=>el({...ei,open:!1}),severity:ei.severity,sx:{width:"100%"},children:ei.message})})]})}},20067:function(){},72061:function(){}},function(e){e.O(0,[251,903,636,846,969,869,970,468,310,904,774,888,179],function(){return e(e.s=64284)}),_N_E=e.O()}]);