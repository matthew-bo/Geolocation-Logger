"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[821],{63821:function(e,o,t){var n=t(42498),a=t(90109);let i="pk.eyJ1IjoibWJvMTE1NzAiLCJhIjoiY204Z3JuZHYxMGRqNTJucHM0cmR6MzZreCJ9.LfVRa4SdvgFmftOTn1hSwQ",l=function(e){var o,t,n,a,i,l;let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(console.log("Processing location for drink:",{id:e.id,hasLocation:!!e.location,hasPlaceInfo:!!e.placeInfo,customName:null===(o=e.placeInfo)||void 0===o?void 0:o.customName,placeName:null===(t=e.placeInfo)||void 0===t?void 0:t.placeName,address:null===(n=e.placeInfo)||void 0===n?void 0:n.address,neighborhood:null===(a=e.placeInfo)||void 0===a?void 0:a.neighborhood,city:null===(i=e.placeInfo)||void 0===i?void 0:i.city,region:null===(l=e.placeInfo)||void 0===l?void 0:l.region,coords:e.location?"".concat(e.location.lat,",").concat(e.location.lng):"none"}),!e.placeInfo)return"Unknown Location";if(e.placeInfo.address&&c[e.placeInfo.address])return c[e.placeInfo.address];if(e.placeInfo.customName)return e.placeInfo.customName;if(e.placeInfo.placeName)return e.placeInfo.placeName;if(e.placeInfo.address){let o=e.placeInfo.address;if(o.includes("(")&&o.includes(",")){if(e.placeInfo.neighborhood)return e.placeInfo.neighborhood;if(e.placeInfo.city&&e.placeInfo.region)return"".concat(e.placeInfo.city,", ").concat(e.placeInfo.region)}return e.placeInfo.country&&(o=o.replace(", ".concat(e.placeInfo.country),"")),o}return e.placeInfo.neighborhood?e.placeInfo.neighborhood:e.placeInfo.city?"".concat(e.placeInfo.city).concat(e.placeInfo.region?", ".concat(e.placeInfo.region):""):e.location&&"number"==typeof e.location.lat&&"number"==typeof e.location.lng?e.placeInfo.nearestCity?"Location near ".concat(e.placeInfo.nearestCity):e.placeInfo.region?"Location in ".concat(e.placeInfo.region):"Location at (".concat(e.location.lat.toFixed(6),", ").concat(e.location.lng.toFixed(6),")"):"Unknown Location"},c=async function(e){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{console.log("Processing ".concat(e.length," drinks for location stats"));let t={};if(o)try{let e=(0,a.JU)(n.db,"locationAliases",o),i=await (0,a.QT)(e);i.exists()&&(t=i.data().aliases||{})}catch(e){console.error("Error fetching aliases for stats:",e)}let i=e.reduce((e,o)=>{var t,n,a,i;return e.total++,o.location&&e.withLocation++,o.placeInfo&&e.withPlaceInfo++,(null===(t=o.placeInfo)||void 0===t?void 0:t.customName)&&e.withCustomName++,(null===(n=o.placeInfo)||void 0===n?void 0:n.placeName)&&e.withPlaceName++,(null===(a=o.placeInfo)||void 0===a?void 0:a.address)&&e.withAddress++,(null===(i=o.placeInfo)||void 0===i?void 0:i.city)&&e.withCity++,e},{total:0,withLocation:0,withPlaceInfo:0,withCustomName:0,withPlaceName:0,withAddress:0,withCity:0});console.log("Drink location data summary:",i);let c=e.filter(e=>{var o,t,n;return e.location&&(e.location.lat||e.location.lng||(null===(o=e.placeInfo)||void 0===o?void 0:o.placeName)||(null===(t=e.placeInfo)||void 0===t?void 0:t.address)||(null===(n=e.placeInfo)||void 0===n?void 0:n.city))});if(console.log("Found ".concat(c.length," drinks with usable location data")),0===c.length)return{topPlaces:[],visitedCities:[],visitedStates:[],visitedCountries:[]};let r={},s={},d={},u={},f={};c.forEach(e=>{var o,n,a;let i=l(e,t);if(f[i]||(f[i]={firstDrinkId:e.id,placeInfo:{...e.placeInfo},coords:e.location?{lat:e.location.lat,lng:e.location.lng}:null}),r[i]=(r[i]||0)+1,null===(o=e.placeInfo)||void 0===o?void 0:o.city){let o=e.placeInfo.city;s[o]=(s[o]||0)+1}if(null===(n=e.placeInfo)||void 0===n?void 0:n.region){let o=e.placeInfo.region;d[o]=(d[o]||0)+1}if(null===(a=e.placeInfo)||void 0===a?void 0:a.country){let o=e.placeInfo.country;u[o]=(u[o]||0)+1}}),console.log("Place name mapping:",f);let p=Object.entries(r).map(e=>{let[o,t]=e;return{name:o,count:t}}).sort((e,o)=>o.count-e.count),v=Object.entries(s).map(e=>{let[o,t]=e;return{name:o,count:t}}).sort((e,o)=>o.count-e.count),g=Object.entries(d).map(e=>{let[o,t]=e;return{name:o,count:t}}).sort((e,o)=>o.count-e.count),h=Object.entries(u).map(e=>{let[o,t]=e;return{name:o,count:t}}).sort((e,o)=>o.count-e.count);return console.log("Top places: ".concat(JSON.stringify(p.slice(0,3)))),{topPlaces:p,visitedCities:v,visitedStates:g,visitedCountries:h}}catch(e){return console.error("Error calculating location stats:",e),{topPlaces:[],visitedCities:[],visitedStates:[],visitedCountries:[]}}};o.Z={async getPlaceFromCoordinates(e){if(!e||!e.lat||!e.lng)return console.error("Invalid coordinates provided",e),null;try{var o,t,n,a,l,c,r,s,d;let u="https://api.mapbox.com/geocoding/v5/mapbox.places/".concat(e.lng,",").concat(e.lat,".json?access_token=").concat(i,"&types=poi"),f=await fetch(u),p=await f.json();if(p.features&&p.features.length>0){let e=p.features[0],i=e.place_name,c=e.text,r=(null===(o=e.properties)||void 0===o?void 0:o.category)||"unknown",s=(null===(t=p.features.find(e=>e.place_type.includes("neighborhood")))||void 0===t?void 0:t.text)||"",d=(null===(n=p.features.find(e=>e.place_type.includes("place")))||void 0===n?void 0:n.text)||"",u=(null===(a=p.features.find(e=>e.place_type.includes("region")))||void 0===a?void 0:a.text)||"",f=(null===(l=p.features.find(e=>e.place_type.includes("country")))||void 0===l?void 0:l.text)||"";return{placeName:c,placeType:r,address:i,neighborhood:s,city:d,region:u,country:f,isAutomaticallyGenerated:!0}}let v="https://api.mapbox.com/geocoding/v5/mapbox.places/".concat(e.lng,",").concat(e.lat,".json?access_token=").concat(i),g=await fetch(v),h=await g.json();if(h.features&&h.features.length>0){let e=h.features[0].place_name,o=(null===(c=h.features.find(e=>e.place_type.includes("neighborhood")))||void 0===c?void 0:c.text)||"",t=(null===(r=h.features.find(e=>e.place_type.includes("place")))||void 0===r?void 0:r.text)||"",n=(null===(s=h.features.find(e=>e.place_type.includes("region")))||void 0===s?void 0:s.text)||"",a=(null===(d=h.features.find(e=>e.place_type.includes("country")))||void 0===d?void 0:d.text)||"";return{placeName:"Unknown Location",placeType:"location",address:e,neighborhood:o,city:t,region:n,country:a,isAutomaticallyGenerated:!0}}return null}catch(e){return console.error("Error getting place info from coordinates:",e),null}},async updateDrinkLocation(e,o){try{if(!e)return!1;let t=(0,a.JU)(n.db,"drinks",e);return await (0,a.r7)(t,{placeInfo:o}),!0}catch(e){return console.error("Error updating drink location:",e),!1}},async getLocationStats(e){try{return{topPlaces:[],visitedCities:[],visitedCountries:[]}}catch(e){return console.error("Error getting location stats:",e),null}},getDisplayNameForLocation:l,getLocationStats:c,async getUserLocationAliases(e){try{let o=(0,a.JU)(n.db,"locationAliases",e),t=await (0,a.QT)(o);if(!t.exists())return{};return t.data().aliases||{}}catch(e){return console.error("Error fetching location aliases:",e),{}}},async setLocationAlias(e,o,t){try{if(!o||t.length>40)return!1;let i=(0,a.JU)(n.db,"locationAliases",e),l=await (0,a.QT)(i),c=l.exists()&&l.data().aliases||{};return c[o]=t,await (0,a.pl)(i,{aliases:c,updatedAt:new Date},{merge:!0}),!0}catch(e){return console.error("Error setting location alias:",e),!1}},async removeLocationAlias(e,o){try{let t=(0,a.JU)(n.db,"locationAliases",e),i=await (0,a.QT)(t);if(!i.exists())return!0;let l=i.data().aliases||{};return delete l[o],await (0,a.pl)(t,{aliases:l,updatedAt:new Date},{merge:!0}),!0}catch(e){return console.error("Error removing location alias:",e),!1}},async getLocationDisplayName(e,o){if(!o)return"Unknown Location";let t=o.address;if(!t)return o.neighborhood?"".concat(o.neighborhood,", ").concat(o.city):"Unknown Location";try{let o=(0,a.JU)(n.db,"locationAliases",e),i=await (0,a.QT)(o);if(i.exists()){let e=i.data().aliases||{};if(e[t])return e[t]}}catch(e){console.error("Error getting location alias:",e)}return t}}}}]);