"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[904],{70247:function(e,t,o){o.d(t,{f:function(){return r}});var n=o(42498),a=o(90109);class i{async searchUsers(e,t){let o=(0,a.hJ)(n.db,"users"),i=e.toLowerCase(),r=(await (0,a.PL)(o)).docs.map(e=>({id:e.id,...e.data()})),[c,l]=await Promise.all([this.getFriends(t),this.getPendingRequests(t)]),s=new Set(c.map(e=>e.id)),d=new Set(l.map(e=>e.senderId));return r.filter(e=>{var o,n,a;return!(e.id===t||s.has(e.id)||d.has(e.id))&&((null===(o=e.username)||void 0===o?void 0:o.toLowerCase().includes(i))||(null===(n=e.email)||void 0===n?void 0:n.toLowerCase().includes(i))||(null===(a=e.displayName)||void 0===a?void 0:a.toLowerCase().includes(i))||"".concat(e.firstName," ").concat(e.lastName).toLowerCase().includes(i))})}async sendFriendRequest(e,t){if(await this.areFriends(e,t))throw Error("Users are already friends");if(await this.getExistingRequest(e,t))throw Error("A friend request already exists between these users");let o="".concat(e,"_").concat(t),i=(await (0,a.QT)((0,a.JU)(n.db,"users",e))).data();await (0,a.pl)((0,a.JU)(n.db,"friendRequests",o),{senderId:e,receiverId:t,senderUsername:i.username||i.displayName||"",senderEmail:i.email||"",senderPhotoURL:i.photoURL||"",status:"pending",createdAt:(0,a.Bt)()})}async acceptFriendRequest(e){let t=(0,a.JU)(n.db,"friendRequests",e),o=await (0,a.QT)(t);if(!o.exists())throw Error("Friend request not found");let{senderId:i,receiverId:r}=o.data(),c="".concat(i,"_").concat(r);await (0,a.pl)((0,a.JU)(n.db,"friendships",c),{user1:i,user2:r,createdAt:(0,a.Bt)()}),await (0,a.oe)(t)}async rejectFriendRequest(e){await (0,a.oe)((0,a.JU)(n.db,"friendRequests",e))}async getPendingRequests(e){try{let t=(0,a.IO)((0,a.hJ)(n.db,"friendRequests"),(0,a.ar)("receiverId","==",e),(0,a.ar)("status","==","pending"));return(await (0,a.PL)(t)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){return console.error("Error getting pending requests:",e),[]}}async getFriends(e){let t=(0,a.hJ)(n.db,"friendships"),o=(0,a.IO)(t,(0,a.or)((0,a.ar)("user1","==",e),(0,a.ar)("user2","==",e))),i=(await (0,a.PL)(o)).docs.map(e=>e.data()).map(t=>t.user1===e?t.user2:t.user1).map(e=>(0,a.QT)((0,a.JU)(n.db,"users",e)));return(await Promise.all(i)).filter(e=>e.exists()).map(e=>({id:e.id,...e.data(),isFriend:!0}))}async removeFriend(e,t){let o="".concat(e,"_").concat(t),i="".concat(t,"_").concat(e);try{await (0,a.oe)((0,a.JU)(n.db,"friendships",o))}catch(e){await (0,a.oe)((0,a.JU)(n.db,"friendships",i))}}async areFriends(e,t){try{let o="".concat(e,"_").concat(t),i="".concat(t,"_").concat(e),[r,c]=await Promise.all([(0,a.QT)((0,a.JU)(n.db,"friendships",o)),(0,a.QT)((0,a.JU)(n.db,"friendships",i))]);return r.exists()||c.exists()}catch(e){return console.error("Error checking friendship status:",e),!1}}async getSentRequests(e){try{let t=(0,a.IO)((0,a.hJ)(n.db,"friendRequests"),(0,a.ar)("senderId","==",e),(0,a.ar)("status","==","pending"));return(await (0,a.PL)(t)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){return console.error("Error getting sent requests:",e),[]}}async getExistingRequest(e,t){let o=(0,a.hJ)(n.db,"friendRequests"),i=(0,a.IO)(o,(0,a.ar)("senderId","==",e),(0,a.ar)("receiverId","==",t),(0,a.ar)("status","==","pending")),r=(0,a.IO)(o,(0,a.ar)("senderId","==",t),(0,a.ar)("receiverId","==",e),(0,a.ar)("status","==","pending")),[c,l]=await Promise.all([(0,a.PL)(i),(0,a.PL)(r)]),s=[...c.docs,...l.docs];return s.length>0?{id:s[0].id,...s[0].data()}:null}}let r=new i},63821:function(e,t,o){o.d(t,{E:function(){return c}});var n=o(42498),a=o(90109);let i="pk.eyJ1IjoibWJvMTE1NzAiLCJhIjoiY204MmgxZjBuMHh2cjJrb3F3NmlyOXJjNSJ9.9XPT8wv6gvv6axeoIl7wPQ",r=e=>{var t,o,n,a,i,r,c,l,s,d,u,p,f,v,g,h,m;if(console.log("Processing location for drink:",{id:e.id,hasLocation:!!e.location,hasPlaceInfo:!!e.placeInfo,customName:null===(t=e.placeInfo)||void 0===t?void 0:t.customName,placeName:null===(o=e.placeInfo)||void 0===o?void 0:o.placeName,address:null===(n=e.placeInfo)||void 0===n?void 0:n.address,neighborhood:null===(a=e.placeInfo)||void 0===a?void 0:a.neighborhood,city:null===(i=e.placeInfo)||void 0===i?void 0:i.city,region:null===(r=e.placeInfo)||void 0===r?void 0:r.region,coords:e.location?"".concat(e.location.lat,",").concat(e.location.lng):"none"}),null===(c=e.placeInfo)||void 0===c?void 0:c.customName)return e.placeInfo.customName;if(null===(l=e.placeInfo)||void 0===l?void 0:l.placeName)return e.placeInfo.placeName;if(null===(s=e.placeInfo)||void 0===s?void 0:s.address){let t=e.placeInfo.address;if(t.includes("(")&&t.includes(",")){if(null===(f=e.placeInfo)||void 0===f?void 0:f.neighborhood)return e.placeInfo.neighborhood;if((null===(v=e.placeInfo)||void 0===v?void 0:v.city)&&(null===(g=e.placeInfo)||void 0===g?void 0:g.region))return"".concat(e.placeInfo.city,", ").concat(e.placeInfo.region)}return(null===(p=e.placeInfo)||void 0===p?void 0:p.country)&&(t=t.replace(", ".concat(e.placeInfo.country),"")),t}return(null===(d=e.placeInfo)||void 0===d?void 0:d.neighborhood)?e.placeInfo.neighborhood:(null===(u=e.placeInfo)||void 0===u?void 0:u.city)?"".concat(e.placeInfo.city).concat(e.placeInfo.region?", ".concat(e.placeInfo.region):""):e.location&&"number"==typeof e.location.lat&&"number"==typeof e.location.lng?(null===(h=e.placeInfo)||void 0===h?void 0:h.nearestCity)?"Location near ".concat(e.placeInfo.nearestCity):(null===(m=e.placeInfo)||void 0===m?void 0:m.region)?"Location in ".concat(e.placeInfo.region):"Location at (".concat(e.location.lat.toFixed(6),", ").concat(e.location.lng.toFixed(6),")"):"Unknown Location"},c={async getPlaceFromCoordinates(e){if(!e||!e.lat||!e.lng)return console.error("Invalid coordinates provided",e),null;try{var t,o,n,a,r,c,l,s,d;let u="https://api.mapbox.com/geocoding/v5/mapbox.places/".concat(e.lng,",").concat(e.lat,".json?access_token=").concat(i,"&types=poi"),p=await fetch(u),f=await p.json();if(f.features&&f.features.length>0){let e=f.features[0],i=e.place_name,c=e.text,l=(null===(t=e.properties)||void 0===t?void 0:t.category)||"unknown",s=(null===(o=f.features.find(e=>e.place_type.includes("neighborhood")))||void 0===o?void 0:o.text)||"",d=(null===(n=f.features.find(e=>e.place_type.includes("place")))||void 0===n?void 0:n.text)||"",u=(null===(a=f.features.find(e=>e.place_type.includes("region")))||void 0===a?void 0:a.text)||"",p=(null===(r=f.features.find(e=>e.place_type.includes("country")))||void 0===r?void 0:r.text)||"";return{placeName:c,placeType:l,address:i,neighborhood:s,city:d,region:u,country:p,isAutomaticallyGenerated:!0}}let v="https://api.mapbox.com/geocoding/v5/mapbox.places/".concat(e.lng,",").concat(e.lat,".json?access_token=").concat(i),g=await fetch(v),h=await g.json();if(h.features&&h.features.length>0){let e=h.features[0].place_name,t=(null===(c=h.features.find(e=>e.place_type.includes("neighborhood")))||void 0===c?void 0:c.text)||"",o=(null===(l=h.features.find(e=>e.place_type.includes("place")))||void 0===l?void 0:l.text)||"",n=(null===(s=h.features.find(e=>e.place_type.includes("region")))||void 0===s?void 0:s.text)||"",a=(null===(d=h.features.find(e=>e.place_type.includes("country")))||void 0===d?void 0:d.text)||"";return{placeName:"Unknown Location",placeType:"location",address:e,neighborhood:t,city:o,region:n,country:a,isAutomaticallyGenerated:!0}}return null}catch(e){return console.error("Error getting place info from coordinates:",e),null}},async updateDrinkLocation(e,t){try{if(!e)return!1;let o=(0,a.JU)(n.db,"drinks",e);return await (0,a.r7)(o,{placeInfo:t}),!0}catch(e){return console.error("Error updating drink location:",e),!1}},async getLocationStats(e){try{return{topPlaces:[],visitedCities:[],visitedCountries:[]}}catch(e){return console.error("Error getting location stats:",e),null}},getDisplayNameForLocation:r,getLocationStats:e=>{try{console.log("Processing ".concat(e.length," drinks for location stats"));let t=e.reduce((e,t)=>{var o,n,a,i;return e.total++,t.location&&e.withLocation++,t.placeInfo&&e.withPlaceInfo++,(null===(o=t.placeInfo)||void 0===o?void 0:o.customName)&&e.withCustomName++,(null===(n=t.placeInfo)||void 0===n?void 0:n.placeName)&&e.withPlaceName++,(null===(a=t.placeInfo)||void 0===a?void 0:a.address)&&e.withAddress++,(null===(i=t.placeInfo)||void 0===i?void 0:i.city)&&e.withCity++,e},{total:0,withLocation:0,withPlaceInfo:0,withCustomName:0,withPlaceName:0,withAddress:0,withCity:0});console.log("Drink location data summary:",t);let o=e.filter(e=>{var t,o,n;return e.location&&(e.location.lat||e.location.lng||(null===(t=e.placeInfo)||void 0===t?void 0:t.placeName)||(null===(o=e.placeInfo)||void 0===o?void 0:o.address)||(null===(n=e.placeInfo)||void 0===n?void 0:n.city))});if(console.log("Found ".concat(o.length," drinks with usable location data")),0===o.length)return{topPlaces:[],visitedCities:[],visitedStates:[],visitedCountries:[]};let n={},a={},i={},c={},l={};o.forEach(e=>{var t,o,s;let d=r(e);if(l[d]||(l[d]={firstDrinkId:e.id,placeInfo:{...e.placeInfo},coords:e.location?{lat:e.location.lat,lng:e.location.lng}:null}),n[d]=(n[d]||0)+1,null===(t=e.placeInfo)||void 0===t?void 0:t.city){let t=e.placeInfo.city;a[t]=(a[t]||0)+1}if(null===(o=e.placeInfo)||void 0===o?void 0:o.region){let t=e.placeInfo.region;i[t]=(i[t]||0)+1}if(null===(s=e.placeInfo)||void 0===s?void 0:s.country){let t=e.placeInfo.country;c[t]=(c[t]||0)+1}}),console.log("Place name mapping:",l);let s=Object.entries(n).map(e=>{let[t,o]=e;return{name:t,count:o}}).sort((e,t)=>t.count-e.count),d=Object.entries(a).map(e=>{let[t,o]=e;return{name:t,count:o}}).sort((e,t)=>t.count-e.count),u=Object.entries(i).map(e=>{let[t,o]=e;return{name:t,count:o}}).sort((e,t)=>t.count-e.count),p=Object.entries(c).map(e=>{let[t,o]=e;return{name:t,count:o}}).sort((e,t)=>t.count-e.count);return console.log("Top places: ".concat(JSON.stringify(s.slice(0,3)))),{topPlaces:s,visitedCities:d,visitedStates:u,visitedCountries:p}}catch(e){return console.error("Error calculating location stats:",e),{topPlaces:[],visitedCities:[],visitedStates:[],visitedCountries:[]}}}}}}]);