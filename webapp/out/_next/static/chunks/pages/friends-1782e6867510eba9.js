(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[128],{69661:function(e,r,t){"use strict";t.d(r,{Z:function(){return w}});var o=t(63366),s=t(87462),a=t(67294),n=t(90512),i=t(94780),d=t(90948),l=t(28628),c=t(88169),u=t(85893),m=(0,c.Z)((0,u.jsx)("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"}),"Person"),p=t(1588),h=t(34867);function v(e){return(0,h.ZP)("MuiAvatar",e)}(0,p.Z)("MuiAvatar",["root","colorDefault","circular","rounded","square","img","fallback"]);var f=t(80560);let x=["alt","children","className","component","slots","slotProps","imgProps","sizes","src","srcSet","variant"],g=e=>{let{classes:r,variant:t,colorDefault:o}=e;return(0,i.Z)({root:["root",t,o&&"colorDefault"],img:["img"],fallback:["fallback"]},v,r)},b=(0,d.ZP)("div",{name:"MuiAvatar",slot:"Root",overridesResolver:(e,r)=>{let{ownerState:t}=e;return[r.root,r[t.variant],t.colorDefault&&r.colorDefault]}})(({theme:e})=>({position:"relative",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,width:40,height:40,fontFamily:e.typography.fontFamily,fontSize:e.typography.pxToRem(20),lineHeight:1,borderRadius:"50%",overflow:"hidden",userSelect:"none",variants:[{props:{variant:"rounded"},style:{borderRadius:(e.vars||e).shape.borderRadius}},{props:{variant:"square"},style:{borderRadius:0}},{props:{colorDefault:!0},style:(0,s.Z)({color:(e.vars||e).palette.background.default},e.vars?{backgroundColor:e.vars.palette.Avatar.defaultBg}:(0,s.Z)({backgroundColor:e.palette.grey[400]},e.applyStyles("dark",{backgroundColor:e.palette.grey[600]})))}]})),y=(0,d.ZP)("img",{name:"MuiAvatar",slot:"Img",overridesResolver:(e,r)=>r.img})({width:"100%",height:"100%",textAlign:"center",objectFit:"cover",color:"transparent",textIndent:1e4}),Z=(0,d.ZP)(m,{name:"MuiAvatar",slot:"Fallback",overridesResolver:(e,r)=>r.fallback})({width:"75%",height:"75%"});var w=a.forwardRef(function(e,r){let t=(0,l.i)({props:e,name:"MuiAvatar"}),{alt:i,children:d,className:c,component:m="div",slots:p={},slotProps:h={},imgProps:v,sizes:w,src:j,srcSet:P,variant:C="circular"}=t,R=(0,o.Z)(t,x),k=null,q=function({crossOrigin:e,referrerPolicy:r,src:t,srcSet:o}){let[s,n]=a.useState(!1);return a.useEffect(()=>{if(!t&&!o)return;n(!1);let s=!0,a=new Image;return a.onload=()=>{s&&n("loaded")},a.onerror=()=>{s&&n("error")},a.crossOrigin=e,a.referrerPolicy=r,a.src=t,o&&(a.srcset=o),()=>{s=!1}},[e,r,t,o]),s}((0,s.Z)({},v,{src:j,srcSet:P})),N=j||P,S=N&&"error"!==q,L=(0,s.Z)({},t,{colorDefault:!S,component:m,variant:C}),U=g(L),[F,A]=(0,f.Z)("img",{className:U.img,elementType:y,externalForwardedProps:{slots:p,slotProps:{img:(0,s.Z)({},v,h.img)}},additionalProps:{alt:i,src:j,srcSet:P,sizes:w},ownerState:L});return k=S?(0,u.jsx)(F,(0,s.Z)({},A)):d||0===d?d:N&&i?i[0]:(0,u.jsx)(Z,{ownerState:L,className:U.fallback}),(0,u.jsx)(b,(0,s.Z)({as:m,ownerState:L,className:(0,n.Z)(U.root,c),ref:r},R,{children:k}))})},66242:function(e,r,t){"use strict";t.d(r,{Z:function(){return g}});var o=t(87462),s=t(63366),a=t(67294),n=t(90512),i=t(94780),d=t(90948),l=t(28628),c=t(90629),u=t(1588),m=t(34867);function p(e){return(0,m.ZP)("MuiCard",e)}(0,u.Z)("MuiCard",["root"]);var h=t(85893);let v=["className","raised"],f=e=>{let{classes:r}=e;return(0,i.Z)({root:["root"]},p,r)},x=(0,d.ZP)(c.Z,{name:"MuiCard",slot:"Root",overridesResolver:(e,r)=>r.root})(()=>({overflow:"hidden"}));var g=a.forwardRef(function(e,r){let t=(0,l.i)({props:e,name:"MuiCard"}),{className:a,raised:i=!1}=t,d=(0,s.Z)(t,v),c=(0,o.Z)({},t,{raised:i}),u=f(c);return(0,h.jsx)(x,(0,o.Z)({className:(0,n.Z)(u.root,a),elevation:i?8:void 0,ref:r,ownerState:c},d))})},80560:function(e,r,t){"use strict";t.d(r,{Z:function(){return m}});var o=t(87462),s=t(63366),a=t(33703),n=t(86542),i=t(65610),d=t(55120);let l=["className","elementType","ownerState","externalForwardedProps","getSlotOwnerState","internalForwardedProps"],c=["component","slots","slotProps"],u=["component"];function m(e,r){let{className:t,elementType:m,ownerState:p,externalForwardedProps:h,getSlotOwnerState:v,internalForwardedProps:f}=r,x=(0,s.Z)(r,l),{component:g,slots:b={[e]:void 0},slotProps:y={[e]:void 0}}=h,Z=(0,s.Z)(h,c),w=b[e]||m,j=(0,i.Z)(y[e],p),P=(0,d.Z)((0,o.Z)({className:t},x,{externalForwardedProps:"root"===e?Z:void 0,externalSlotProps:j})),{props:{component:C},internalRef:R}=P,k=(0,s.Z)(P.props,u),q=(0,a.Z)(R,null==j?void 0:j.ref,r.ref),N=v?v(k):{},S=(0,o.Z)({},p,N),L="root"===e?C||g:C,U=(0,n.Z)(w,(0,o.Z)({},"root"===e&&!g&&!b[e]&&f,"root"!==e&&!b[e]&&f,k,L&&{as:L},{ref:q}),S);return Object.keys(N).forEach(e=>{delete U[e]}),[w,U]}},11057:function(e,r,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/friends",function(){return t(96876)}])},96876:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return S}});var o=t(85893),s=t(67294),a=t(5616),n=t(93946),i=t(15861),d=t(66242),l=t(79136),c=t(40044),u=t(78462),m=t(9875),p=t(69661),h=t(59334),v=t(93395),f=t(61903),x=t(88169),g=(0,x.Z)((0,o.jsx)("path",{d:"M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3m-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3m0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5m8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5"}),"Group"),b=t(46761),y=(0,x.Z)((0,o.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"}),"Search"),Z=t(67462),w=(0,x.Z)((0,o.jsx)("path",{d:"M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"}),"Check"),j=(0,x.Z)((0,o.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close"),P=t(92098),C=t(70247),R=t(90109),k=t(42498),q=t(11163);let N=e=>{let{delay:r,size:t,left:s}=e;return(0,o.jsx)("div",{className:"bubble",style:{width:t,height:t,left:"".concat(s,"%"),bottom:"-100px",animation:"float 3s infinite ease-in-out ".concat(r,"s"),opacity:.5*Math.random()+.1}})};function S(){let{user:e}=(0,P.a)(),r=(0,q.useRouter)(),[t,x]=(0,s.useState)(""),[S,L]=(0,s.useState)([]),[U,F]=(0,s.useState)([]),[A,M]=(0,s.useState)([]),[E,I]=(0,s.useState)(0),[B,_]=(0,s.useState)(!1),J=Array.from({length:8},(e,r)=>({id:r,size:20*Math.random()+10,left:100*Math.random(),delay:2*Math.random()}));(0,s.useEffect)(()=>{e&&(T(),O())},[e]);let T=async()=>{try{let r=await C.f.getFriends(e.uid);F(r)}catch(e){console.error("Error fetching friends:",e)}},O=async()=>{try{let r=await C.f.getPendingRequests(e.uid);M(r)}catch(e){console.error("Error fetching requests:",e)}},z=async()=>{if(!(t.length<2)){_(!0);try{console.log("Searching for:",t,"with user ID:",null==e?void 0:e.uid);let r=(0,R.hJ)(k.db,"users"),o=await (0,R.PL)(r),s=t.toLowerCase().trim().replace(/\s+/g," "),a=o.docs.map(e=>({id:e.id,...e.data()})).filter(r=>{if(r.id===(null==e?void 0:e.uid))return!1;let t=(r.username||"").toLowerCase().trim().replace(/\s+/g," "),o=(r.email||"").toLowerCase().trim(),a=(r.displayName||"").toLowerCase().trim().replace(/\s+/g," "),n=(r.firstName||"").toLowerCase().trim().replace(/\s+/g," "),i=(r.lastName||"").toLowerCase().trim().replace(/\s+/g," ");return s.split(" ").every(e=>t.includes(e)||o.includes(e)||a.includes(e)||n.includes(e)||i.includes(e))});console.log("Found users:",a),L(a)}catch(e){console.error("Error searching users:",e)}finally{_(!1)}}};(0,s.useEffect)(()=>{if(t.length>=2){let e=setTimeout(()=>{z()},300);return()=>clearTimeout(e)}L([])},[t]);let D=async r=>{try{await C.f.sendFriendRequest(e.uid,r),L(e=>e.filter(e=>e.id!==r))}catch(e){console.error("Error sending friend request:",e)}},Q=async e=>{try{await C.f.acceptFriendRequest(e),M(r=>r.filter(r=>r.id!==e)),T()}catch(e){console.error("Error accepting friend request:",e)}},W=async e=>{try{await C.f.rejectFriendRequest(e),M(r=>r.filter(r=>r.id!==e))}catch(e){console.error("Error rejecting friend request:",e)}},H=async r=>{try{await C.f.removeFriend(e.uid,r),F(e=>e.filter(e=>e.id!==r))}catch(e){console.error("Error removing friend:",e)}},V=e=>{r.push("/profile?userId=".concat(e))};return(0,o.jsxs)(a.Z,{sx:{minHeight:"100vh",pt:10,px:2,position:"relative",overflow:"hidden"},children:[J.map(e=>(0,o.jsx)(N,{...e},e.id)),(0,o.jsxs)(a.Z,{sx:{maxWidth:800,mx:"auto",position:"relative",zIndex:1},children:[(0,o.jsxs)(a.Z,{sx:{textAlign:"center",mb:4},children:[(0,o.jsx)(n.Z,{sx:{width:80,height:80,mb:2,background:"var(--glass-background)","&:hover":{background:"var(--glass-background)"}},children:(0,o.jsx)(g,{sx:{fontSize:40,color:"var(--beer-amber)"}})}),(0,o.jsx)(i.Z,{variant:"h4",className:"logo-text",gutterBottom:!0,children:"Beer Buddies"})]}),(0,o.jsxs)(d.Z,{className:"glass-card",sx:{mb:4},children:[(0,o.jsxs)(l.Z,{value:E,onChange:(e,r)=>I(r),variant:"fullWidth",sx:{borderBottom:"1px solid var(--glass-border)","& .MuiTab-root":{color:"var(--text-secondary)","&.Mui-selected":{color:"var(--beer-amber)"}},"& .MuiTabs-indicator":{backgroundColor:"var(--beer-amber)"}},children:[(0,o.jsx)(c.Z,{label:"My Friends"}),(0,o.jsx)(c.Z,{label:"Add Friends"}),(0,o.jsx)(c.Z,{label:"Requests (".concat(A.length,")")})]}),(0,o.jsxs)(a.Z,{sx:{p:3},children:[0===E&&(0,o.jsxs)(u.Z,{children:[U.map(e=>{var r,t,s,a;return(0,o.jsxs)(m.ZP,{button:!0,onClick:()=>V(e.id),sx:{borderBottom:"1px solid var(--border-color)","&:last-child":{borderBottom:"none"}},children:[(0,o.jsx)(p.Z,{src:e.photoURL,sx:{mr:2,bgcolor:"var(--beer-amber)"},children:(null===(t=e.username)||void 0===t?void 0:null===(r=t[0])||void 0===r?void 0:r.toUpperCase())||(null===(a=e.displayName)||void 0===a?void 0:null===(s=a[0])||void 0===s?void 0:s.toUpperCase())||"?"}),(0,o.jsx)(h.Z,{primary:e.username||e.displayName||"Anonymous Beer Lover"}),(0,o.jsx)(v.Z,{children:(0,o.jsx)(n.Z,{edge:"end",onClick:r=>{r.stopPropagation(),H(e.id)},sx:{color:"var(--text-secondary)"},children:(0,o.jsx)(b.Z,{})})})]},e.id)}),0===U.length&&(0,o.jsx)(m.ZP,{children:(0,o.jsx)(h.Z,{primary:"No friends yet",secondary:"Add some friends to see their beer journey!",sx:{textAlign:"center",color:"var(--text-secondary)"}})})]}),1===E&&(0,o.jsxs)(a.Z,{sx:{p:2},children:[(0,o.jsx)(f.Z,{fullWidth:!0,variant:"outlined",placeholder:"Search users by username",value:t,onChange:e=>x(e.target.value),InputProps:{startAdornment:(0,o.jsx)(y,{sx:{mr:1,color:"var(--text-secondary)"}})},sx:{mb:2,"& .MuiOutlinedInput-root":{"& fieldset":{borderColor:"var(--border-color)"},"&:hover fieldset":{borderColor:"var(--beer-amber)"},"&.Mui-focused fieldset":{borderColor:"var(--beer-amber)"}}}}),(0,o.jsxs)(u.Z,{children:[U.map(e=>{var r,t,s,a;return(0,o.jsxs)(m.ZP,{button:!0,onClick:()=>V(e.id),sx:{borderBottom:"1px solid var(--border-color)","&:last-child":{borderBottom:"none"}},children:[(0,o.jsx)(p.Z,{src:e.photoURL,sx:{mr:2,bgcolor:"var(--beer-amber)"},children:(null===(t=e.username)||void 0===t?void 0:null===(r=t[0])||void 0===r?void 0:r.toUpperCase())||(null===(a=e.displayName)||void 0===a?void 0:null===(s=a[0])||void 0===s?void 0:s.toUpperCase())||"?"}),(0,o.jsx)(h.Z,{primary:e.username||e.displayName||"Anonymous Beer Lover"}),(0,o.jsx)(v.Z,{children:(0,o.jsx)(n.Z,{edge:"end",onClick:r=>{r.stopPropagation(),H(e.id)},sx:{color:"var(--text-secondary)"},children:(0,o.jsx)(b.Z,{})})})]},e.id)}),0===U.length&&(0,o.jsx)(m.ZP,{children:(0,o.jsx)(h.Z,{primary:"No friends yet",secondary:"Add some friends to see their beer journey!",sx:{textAlign:"center",color:"var(--text-secondary)"}})})]}),(0,o.jsx)(u.Z,{children:S.map(e=>{var r,t,s,a;return(0,o.jsxs)(m.ZP,{sx:{borderBottom:"1px solid var(--border-color)","&:last-child":{borderBottom:"none"}},children:[(0,o.jsx)(p.Z,{src:e.photoURL,sx:{mr:2,bgcolor:"var(--beer-amber)"},children:(null===(t=e.username)||void 0===t?void 0:null===(r=t[0])||void 0===r?void 0:r.toUpperCase())||(null===(a=e.displayName)||void 0===a?void 0:null===(s=a[0])||void 0===s?void 0:s.toUpperCase())||"?"}),(0,o.jsx)(h.Z,{primary:e.username||e.displayName||"Anonymous Beer Lover"}),(0,o.jsx)(v.Z,{children:(0,o.jsx)(n.Z,{edge:"end",onClick:()=>D(e.id),sx:{color:"var(--beer-amber)"},children:(0,o.jsx)(Z.Z,{})})})]},e.id)})})]}),2===E&&(0,o.jsxs)(u.Z,{children:[A.map(e=>{var r,t;return(0,o.jsxs)(m.ZP,{sx:{borderBottom:"1px solid var(--border-color)","&:last-child":{borderBottom:"none"}},children:[(0,o.jsx)(p.Z,{src:e.senderPhotoURL,sx:{mr:2,bgcolor:"var(--beer-amber)"},children:(null===(t=e.senderUsername)||void 0===t?void 0:null===(r=t[0])||void 0===r?void 0:r.toUpperCase())||"?"}),(0,o.jsx)(h.Z,{primary:e.senderUsername||"Anonymous Beer Lover",secondary:e.createdAt?new Date(1e3*e.createdAt.seconds).toLocaleString():""}),(0,o.jsxs)(v.Z,{children:[(0,o.jsx)(n.Z,{edge:"end",onClick:()=>Q(e.id),sx:{color:"var(--beer-amber)",mr:1},children:(0,o.jsx)(w,{})}),(0,o.jsx)(n.Z,{edge:"end",onClick:()=>W(e.id),sx:{color:"var(--text-secondary)"},children:(0,o.jsx)(j,{})})]})]},e.id)}),0===A.length&&(0,o.jsx)(m.ZP,{children:(0,o.jsx)(h.Z,{primary:"No pending requests",secondary:"Friend requests will appear here",sx:{textAlign:"center",color:"var(--text-secondary)"}})})]})]})]})]})]})}},70247:function(e,r,t){"use strict";t.d(r,{f:function(){return n}});var o=t(42498),s=t(90109);class a{async searchUsers(e,r){let t=(0,s.hJ)(o.db,"users"),a=e.toLowerCase(),n=(await (0,s.PL)(t)).docs.map(e=>({id:e.id,...e.data()})),[i,d]=await Promise.all([this.getFriends(r),this.getPendingRequests(r)]),l=new Set(i.map(e=>e.id)),c=new Set(d.map(e=>e.senderId));return n.filter(e=>{var t,o;return!(e.id===r||l.has(e.id)||c.has(e.id))&&((null===(t=e.username)||void 0===t?void 0:t.toLowerCase().includes(a))||(null===(o=e.displayName)||void 0===o?void 0:o.toLowerCase().includes(a))||"".concat(e.firstName," ").concat(e.lastName).toLowerCase().includes(a))})}async sendFriendRequest(e,r){if(await this.areFriends(e,r))throw Error("Users are already friends");if(await this.getExistingRequest(e,r))throw Error("A friend request already exists between these users");let t="".concat(e,"_").concat(r),a=(await (0,s.QT)((0,s.JU)(o.db,"users",e))).data();await (0,s.pl)((0,s.JU)(o.db,"friendRequests",t),{senderId:e,receiverId:r,senderUsername:a.username||a.displayName||"",senderPhotoURL:a.photoURL||"",status:"pending",createdAt:(0,s.Bt)()})}async acceptFriendRequest(e){let r=(0,s.JU)(o.db,"friendRequests",e),t=await (0,s.QT)(r);if(!t.exists())throw Error("Friend request not found");let{senderId:a,receiverId:n}=t.data(),i="".concat(a,"_").concat(n);await (0,s.pl)((0,s.JU)(o.db,"friendships",i),{user1:a,user2:n,createdAt:(0,s.Bt)()}),await (0,s.oe)(r)}async rejectFriendRequest(e){await (0,s.oe)((0,s.JU)(o.db,"friendRequests",e))}async getPendingRequests(e){try{let r=(0,s.IO)((0,s.hJ)(o.db,"friendRequests"),(0,s.ar)("receiverId","==",e),(0,s.ar)("status","==","pending"));return(await (0,s.PL)(r)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){return console.error("Error getting pending requests:",e),[]}}async getFriends(e){let r=(0,s.hJ)(o.db,"friendships"),t=(0,s.IO)(r,(0,s.or)((0,s.ar)("user1","==",e),(0,s.ar)("user2","==",e))),a=(await (0,s.PL)(t)).docs.map(e=>e.data()).map(r=>r.user1===e?r.user2:r.user1).map(e=>(0,s.QT)((0,s.JU)(o.db,"users",e)));return(await Promise.all(a)).filter(e=>e.exists()).map(e=>({id:e.id,...e.data(),isFriend:!0}))}async removeFriend(e,r){let t="".concat(e,"_").concat(r),a="".concat(r,"_").concat(e);try{await (0,s.oe)((0,s.JU)(o.db,"friendships",t))}catch(e){await (0,s.oe)((0,s.JU)(o.db,"friendships",a))}}async areFriends(e,r){try{let t="".concat(e,"_").concat(r),a="".concat(r,"_").concat(e),[n,i]=await Promise.all([(0,s.QT)((0,s.JU)(o.db,"friendships",t)),(0,s.QT)((0,s.JU)(o.db,"friendships",a))]);return n.exists()||i.exists()}catch(e){return console.error("Error checking friendship status:",e),!1}}async getSentRequests(e){try{let r=(0,s.IO)((0,s.hJ)(o.db,"friendRequests"),(0,s.ar)("senderId","==",e),(0,s.ar)("status","==","pending"));return(await (0,s.PL)(r)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){return console.error("Error getting sent requests:",e),[]}}async getExistingRequest(e,r){let t=(0,s.hJ)(o.db,"friendRequests"),a=(0,s.IO)(t,(0,s.ar)("senderId","==",e),(0,s.ar)("receiverId","==",r),(0,s.ar)("status","==","pending")),n=(0,s.IO)(t,(0,s.ar)("senderId","==",r),(0,s.ar)("receiverId","==",e),(0,s.ar)("status","==","pending")),[i,d]=await Promise.all([(0,s.PL)(a),(0,s.PL)(n)]),l=[...i.docs,...d.docs];return l.length>0?{id:l[0].id,...l[0].data()}:null}}let n=new a}},function(e){e.O(0,[903,218,774,888,179],function(){return e(e.s=11057)}),_N_E=e.O()}]);