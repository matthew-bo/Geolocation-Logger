(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[983],{52965:function(e,r,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/leaderboards",function(){return t(84987)}])},84987:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return A}});var a=t(85893),s=t(67294),n=t(5616),i=t(98456),o=t(93946),l=t(15861),d=t(46901),c=t(66242),u=t(69417),h=t(16628),m=t(78462),x=t(9875),p=t(59334),g=t(44732),b=t(72428),y=t(78046),f=t(92098),v=t(11163),j=t(64666),w=t(37645),Z=t(6514),P=t(61903),C=t(94054),R=t(33841),q=t(85945),k=t(18972),E=t(48885),F=t(69368),I=t(31425),N=t(42498),_=t(90109),J=t(70247);let S=[{value:"daily",label:"Daily"},{value:"weekly",label:"Weekly"},{value:"monthly",label:"Monthly"},{value:"yearly",label:"Yearly"},{value:"never",label:"Never"}];function L(e){let{open:r,onClose:t,onGroupCreated:o}=e,{user:c}=(0,f.a)(),[h,g]=(0,s.useState)(""),[b,y]=(0,s.useState)("weekly"),[v,L]=(0,s.useState)([]),[U,A]=(0,s.useState)([]),[T,O]=(0,s.useState)(!1),[B,z]=(0,s.useState)(null),[G,W]=(0,s.useState)(!1);(0,s.useEffect)(()=>{r&&(M(),g(""),y("weekly"),A([]),z(null))},[r]);let M=async()=>{O(!0);try{let e=await J.f.getFriends(c.uid);L(e)}catch(e){console.error("Error fetching friends:",e),z("Failed to load friends list. Please try again.")}finally{O(!1)}},Q=e=>{A(r=>r.includes(e)?r.filter(r=>r!==e):[...r,e])},H=async()=>{if(!h.trim()){z("Please enter a group name");return}if(0===U.length){z("Please select at least one friend");return}W(!0),z(null);try{let e={name:h.trim(),creatorId:c.uid,resetFrequency:b,members:[c.uid,...U],createdAt:(0,_.Bt)(),lastReset:(0,_.Bt)()};await (0,_.ET)((0,_.hJ)(N.db,"groups"),e);let r=U.map(e=>({userId:e,type:"group_add",message:"You've been added to the group \"".concat(h.trim(),'"'),read:!1,createdAt:(0,_.Bt)()}));await Promise.all(r.map(e=>(0,_.ET)((0,_.hJ)(N.db,"notifications"),e))),o(),t()}catch(e){console.error("Error creating group:",e),z("Failed to create group. Please try again.")}finally{W(!1)}};return(0,a.jsxs)(j.Z,{open:r,onClose:t,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{bgcolor:"var(--background)",color:"var(--text-primary)",border:"1px solid var(--border-color)"}},children:[(0,a.jsx)(w.Z,{children:"Create New Group"}),(0,a.jsxs)(Z.Z,{children:[B&&(0,a.jsx)(d.Z,{severity:"error",sx:{mb:2},children:B}),(0,a.jsx)(P.Z,{autoFocus:!0,margin:"dense",label:"Group Name",fullWidth:!0,value:h,onChange:e=>g(e.target.value),inputProps:{maxLength:50,pattern:"[A-Za-z0-9 -]*",title:"Only letters, numbers, spaces, and hyphens are allowed"},helperText:"".concat(h.length,"/50"),sx:{mb:2}}),(0,a.jsxs)(C.Z,{fullWidth:!0,sx:{mb:3},children:[(0,a.jsx)(R.Z,{children:"Reset Frequency"}),(0,a.jsx)(q.Z,{value:b,label:"Reset Frequency",onChange:e=>y(e.target.value),children:S.map(e=>{let{value:r,label:t}=e;return(0,a.jsx)(k.Z,{value:r,children:t},r)})})]}),(0,a.jsx)(l.Z,{variant:"subtitle1",gutterBottom:!0,children:"Select Friends"}),T?(0,a.jsx)(n.Z,{sx:{display:"flex",justifyContent:"center",py:2},children:(0,a.jsx)(i.Z,{size:24,sx:{color:"var(--beer-amber)"}})}):0===v.length?(0,a.jsx)(l.Z,{color:"var(--text-secondary)",sx:{textAlign:"center",py:2},children:"No friends found. Add some friends first!"}):(0,a.jsx)(m.Z,{sx:{maxHeight:300,overflow:"auto"},children:v.map(e=>(0,a.jsxs)(x.ZP,{dense:!0,button:!0,onClick:()=>Q(e.id),children:[(0,a.jsx)(E.Z,{children:(0,a.jsx)(F.Z,{edge:"start",checked:U.includes(e.id),tabIndex:-1,disableRipple:!0})}),(0,a.jsx)(p.Z,{primary:e.username||e.displayName||"Anonymous Beer Lover"})]},e.id))})]}),(0,a.jsxs)(I.Z,{children:[(0,a.jsx)(u.Z,{onClick:t,disabled:G,children:"Cancel"}),(0,a.jsx)(u.Z,{onClick:H,disabled:G||T||0===v.length,sx:{color:"var(--beer-amber)","&:hover":{bgcolor:"rgba(251, 192, 45, 0.1)"}},children:G?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i.Z,{size:20,sx:{mr:1}}),"Creating..."]}):"Create Group"})]})]})}let U=e=>{let{delay:r,size:t,left:s}=e;return(0,a.jsx)("div",{className:"bubble",style:{width:t,height:t,left:"".concat(s,"%"),bottom:"-100px",animation:"float 3s infinite ease-in-out ".concat(r,"s"),opacity:.5*Math.random()+.1}})};function A(){let{user:e}=(0,f.a)(),r=(0,v.useRouter)(),[t,j]=(0,s.useState)([]),[w,Z]=(0,s.useState)(!0),[P,C]=(0,s.useState)(null),[R,q]=(0,s.useState)(!1),k=Array.from({length:8},(e,r)=>({id:r,size:20*Math.random()+10,left:100*Math.random(),delay:2*Math.random()}));(0,s.useEffect)(()=>{e&&E()},[e]);let E=async()=>{Z(!0),C(null);try{let r=(0,_.IO)((0,_.hJ)(N.db,"groups"),(0,_.ar)("members","array-contains",e.uid)),t=await (0,_.PL)(r),a=await Promise.all(t.docs.map(async e=>{let r=e.data(),t=r.members.length;return{id:e.id,...r,memberCount:t}}));j(a)}catch(e){console.error("Error fetching groups:",e),C("Failed to load groups. Please try again.")}finally{Z(!1)}},F=e=>{r.push("/leaderboards/".concat(e))};return w?(0,a.jsx)(n.Z,{sx:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,a.jsx)(i.Z,{sx:{color:"var(--beer-amber)"}})}):(0,a.jsxs)(n.Z,{sx:{minHeight:"100vh",pt:10,px:2,position:"relative",overflow:"hidden"},children:[k.map(e=>(0,a.jsx)(U,{...e},e.id)),(0,a.jsxs)(n.Z,{sx:{maxWidth:800,mx:"auto",position:"relative",zIndex:1},children:[(0,a.jsxs)(n.Z,{sx:{textAlign:"center",mb:4},children:[(0,a.jsx)(o.Z,{sx:{width:80,height:80,mb:2,background:"var(--glass-background)","&:hover":{background:"var(--glass-background)"}},children:(0,a.jsx)(g.Z,{sx:{fontSize:40,color:"var(--beer-amber)"}})}),(0,a.jsx)(l.Z,{variant:"h4",className:"logo-text",gutterBottom:!0,children:"Leaderboards"})]}),P&&(0,a.jsx)(d.Z,{severity:"error",sx:{mb:4},children:P}),(0,a.jsx)(c.Z,{className:"glass-card",sx:{mb:4},children:(0,a.jsxs)(n.Z,{sx:{p:3},children:[(0,a.jsxs)(n.Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[(0,a.jsx)(l.Z,{variant:"h6",color:"var(--beer-amber)",children:"Your Groups"}),(0,a.jsx)(u.Z,{variant:"contained",startIcon:(0,a.jsx)(b.Z,{}),onClick:()=>q(!0),sx:{bgcolor:"var(--beer-amber)","&:hover":{bgcolor:"var(--copper)"}},children:"Create Group"})]}),(0,a.jsx)(h.Z,{in:!0,children:(0,a.jsxs)(m.Z,{children:[t.map(e=>(0,a.jsxs)(x.ZP,{className:"glass-card",sx:{mb:2,cursor:"pointer",transition:"transform 0.2s ease-in-out","&:hover":{transform:"scale(1.02)"}},onClick:()=>F(e.id),children:[(0,a.jsx)(p.Z,{primary:e.name,secondary:"".concat(e.memberCount," members â€¢ Resets ").concat(e.resetFrequency),primaryTypographyProps:{className:"logo-text",sx:{fontSize:"1.1rem"}},secondaryTypographyProps:{sx:{color:"var(--text-secondary)"}}}),(0,a.jsx)(y.Z,{sx:{color:"var(--beer-amber)"}})]},e.id)),0===t.length&&(0,a.jsx)(l.Z,{color:"var(--text-secondary)",sx:{textAlign:"center",fontStyle:"italic"},children:"No groups yet. Create one to start competing with friends!"})]})})]})})]}),(0,a.jsx)(L,{open:R,onClose:()=>q(!1),onGroupCreated:E})]})}},70247:function(e,r,t){"use strict";t.d(r,{f:function(){return i}});var a=t(42498),s=t(90109);class n{async searchUsers(e,r){let t=(0,s.hJ)(a.db,"users"),n=e.toLowerCase(),i=(await (0,s.PL)(t)).docs.map(e=>({id:e.id,...e.data()})),[o,l]=await Promise.all([this.getFriends(r),this.getPendingRequests(r)]),d=new Set(o.map(e=>e.id)),c=new Set(l.map(e=>e.senderId));return i.filter(e=>{var t,a;return!(e.id===r||d.has(e.id)||c.has(e.id))&&((null===(t=e.username)||void 0===t?void 0:t.toLowerCase().includes(n))||(null===(a=e.displayName)||void 0===a?void 0:a.toLowerCase().includes(n))||"".concat(e.firstName," ").concat(e.lastName).toLowerCase().includes(n))})}async sendFriendRequest(e,r){if(await this.areFriends(e,r))throw Error("Users are already friends");if(await this.getExistingRequest(e,r))throw Error("A friend request already exists between these users");let t="".concat(e,"_").concat(r),n=(await (0,s.QT)((0,s.JU)(a.db,"users",e))).data();await (0,s.pl)((0,s.JU)(a.db,"friendRequests",t),{senderId:e,receiverId:r,senderUsername:n.username||n.displayName||"",senderPhotoURL:n.photoURL||"",status:"pending",createdAt:(0,s.Bt)()})}async acceptFriendRequest(e){let r=(0,s.JU)(a.db,"friendRequests",e),t=await (0,s.QT)(r);if(!t.exists())throw Error("Friend request not found");let{senderId:n,receiverId:i}=t.data(),o="".concat(n,"_").concat(i);await (0,s.pl)((0,s.JU)(a.db,"friendships",o),{user1:n,user2:i,createdAt:(0,s.Bt)()}),await (0,s.oe)(r)}async rejectFriendRequest(e){await (0,s.oe)((0,s.JU)(a.db,"friendRequests",e))}async getPendingRequests(e){try{let r=(0,s.IO)((0,s.hJ)(a.db,"friendRequests"),(0,s.ar)("receiverId","==",e),(0,s.ar)("status","==","pending"));return(await (0,s.PL)(r)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){return console.error("Error getting pending requests:",e),[]}}async getFriends(e){let r=(0,s.hJ)(a.db,"friendships"),t=(0,s.IO)(r,(0,s.or)((0,s.ar)("user1","==",e),(0,s.ar)("user2","==",e))),n=(await (0,s.PL)(t)).docs.map(e=>e.data()).map(r=>r.user1===e?r.user2:r.user1).map(e=>(0,s.QT)((0,s.JU)(a.db,"users",e)));return(await Promise.all(n)).filter(e=>e.exists()).map(e=>({id:e.id,...e.data(),isFriend:!0}))}async removeFriend(e,r){let t="".concat(e,"_").concat(r),n="".concat(r,"_").concat(e);try{await (0,s.oe)((0,s.JU)(a.db,"friendships",t))}catch(e){await (0,s.oe)((0,s.JU)(a.db,"friendships",n))}}async areFriends(e,r){try{let t="".concat(e,"_").concat(r),n="".concat(r,"_").concat(e),[i,o]=await Promise.all([(0,s.QT)((0,s.JU)(a.db,"friendships",t)),(0,s.QT)((0,s.JU)(a.db,"friendships",n))]);return i.exists()||o.exists()}catch(e){return console.error("Error checking friendship status:",e),!1}}async getSentRequests(e){try{let r=(0,s.IO)((0,s.hJ)(a.db,"friendRequests"),(0,s.ar)("senderId","==",e),(0,s.ar)("status","==","pending"));return(await (0,s.PL)(r)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){return console.error("Error getting sent requests:",e),[]}}async getExistingRequest(e,r){let t=(0,s.hJ)(a.db,"friendRequests"),n=(0,s.IO)(t,(0,s.ar)("senderId","==",e),(0,s.ar)("receiverId","==",r),(0,s.ar)("status","==","pending")),i=(0,s.IO)(t,(0,s.ar)("senderId","==",r),(0,s.ar)("receiverId","==",e),(0,s.ar)("status","==","pending")),[o,l]=await Promise.all([(0,s.PL)(n),(0,s.PL)(i)]),d=[...o.docs,...l.docs];return d.length>0?{id:d[0].id,...d[0].data()}:null}}let i=new n}},function(e){e.O(0,[903,699,739,17,774,888,179],function(){return e(e.s=52965)}),_N_E=e.O()}]);