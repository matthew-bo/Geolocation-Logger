(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[983],{52965:function(e,r,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/leaderboards",function(){return t(84987)}])},84987:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return z}});var s=t(85893),a=t(67294),n=t(5616),i=t(98456),o=t(93946),l=t(15861),d=t(46901),c=t(69417),u=t(66242),h=t(16628),x=t(78462),m=t(9875),p=t(59334),g=t(14354),b=t(44732),y=t(72456),f=t(72428),v=t(78046),j=t(92098),w=t(11163),Z=t(64666),C=t(37645),P=t(6514),R=t(61903),k=t(94054),F=t(33841),q=t(85945),I=t(18972),S=t(48885),E=t(69368),N=t(31425),_=t(42498),J=t(90109),L=t(70247);let U=[{value:"daily",label:"Daily"},{value:"weekly",label:"Weekly"},{value:"monthly",label:"Monthly"},{value:"yearly",label:"Yearly"},{value:"never",label:"Never"}];function A(e){let{open:r,onClose:t,onGroupCreated:o}=e,{user:u}=(0,j.a)(),[h,g]=(0,a.useState)(""),[b,y]=(0,a.useState)("weekly"),[f,v]=(0,a.useState)([]),[w,A]=(0,a.useState)([]),[T,z]=(0,a.useState)(!1),[O,B]=(0,a.useState)(null),[G,W]=(0,a.useState)(!1);(0,a.useEffect)(()=>{r&&(M(),g(""),y("weekly"),A([]),B(null))},[r]);let M=async()=>{z(!0);try{let e=await L.f.getFriends(u.uid);v(e)}catch(e){console.error("Error fetching friends:",e),B("Failed to load friends list. Please try again.")}finally{z(!1)}},Q=e=>{A(r=>r.includes(e)?r.filter(r=>r!==e):[...r,e])},H=async()=>{if(!h.trim()){B("Please enter a group name");return}if(0===w.length){B("Please select at least one friend");return}W(!0),B(null);try{let e={name:h.trim(),creatorId:u.uid,resetFrequency:b,members:[u.uid,...w],createdAt:(0,J.Bt)(),lastReset:(0,J.Bt)()};await (0,J.ET)((0,J.hJ)(_.db,"groups"),e);let r=w.map(e=>({userId:e,type:"group_add",message:"You've been added to the group \"".concat(h.trim(),'"'),read:!1,createdAt:(0,J.Bt)()}));await Promise.all(r.map(e=>(0,J.ET)((0,J.hJ)(_.db,"notifications"),e))),o(),t()}catch(e){console.error("Error creating group:",e),B("Failed to create group. Please try again.")}finally{W(!1)}};return(0,s.jsxs)(Z.Z,{open:r,onClose:t,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{bgcolor:"var(--background)",color:"var(--text-primary)",border:"1px solid var(--border-color)"}},children:[(0,s.jsx)(C.Z,{children:"Create New Group"}),(0,s.jsxs)(P.Z,{children:[O&&(0,s.jsx)(d.Z,{severity:"error",sx:{mb:2},children:O}),(0,s.jsx)(R.Z,{autoFocus:!0,margin:"dense",label:"Group Name",fullWidth:!0,value:h,onChange:e=>g(e.target.value),inputProps:{maxLength:50,pattern:"[A-Za-z0-9 -]*",title:"Only letters, numbers, spaces, and hyphens are allowed"},helperText:"".concat(h.length,"/50"),sx:{mb:2}}),(0,s.jsxs)(k.Z,{fullWidth:!0,sx:{mb:3},children:[(0,s.jsx)(F.Z,{children:"Reset Frequency"}),(0,s.jsx)(q.Z,{value:b,label:"Reset Frequency",onChange:e=>y(e.target.value),children:U.map(e=>{let{value:r,label:t}=e;return(0,s.jsx)(I.Z,{value:r,children:t},r)})})]}),(0,s.jsx)(l.Z,{variant:"subtitle1",gutterBottom:!0,children:"Select Friends"}),T?(0,s.jsx)(n.Z,{sx:{display:"flex",justifyContent:"center",py:2},children:(0,s.jsx)(i.Z,{size:24,sx:{color:"var(--beer-amber)"}})}):0===f.length?(0,s.jsx)(l.Z,{color:"var(--text-secondary)",sx:{textAlign:"center",py:2},children:"No friends found. Add some friends first!"}):(0,s.jsx)(x.Z,{sx:{maxHeight:300,overflow:"auto"},children:f.map(e=>(0,s.jsxs)(m.ZP,{dense:!0,button:!0,onClick:()=>Q(e.id),children:[(0,s.jsx)(S.Z,{children:(0,s.jsx)(E.Z,{edge:"start",checked:w.includes(e.id),tabIndex:-1,disableRipple:!0})}),(0,s.jsx)(p.Z,{primary:e.username||e.displayName||"Anonymous Beer Lover"})]},e.id))})]}),(0,s.jsxs)(N.Z,{children:[(0,s.jsx)(c.Z,{onClick:t,disabled:G,children:"Cancel"}),(0,s.jsx)(c.Z,{onClick:H,disabled:G||T||0===f.length,sx:{color:"var(--beer-amber)","&:hover":{bgcolor:"rgba(251, 192, 45, 0.1)"}},children:G?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.Z,{size:20,sx:{mr:1}}),"Creating..."]}):"Create Group"})]})]})}let T=e=>{let{delay:r,size:t,left:a}=e;return(0,s.jsx)("div",{className:"bubble",style:{width:t,height:t,left:"".concat(a,"%"),bottom:"-100px",animation:"float 3s infinite ease-in-out ".concat(r,"s"),opacity:.5*Math.random()+.1}})};function z(){let{user:e}=(0,j.a)(),r=(0,w.useRouter)(),[t,Z]=(0,a.useState)([]),[C,P]=(0,a.useState)(!0),[R,k]=(0,a.useState)(null),[F,q]=(0,a.useState)(!1),[I,S]=(0,a.useState)(!1),[E,N]=(0,a.useState)(""),[L,U]=(0,a.useState)(!1),z=Array.from({length:8},(e,r)=>({id:r,size:20*Math.random()+10,left:100*Math.random(),delay:2*Math.random()}));(0,a.useEffect)(()=>{e&&O()},[e]);let O=async()=>{P(!0),k(null);try{let r=(0,J.IO)((0,J.hJ)(_.db,"groups"),(0,J.ar)("members","array-contains",e.uid)),t=await (0,J.PL)(r),s=await Promise.all(t.docs.map(async e=>{let r=e.data(),t=r.members.length;return{id:e.id,...r,memberCount:t}}));Z(s)}catch(e){console.error("Error fetching groups:",e),k("Failed to load groups. Please try again.")}finally{P(!1)}},B=e=>{r.push("/leaderboards/".concat(e))},G=async()=>{U(!0),await O(),U(!1),N("Groups refreshed successfully"),S(!0)},W=async()=>{q(!1),await O(),N("Group created successfully"),S(!0)};return C?(0,s.jsx)(n.Z,{sx:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"var(--background)"},children:(0,s.jsx)(i.Z,{sx:{color:"var(--beer-amber)"}})}):(0,s.jsxs)(n.Z,{sx:{minHeight:"100vh",pt:10,px:2,position:"relative",overflow:"hidden"},children:[z.map(e=>(0,s.jsx)(T,{...e},e.id)),(0,s.jsxs)(n.Z,{sx:{maxWidth:800,mx:"auto",position:"relative",zIndex:1},children:[(0,s.jsxs)(n.Z,{sx:{textAlign:"center",mb:4},children:[(0,s.jsx)(o.Z,{sx:{width:80,height:80,mb:2,background:"var(--glass-background)","&:hover":{background:"var(--glass-background)"}},children:(0,s.jsx)(b.Z,{sx:{fontSize:40,color:"var(--beer-amber)"}})}),(0,s.jsx)(l.Z,{variant:"h4",className:"logo-text",gutterBottom:!0,children:"Leaderboards"})]}),R&&(0,s.jsx)(d.Z,{severity:"error",sx:{mb:4},action:(0,s.jsx)(c.Z,{color:"inherit",size:"small",onClick:O,startIcon:(0,s.jsx)(y.Z,{}),children:"Retry"}),children:R}),(0,s.jsx)(u.Z,{className:"glass-card",sx:{mb:4},children:(0,s.jsxs)(n.Z,{sx:{p:3},children:[(0,s.jsxs)(n.Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[(0,s.jsx)(l.Z,{variant:"h6",color:"var(--beer-amber)",children:"Your Groups"}),(0,s.jsxs)(n.Z,{sx:{display:"flex",gap:1},children:[(0,s.jsx)(c.Z,{variant:"outlined",onClick:G,disabled:L,sx:{borderColor:"var(--beer-amber)",color:"var(--beer-amber)","&:hover":{borderColor:"var(--copper)"}},children:L?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.Z,{size:20,sx:{mr:1}}),"Refreshing..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(y.Z,{sx:{mr:1}}),"Refresh"]})}),(0,s.jsx)(c.Z,{variant:"contained",startIcon:(0,s.jsx)(f.Z,{}),onClick:()=>q(!0),sx:{bgcolor:"var(--beer-amber)","&:hover":{bgcolor:"var(--copper)"}},children:"Create Group"})]})]}),(0,s.jsx)(h.Z,{in:!0,children:(0,s.jsxs)(x.Z,{children:[t.map(e=>(0,s.jsxs)(m.ZP,{className:"glass-card",sx:{mb:2,cursor:"pointer",transition:"transform 0.2s ease-in-out","&:hover":{transform:"scale(1.02)"}},onClick:()=>B(e.id),children:[(0,s.jsx)(p.Z,{primary:e.name,secondary:"".concat(e.memberCount," members â€¢ Resets ").concat(e.resetFrequency),primaryTypographyProps:{className:"logo-text",sx:{fontSize:"1.1rem"}},secondaryTypographyProps:{sx:{color:"var(--text-secondary)"}}}),(0,s.jsx)(v.Z,{sx:{color:"var(--beer-amber)"}})]},e.id)),0===t.length&&(0,s.jsx)(l.Z,{color:"var(--text-secondary)",sx:{textAlign:"center",fontStyle:"italic"},children:"No groups yet. Create one to start competing with friends!"})]})})]})})]}),(0,s.jsx)(A,{open:F,onClose:()=>q(!1),onGroupCreated:W}),(0,s.jsx)(g.Z,{open:I,autoHideDuration:3e3,onClose:()=>S(!1),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:(0,s.jsx)(d.Z,{onClose:()=>S(!1),severity:"success",sx:{width:"100%"},children:E})})]})}},70247:function(e,r,t){"use strict";t.d(r,{f:function(){return i}});var s=t(42498),a=t(90109);class n{async searchUsers(e,r){let t=(0,a.hJ)(s.db,"users"),n=e.toLowerCase(),i=(await (0,a.PL)(t)).docs.map(e=>({id:e.id,...e.data()})),[o,l]=await Promise.all([this.getFriends(r),this.getPendingRequests(r)]),d=new Set(o.map(e=>e.id)),c=new Set(l.map(e=>e.senderId));return i.filter(e=>{var t,s;return!(e.id===r||d.has(e.id)||c.has(e.id))&&((null===(t=e.username)||void 0===t?void 0:t.toLowerCase().includes(n))||(null===(s=e.displayName)||void 0===s?void 0:s.toLowerCase().includes(n))||"".concat(e.firstName," ").concat(e.lastName).toLowerCase().includes(n))})}async sendFriendRequest(e,r){if(await this.areFriends(e,r))throw Error("Users are already friends");if(await this.getExistingRequest(e,r))throw Error("A friend request already exists between these users");let t="".concat(e,"_").concat(r),n=(await (0,a.QT)((0,a.JU)(s.db,"users",e))).data();await (0,a.pl)((0,a.JU)(s.db,"friendRequests",t),{senderId:e,receiverId:r,senderUsername:n.username||n.displayName||"",senderPhotoURL:n.photoURL||"",status:"pending",createdAt:(0,a.Bt)()})}async acceptFriendRequest(e){let r=(0,a.JU)(s.db,"friendRequests",e),t=await (0,a.QT)(r);if(!t.exists())throw Error("Friend request not found");let{senderId:n,receiverId:i}=t.data(),o="".concat(n,"_").concat(i);await (0,a.pl)((0,a.JU)(s.db,"friendships",o),{user1:n,user2:i,createdAt:(0,a.Bt)()}),await (0,a.oe)(r)}async rejectFriendRequest(e){await (0,a.oe)((0,a.JU)(s.db,"friendRequests",e))}async getPendingRequests(e){try{let r=(0,a.IO)((0,a.hJ)(s.db,"friendRequests"),(0,a.ar)("receiverId","==",e),(0,a.ar)("status","==","pending"));return(await (0,a.PL)(r)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){return console.error("Error getting pending requests:",e),[]}}async getFriends(e){let r=(0,a.hJ)(s.db,"friendships"),t=(0,a.IO)(r,(0,a.or)((0,a.ar)("user1","==",e),(0,a.ar)("user2","==",e))),n=(await (0,a.PL)(t)).docs.map(e=>e.data()).map(r=>r.user1===e?r.user2:r.user1).map(e=>(0,a.QT)((0,a.JU)(s.db,"users",e)));return(await Promise.all(n)).filter(e=>e.exists()).map(e=>({id:e.id,...e.data(),isFriend:!0}))}async removeFriend(e,r){let t="".concat(e,"_").concat(r),n="".concat(r,"_").concat(e);try{await (0,a.oe)((0,a.JU)(s.db,"friendships",t))}catch(e){await (0,a.oe)((0,a.JU)(s.db,"friendships",n))}}async areFriends(e,r){try{let t="".concat(e,"_").concat(r),n="".concat(r,"_").concat(e),[i,o]=await Promise.all([(0,a.QT)((0,a.JU)(s.db,"friendships",t)),(0,a.QT)((0,a.JU)(s.db,"friendships",n))]);return i.exists()||o.exists()}catch(e){return console.error("Error checking friendship status:",e),!1}}async getSentRequests(e){try{let r=(0,a.IO)((0,a.hJ)(s.db,"friendRequests"),(0,a.ar)("senderId","==",e),(0,a.ar)("status","==","pending"));return(await (0,a.PL)(r)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){return console.error("Error getting sent requests:",e),[]}}async getExistingRequest(e,r){let t=(0,a.hJ)(s.db,"friendRequests"),n=(0,a.IO)(t,(0,a.ar)("senderId","==",e),(0,a.ar)("receiverId","==",r),(0,a.ar)("status","==","pending")),i=(0,a.IO)(t,(0,a.ar)("senderId","==",r),(0,a.ar)("receiverId","==",e),(0,a.ar)("status","==","pending")),[o,l]=await Promise.all([(0,a.PL)(n),(0,a.PL)(i)]),d=[...o.docs,...l.docs];return d.length>0?{id:d[0].id,...d[0].data()}:null}}let i=new n}},function(e){e.O(0,[903,354,969,975,774,888,179],function(){return e(e.s=52965)}),_N_E=e.O()}]);