(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[300],{4582:function(e,r,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/leaderboards/[groupId]",function(){return t(72462)}])},72462:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return V}});var a=t(85893),s=t(67294),n=t(2734),o=t(61730),l=t(5616),i=t(98456),d=t(46901),c=t(69417),x=t(93946),u=t(15861),h=t(34386),g=t(72882),b=t(90629),m=t(7906),p=t(53184),v=t(53816),y=t(53252),j=t(295),f=t(66242),Z=t(87918),w=t(64666),k=t(37645),D=t(6514),C=t(61903),I=t(94054),S=t(33841),P=t(85945),B=t(18972),F=t(31425),R=t(94669),T=t(25683),q=t(44732),E=t(67462),L=t(40),W=t(46761),M=t(13761),J=t(92098),U=t(11163),_=t(42498),N=t(90109),A=t(70247),O=t(13488);let z=[{value:"unique_beers",label:"Unique Beers",description:"First to try X different beers"},{value:"total_beers",label:"Total Beers",description:"First to log X total beers"},{value:"streak",label:"Longest Streak",description:"Maintain the longest daily logging streak"}];function G(e){var r;let{open:t,onClose:n,group:o,onChallengeCreated:x}=e,[h,g]=(0,s.useState)(""),[b,m]=(0,s.useState)(""),[p,v]=(0,s.useState)(""),[y,j]=(0,s.useState)(null),[f,Z]=(0,s.useState)(!1),[R,T]=(0,s.useState)(null),q=async()=>{if(!h.trim()){T("Please enter a challenge name");return}if(!b){T("Please select a challenge type");return}if(!y){T("Please select an end date");return}if("streak"!==b&&(!p||p<1)){T("Please enter a valid goal");return}if(y<=new Date){T("End date must be in the future");return}Z(!0),T(null);try{let e={name:h.trim(),type:b,goal:"streak"===b?null:parseInt(p),groupId:o.id,createdAt:(0,N.Bt)(),endDate:y,participants:o.members.map(e=>({userId:e,progress:0,lastUpdated:new Date})),status:"active"};await (0,N.ET)((0,N.hJ)(_.db,"challenges"),e);let r=o.members.map(e=>({userId:e,type:"challenge_created",message:'New challenge "'.concat(h.trim(),'" has started in "').concat(o.name,'"'),read:!1,createdAt:(0,N.Bt)()}));await Promise.all(r.map(e=>(0,N.ET)((0,N.hJ)(_.db,"notifications"),e))),x(),n()}catch(e){console.error("Error creating challenge:",e),T("Failed to create challenge. Please try again.")}finally{Z(!1)}},E=()=>{g(""),m(""),v(""),j(null),T(null),n()};return(0,a.jsxs)(w.Z,{open:t,onClose:E,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{bgcolor:"var(--background)",color:"var(--text-primary)",border:"1px solid var(--border-color)"}},children:[(0,a.jsx)(k.Z,{children:"Create Challenge"}),(0,a.jsxs)(D.Z,{children:[R&&(0,a.jsx)(d.Z,{severity:"error",sx:{mb:2},children:R}),(0,a.jsx)(C.Z,{autoFocus:!0,margin:"dense",label:"Challenge Name",fullWidth:!0,value:h,onChange:e=>g(e.target.value),sx:{mb:2}}),(0,a.jsxs)(I.Z,{fullWidth:!0,sx:{mb:2},children:[(0,a.jsx)(S.Z,{children:"Challenge Type"}),(0,a.jsx)(P.Z,{value:b,label:"Challenge Type",onChange:e=>{m(e.target.value),"streak"===e.target.value&&v("")},children:z.map(e=>{let{value:r,label:t}=e;return(0,a.jsx)(B.Z,{value:r,children:t},r)})})]}),b&&(0,a.jsx)(l.Z,{sx:{mb:2},children:(0,a.jsx)(u.Z,{variant:"body2",color:"var(--text-secondary)",gutterBottom:!0,children:null===(r=z.find(e=>e.value===b))||void 0===r?void 0:r.description})}),b&&"streak"!==b&&(0,a.jsx)(C.Z,{type:"number",label:"Goal",fullWidth:!0,value:p,onChange:e=>v(e.target.value),inputProps:{min:1},sx:{mb:2}}),(0,a.jsx)(O.x,{label:"End Date",value:y,onChange:j,minDateTime:new Date,sx:{width:"100%","& .MuiPaper-root":{backgroundColor:"#f5f5f5 !important",color:"#000000 !important"},"& .MuiCalendarPicker-root, & .MuiPickersDay-root, & .MuiClockPicker-root":{backgroundColor:"#f5f5f5 !important",color:"#000000 !important"},"& .MuiTypography-root":{color:"#000000 !important"},"& .MuiPickersDay-root":{"&.Mui-selected":{backgroundColor:"var(--beer-amber) !important",color:"#000000 !important",fontWeight:"bold"}},"& .MuiButtonBase-root":{color:"#000000 !important"},"& .MuiClock-pin, & .MuiClockPointer-root":{backgroundColor:"var(--beer-amber) !important"},"& .MuiClockNumber-root":{color:"#000000 !important","&.Mui-selected":{backgroundColor:"var(--beer-amber) !important",color:"#000000 !important"}},"& .MuiDialogActions-root button":{color:"#000000 !important"}},slotProps:{textField:{variant:"outlined",fullWidth:!0},layout:{sx:{bgcolor:"#f5f5f5","& .MuiTypography-root":{color:"#000000"},"& .MuiPickersLayout-actionBar":{backgroundColor:"#f5f5f5"}}}}})]}),(0,a.jsxs)(F.Z,{children:[(0,a.jsx)(c.Z,{onClick:E,disabled:f,children:"Cancel"}),(0,a.jsx)(c.Z,{onClick:q,disabled:f,sx:{color:"var(--beer-amber)","&:hover":{bgcolor:"rgba(251, 192, 45, 0.1)"}},children:f?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i.Z,{size:20,sx:{mr:1}}),"Creating..."]}):"Create Challenge"})]})]})}let Q=[{value:"unique_beers",label:"Unique Beers",description:"First to try X different beers"},{value:"total_beers",label:"Total Beers",description:"First to log X total beers"},{value:"streak",label:"Longest Streak",description:"Maintain the longest daily logging streak"}],X=[{value:"daily",label:"Daily"},{value:"weekly",label:"Weekly"},{value:"monthly",label:"Monthly"},{value:"yearly",label:"Yearly"},{value:"never",label:"Never"}],Y={0:{color:"#FFD700",label:"1st Place"},1:{color:"#C0C0C0",label:"2nd Place"},2:{color:"#CD7F32",label:"3rd Place"}},H=(e,r)=>{let t=new Date(e),a=new Date(r);return"".concat(t.toLocaleDateString()," - ").concat(a.toLocaleDateString())};function V(){var e,r;let{user:t}=(0,J.a)(),O=(0,U.useRouter)(),{groupId:z}=O.query,[V,K]=(0,s.useState)(null),[$,ee]=(0,s.useState)([]),[er,et]=(0,s.useState)(!0),[ea,es]=(0,s.useState)(null),[en,eo]=(0,s.useState)(!1),[el,ei]=(0,s.useState)(!1),[ed,ec]=(0,s.useState)(""),[ex,eu]=(0,s.useState)("weekly"),[eh,eg]=(0,s.useState)([]),[eb,em]=(0,s.useState)(!1),[ep,ev]=(0,s.useState)([]),[ey,ej]=(0,s.useState)(null),[ef,eZ]=(0,s.useState)(!1),ew=(0,n.Z)(),ek=(0,o.Z)(ew.breakpoints.down("sm"));(0,s.useEffect)(()=>{z&&t&&(eI(),eS(),eP())},[z,t]);let eD=(e,r)=>{let t=new Date;switch(e){case"daily":return new Date(t.setHours(0,0,0,0));case"weekly":return new Date(new Date(t.setDate(t.getDate()-t.getDay())).setHours(0,0,0,0));case"monthly":return new Date(t.getFullYear(),t.getMonth(),1);case"yearly":return new Date(t.getFullYear(),0,1);default:return r}},eC=(e,r)=>r.map(r=>{var t,a,s;let n=e.filter(e=>e.userId===r.id),o=n.reduce((e,r)=>{let t=new Date(r.timestamp.toDate()).toDateString();return e[t]=(e[t]||0)+1,e},{}),l=Math.max(0,...Object.values(o)),i=Object.keys(o).length,d=i>0?(n.length/i).toFixed(1):0,c=null===(t=Object.entries(n.reduce((e,r)=>{let t=new Date(r.timestamp.toDate()).getDay();return e[t]=(e[t]||0)+1,e},{})).sort((e,r)=>{let[,t]=e,[,a]=r;return a-t})[0])||void 0===t?void 0:t[0],x=void 0!==c?["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][c]:"-",u=null===(a=Object.entries(n.reduce((e,r)=>{let t=new Date(r.timestamp.toDate()).getHours();return e[t]=(e[t]||0)+1,e},{})).sort((e,r)=>{let[,t]=e,[,a]=r;return a-t})[0])||void 0===a?void 0:a[0],h=void 0!==u?"".concat(u.padStart(2,"0"),":00"):"-",g=Object.keys(o).sort(),b=0,m=0,p=null;g.forEach(e=>{let r=new Date(e);p&&1===Math.round((r-new Date(p))/864e5)?m++:m=1,b=Math.max(b,m),p=e});let v=0,y=new Date().toDateString(),j=new Date(Date.now()-864e5).toDateString();if(o[y]){v=1;let e=j;for(;o[e];)v++,e=new Date(new Date(e).getTime()-864e5).toDateString()}else if(o[j]){v=1;let e=new Date(Date.now()-1728e5).toDateString();for(;o[e];)v++,e=new Date(new Date(e).getTime()-864e5).toDateString()}return{...r,totalBeers:n.length,maxBeersInDay:l,avgBeersPerDay:d,consecutiveDays:b,currentStreak:v,favoriteDay:x,favoriteTime:h,drinkingDays:i,lastDrink:(null===(s=n[0])||void 0===s?void 0:s.timestamp.toDate())||null}}),eI=async()=>{et(!0),es(null);try{let e=await (0,N.QT)((0,N.JU)(_.db,"groups",z));if(!e.exists())throw Error("Group not found");let r=e.data();ec(r.name),eu(r.resetFrequency);let t=r.members.map(async e=>{let r=await (0,N.QT)((0,N.JU)(_.db,"users",e));return{id:e,...r.data()}}),a=await Promise.all(t),s=eD(r.resetFrequency,r.lastReset.toDate()),n=(0,N.IO)((0,N.hJ)(_.db,"drinks"),(0,N.ar)("userId","in",r.members),(0,N.ar)("timestamp",">=",s),(0,N.Xo)("timestamp","desc")),o=(await (0,N.PL)(n)).docs.map(e=>({id:e.id,...e.data()})),l=eC(o,a).sort((e,r)=>r.totalBeers-e.totalBeers);K({...r,id:z,members:a}),ee(l)}catch(e){console.error("Error fetching group data:",e),es(e.message||"Failed to load group data")}finally{et(!1)}},eS=async()=>{try{let e=await A.f.getFriends(t.uid);eg(e)}catch(e){console.error("Error fetching user friends:",e)}},eP=async()=>{try{let e=(0,N.IO)((0,N.hJ)(_.db,"challenges"),(0,N.ar)("groupId","==",z),(0,N.ar)("status","==","active"),(0,N.ar)("endDate",">",new Date)),r=(await (0,N.PL)(e)).docs.map(e=>({id:e.id,...e.data()}));ev(r)}catch(e){console.error("Error fetching challenges:",e)}},eB=async e=>{try{await A.f.sendFriendRequest(t.uid,e),await (0,N.ET)((0,N.hJ)(_.db,"notifications"),{userId:e,type:"friend_request",message:"You have a new friend request",read:!1,createdAt:(0,N.Bt)()}),eS()}catch(e){console.error("Error sending friend request:",e)}},eF=async e=>{try{let r=(0,N.JU)(_.db,"groups",z);if(await (0,N.r7)(r,{members:(0,N.Ab)(e)}),await (0,N.ET)((0,N.hJ)(_.db,"notifications"),{userId:e,type:"group_remove",message:"You've been removed from the group \"".concat(V.name,'"'),read:!1,createdAt:(0,N.Bt)()}),e===V.creatorId){let t=V.members.filter(r=>r!==e);t.length>0&&await (0,N.r7)(r,{creatorId:t[0]})}eI()}catch(e){console.error("Error removing member:",e)}},eR=async()=>{if(ed.trim()){em(!0);try{let e=(0,N.JU)(_.db,"groups",z);await (0,N.r7)(e,{name:ed.trim(),resetFrequency:ex,lastReset:(0,N.Bt)()});let r=V.members.map(e=>({userId:e,type:"group_update",message:'Group "'.concat(ed.trim(),'" settings have been updated'),read:!1,createdAt:(0,N.Bt)()}));await Promise.all(r.map(e=>(0,N.ET)((0,N.hJ)(_.db,"notifications"),e))),eI(),ei(!1)}catch(e){console.error("Error updating group:",e)}finally{em(!1)}}},eT=e=>{let r=[...e.participants.map(e=>{var r;let a=V.members.find(r=>r.id===e.userId);return{...e,username:(null==a?void 0:a.username)||(null==a?void 0:null===(r=a.email)||void 0===r?void 0:r.split("@")[0])||"Unknown User",isCurrentUser:e.userId===t.uid}})].sort((e,r)=>r.progress-e.progress).map((e,r)=>({...e,rank:r+1}));ej({...e,participants:r}),eZ(!0)};if(er)return(0,a.jsx)(l.Z,{sx:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,a.jsx)(i.Z,{sx:{color:"var(--beer-amber)"}})});if(ea)return(0,a.jsxs)(l.Z,{sx:{minHeight:"100vh",pt:10,px:2,display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,a.jsx)(d.Z,{severity:"error",sx:{mb:2},children:ea}),(0,a.jsx)(c.Z,{startIcon:(0,a.jsx)(R.Z,{}),onClick:()=>O.push("/leaderboards"),sx:{color:"var(--beer-amber)"},children:"Back to Leaderboards"})]});let eq=(null==V?void 0:V.creatorId)===(null==t?void 0:t.uid);return(0,a.jsxs)(l.Z,{sx:{minHeight:"100vh",pt:10,px:2},children:[(0,a.jsxs)(l.Z,{sx:{maxWidth:1200,mx:"auto"},children:[(0,a.jsx)(l.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:4,flexWrap:"wrap",gap:2},children:(0,a.jsxs)(l.Z,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,a.jsx)(x.Z,{onClick:()=>O.push("/leaderboards"),sx:{color:"var(--text-secondary)"},children:(0,a.jsx)(R.Z,{})}),(0,a.jsx)(u.Z,{variant:"h4",className:"logo-text",children:V.name}),(0,a.jsx)(h.Z,{title:"Group Settings",children:(0,a.jsx)(x.Z,{onClick:()=>ei(!0),sx:{color:"var(--beer-amber)"},children:(0,a.jsx)(T.Z,{})})})]})}),(0,a.jsx)(g.Z,{component:b.Z,sx:{bgcolor:"var(--background)",borderRadius:2,overflow:"hidden",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)",mb:4},children:(0,a.jsxs)(m.Z,{children:[(0,a.jsx)(p.Z,{children:(0,a.jsxs)(v.Z,{children:[(0,a.jsx)(y.Z,{width:"50px",sx:{color:"var(--text-secondary)",fontWeight:"bold",borderBottom:"2px solid var(--beer-amber)"},children:"Rank"}),(0,a.jsx)(y.Z,{width:"50px"}),(0,a.jsx)(y.Z,{sx:{color:"var(--text-secondary)",fontWeight:"bold",borderBottom:"2px solid var(--beer-amber)"},children:"Member"}),(0,a.jsx)(y.Z,{align:"right",sx:{color:"var(--text-secondary)",fontWeight:"bold",borderBottom:"2px solid var(--beer-amber)",display:{xs:"none",sm:"table-cell"}},children:(0,a.jsx)(h.Z,{title:"Total beers consumed during the current period",children:(0,a.jsx)("span",{children:"Total Beers"})})}),(0,a.jsx)(y.Z,{align:"right",sx:{color:"var(--text-secondary)",fontWeight:"bold",borderBottom:"2px solid var(--beer-amber)",display:{xs:"none",md:"table-cell"}},children:(0,a.jsx)(h.Z,{title:"Average beers per drinking day (days when at least one beer was logged)",children:(0,a.jsx)("span",{children:"Avg/Day"})})}),(0,a.jsx)(y.Z,{align:"right",sx:{color:"var(--text-secondary)",fontWeight:"bold",borderBottom:"2px solid var(--beer-amber)",display:{xs:"none",md:"table-cell"}},children:(0,a.jsx)(h.Z,{title:"Most beers consumed in a single day",children:(0,a.jsx)("span",{children:"Record"})})}),(0,a.jsx)(y.Z,{align:"right",sx:{color:"var(--text-secondary)",fontWeight:"bold",borderBottom:"2px solid var(--beer-amber)",display:{xs:"none",lg:"table-cell"}},children:(0,a.jsx)(h.Z,{title:"Longest streak of consecutive days drinking",children:(0,a.jsx)("span",{children:"Streak"})})}),(0,a.jsx)(y.Z,{align:"right",sx:{color:"var(--text-secondary)",fontWeight:"bold",borderBottom:"2px solid var(--beer-amber)",display:{xs:"none",lg:"table-cell"}},children:(0,a.jsx)(h.Z,{title:"Most common time of day for drinking",children:(0,a.jsx)("span",{children:"Peak Time"})})}),eq&&(0,a.jsx)(y.Z,{width:"50px",sx:{borderBottom:"2px solid var(--beer-amber)"}})]})}),(0,a.jsx)(j.Z,{children:$.map((e,r)=>{var s;let n=Y[r],o=e.id===(null==t?void 0:t.uid),i=e.lastDrink?new Date(e.lastDrink).toLocaleDateString():"-",d=eD(V.resetFrequency,V.lastReset.toDate());return(0,a.jsxs)(v.Z,{sx:{"&:last-child td, &:last-child th":{border:0},bgcolor:o?"rgba(251, 192, 45, 0.1)":"var(--glass-background)","&:nth-of-type(odd)":{bgcolor:o?"rgba(251, 192, 45, 0.1)":"rgba(255, 255, 255, 0.02)"},"&:hover":{bgcolor:o?"rgba(251, 192, 45, 0.15)":"rgba(255, 255, 255, 0.05)"},transition:"background-color 0.2s ease","& td":{color:"var(--text-primary)"}},children:[(0,a.jsx)(y.Z,{children:n?(0,a.jsx)(h.Z,{title:"".concat(n.label," - Ranked #").concat(r+1," in the group"),children:(0,a.jsx)(q.Z,{sx:{color:n.color}})}):(0,a.jsx)(h.Z,{title:"Ranked #".concat(r+1," in the group"),children:(0,a.jsx)(u.Z,{color:"var(--text-secondary)",children:r+1})})}),(0,a.jsx)(y.Z,{children:e.id!==t.uid&&!eh.find(r=>r.id===e.id)&&(0,a.jsx)(h.Z,{title:"Add Friend",children:(0,a.jsx)(x.Z,{size:"small",onClick:()=>eB(e.id),sx:{color:"var(--beer-amber)"},children:(0,a.jsx)(E.Z,{})})})}),(0,a.jsx)(y.Z,{children:(0,a.jsxs)(l.Z,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,a.jsx)(u.Z,{className:o?"logo-text":void 0,sx:{fontSize:{xs:"0.9rem",sm:"1rem"},fontWeight:n?600:400},children:e.username||(null===(s=e.email)||void 0===s?void 0:s.split("@")[0])}),e.id===V.creatorId&&(0,a.jsx)(h.Z,{title:"Group Leader - Can manage group settings and members",children:(0,a.jsx)(L.Z,{sx:{color:"var(--beer-amber)",fontSize:"1.2rem"}})})]})}),(0,a.jsx)(y.Z,{align:"right",sx:{display:{xs:"none",sm:"table-cell"},color:n?n.color:"var(--text-primary)",fontWeight:n?600:400},children:(0,a.jsx)(h.Z,{title:"Last drink: ".concat(i,"\n                          Period: ").concat(H(d,new Date),"\n                          Total drinking days: ").concat(e.drinkingDays),children:(0,a.jsx)("span",{children:e.totalBeers})})}),(0,a.jsx)(y.Z,{align:"right",sx:{display:{xs:"none",md:"table-cell"},color:"var(--text-primary)"},children:(0,a.jsx)(h.Z,{title:"".concat(e.drinkingDays," drinking days\n                          ").concat(e.totalBeers," total beers\n                          Average: ").concat(e.avgBeersPerDay," beers per drinking day"),children:(0,a.jsx)("span",{children:e.avgBeersPerDay})})}),(0,a.jsx)(y.Z,{align:"right",sx:{display:{xs:"none",md:"table-cell"},color:"var(--text-primary)"},children:(0,a.jsx)(h.Z,{title:"Record: ".concat(e.maxBeersInDay," beers in one day"),children:(0,a.jsx)("span",{children:e.maxBeersInDay})})}),(0,a.jsx)(y.Z,{align:"right",sx:{display:{xs:"none",lg:"table-cell"},color:"var(--text-primary)"},children:(0,a.jsx)(h.Z,{title:"Current streak: ".concat(e.currentStreak," days\n                          Best streak: ").concat(e.consecutiveDays," days"),children:(0,a.jsx)("span",{children:e.consecutiveDays})})}),(0,a.jsx)(y.Z,{align:"right",sx:{display:{xs:"none",lg:"table-cell"},color:"var(--text-primary)"},children:(0,a.jsx)(h.Z,{title:"Favorite day: ".concat(e.favoriteDay,"\n                          Favorite time: ").concat(e.favoriteTime),children:(0,a.jsx)("span",{children:e.favoriteTime})})}),eq&&(0,a.jsx)(y.Z,{children:e.id!==t.uid&&(0,a.jsx)(h.Z,{title:"Remove Member",children:(0,a.jsx)(x.Z,{size:"small",onClick:()=>eF(e.id),sx:{color:"rgba(211, 47, 47, 0.7)","&:hover":{color:"rgb(211, 47, 47)",bgcolor:"rgba(211, 47, 47, 0.1)"}},children:(0,a.jsx)(W.Z,{})})})})]},e.id)})})]})}),ek&&(0,a.jsx)(l.Z,{sx:{mt:2,mb:4},children:$.map((e,r)=>{var s;let n=Y[r],o=e.id===(null==t?void 0:t.uid),i=e.lastDrink?new Date(e.lastDrink).toLocaleDateString():"-",d=eD(V.resetFrequency,V.lastReset.toDate());return(0,a.jsxs)(f.Z,{sx:{mb:2,p:2,bgcolor:o?"rgba(251, 192, 45, 0.1)":"var(--glass-background)",borderRadius:2},children:[(0,a.jsxs)(l.Z,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[n?(0,a.jsx)(h.Z,{title:"".concat(n.label," - Ranked #").concat(r+1," in the group"),children:(0,a.jsx)(q.Z,{sx:{color:n.color}})}):(0,a.jsx)(h.Z,{title:"Ranked #".concat(r+1," in the group"),children:(0,a.jsxs)(u.Z,{color:"var(--text-secondary)",children:["#",r+1]})}),(0,a.jsx)(u.Z,{className:o?"logo-text":void 0,sx:{fontWeight:n?600:400},children:e.username||(null===(s=e.email)||void 0===s?void 0:s.split("@")[0])}),e.id===V.creatorId&&(0,a.jsx)(h.Z,{title:"Group Leader - Can manage group settings and members",children:(0,a.jsx)(L.Z,{sx:{color:"var(--beer-amber)",fontSize:"1.2rem"}})})]}),(0,a.jsxs)(l.Z,{sx:{display:"flex",flexDirection:"column",gap:1,mt:2},children:[(0,a.jsxs)(l.Z,{sx:{display:"flex",justifyContent:"space-between"},children:[(0,a.jsx)(h.Z,{title:"Period: ".concat(H(d,new Date),"\n                          Total drinking days: ").concat(e.drinkingDays),children:(0,a.jsxs)(u.Z,{variant:"body2",color:"var(--text-secondary)",children:["Total: ",(0,a.jsx)("span",{style:{color:null==n?void 0:n.color},children:e.totalBeers})]})}),(0,a.jsx)(h.Z,{title:"".concat(e.drinkingDays," drinking days\n                          ").concat(e.totalBeers," total beers"),children:(0,a.jsxs)(u.Z,{variant:"body2",color:"var(--text-secondary)",children:["Avg: ",e.avgBeersPerDay,"/day"]})})]}),(0,a.jsxs)(l.Z,{sx:{display:"flex",justifyContent:"space-between"},children:[(0,a.jsx)(h.Z,{title:"Record: ".concat(e.maxBeersInDay," beers in one day"),children:(0,a.jsxs)(u.Z,{variant:"body2",color:"var(--text-secondary)",children:["Record: ",e.maxBeersInDay]})}),(0,a.jsx)(h.Z,{title:"Current streak: ".concat(e.currentStreak," days\n                          Best streak: ").concat(e.consecutiveDays," days"),children:(0,a.jsxs)(u.Z,{variant:"body2",color:"var(--text-secondary)",children:["Streak: ",e.currentStreak]})})]}),(0,a.jsxs)(l.Z,{sx:{display:"flex",justifyContent:"space-between"},children:[(0,a.jsx)(h.Z,{title:"Favorite day: ".concat(e.favoriteDay,"\n                          Favorite time: ").concat(e.favoriteTime),children:(0,a.jsxs)(u.Z,{variant:"body2",color:"var(--text-secondary)",children:["Peak: ",e.favoriteDay," ",e.favoriteTime]})}),(0,a.jsx)(h.Z,{title:"Last recorded drink",children:(0,a.jsxs)(u.Z,{variant:"body2",color:"var(--text-secondary)",children:["Last: ",i]})})]})]}),(0,a.jsxs)(l.Z,{sx:{display:"flex",justifyContent:"flex-end",mt:1},children:[e.id!==t.uid&&!eh.find(r=>r.id===e.id)&&(0,a.jsx)(x.Z,{size:"small",onClick:()=>eB(e.id),sx:{color:"var(--beer-amber)"},children:(0,a.jsx)(E.Z,{})}),eq&&e.id!==t.uid&&(0,a.jsx)(x.Z,{size:"small",onClick:()=>eF(e.id),sx:{color:"rgba(211, 47, 47, 0.7)",ml:1,"&:hover":{color:"rgb(211, 47, 47)",bgcolor:"rgba(211, 47, 47, 0.1)"}},children:(0,a.jsx)(W.Z,{})})]})]},e.id)})}),(0,a.jsxs)(l.Z,{sx:{mb:4},children:[(0,a.jsxs)(l.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[(0,a.jsx)(u.Z,{variant:"h6",className:"logo-text",children:"Challenges"}),(0,a.jsx)(c.Z,{variant:"contained",startIcon:(0,a.jsx)(M.Z,{}),onClick:()=>eo(!0),sx:{bgcolor:"var(--beer-amber)","&:hover":{bgcolor:"var(--copper)"}},children:"Create Challenge"})]}),ep.length>0?(0,a.jsx)(l.Z,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"repeat(auto-fill, minmax(300px, 1fr))"},gap:2},children:ep.map(e=>{var r,s;let n=e.participants.find(e=>e.userId===t.uid),o=(null==n?void 0:n.progress)||0,i="streak"===e.type,d=i?"".concat(o," days"):"".concat(o,"/").concat(e.goal," beers"),x=i?o/30*100:o/e.goal*100,h=[...e.participants].sort((e,r)=>r.progress-e.progress).findIndex(e=>e.userId===t.uid)+1,g=e.participants.length;return(0,a.jsxs)(f.Z,{sx:{bgcolor:"var(--glass-background)",p:2,borderRadius:2,border:"1px solid var(--border-color)",display:"flex",flexDirection:"column",gap:1},children:[(0,a.jsxs)(l.Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,a.jsx)(u.Z,{variant:"h6",sx:{color:"var(--text-primary)"},children:e.name}),(0,a.jsx)(Z.Z,{label:"#".concat(h," of ").concat(g),size:"small",sx:{bgcolor:h<=3&&(null===(r=Y[h-1])||void 0===r?void 0:r.color)||"grey",color:h<=3?"black":"white",fontWeight:"bold"}})]}),(0,a.jsx)(u.Z,{variant:"body2",sx:{color:"var(--text-secondary)"},children:null===(s=Q.find(r=>r.value===e.type))||void 0===s?void 0:s.description}),(0,a.jsxs)(l.Z,{sx:{mt:1},children:[(0,a.jsxs)(u.Z,{variant:"body2",sx:{color:"var(--text-primary)",mb:.5},children:["Your Progress: ",d]}),(0,a.jsx)(l.Z,{sx:{width:"100%",height:4,bgcolor:"rgba(255, 255, 255, 0.1)",borderRadius:1,overflow:"hidden"},children:(0,a.jsx)(l.Z,{sx:{width:"".concat(Math.min(x,100),"%"),height:"100%",bgcolor:"var(--beer-amber)",transition:"width 0.3s ease"}})})]}),(0,a.jsxs)(l.Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mt:"auto",pt:1},children:[(0,a.jsxs)(u.Z,{variant:"caption",sx:{color:"var(--text-secondary)"},children:["Ends: ",new Date(1e3*e.endDate.seconds).toLocaleDateString()]}),(0,a.jsx)(c.Z,{size:"small",sx:{color:"var(--beer-amber)","&:hover":{bgcolor:"rgba(251, 192, 45, 0.1)"}},onClick:()=>eT(e),children:"View Details"})]})]},e.id)})}):(0,a.jsxs)(f.Z,{sx:{p:3,bgcolor:"var(--glass-background)",borderRadius:2,border:"1px solid var(--border-color)",textAlign:"center"},children:[(0,a.jsx)(u.Z,{color:"var(--text-secondary)",sx:{mb:2},children:"No active challenges"}),(0,a.jsx)(u.Z,{variant:"body2",color:"var(--text-secondary)",children:"Create a challenge to compete with your group members!"})]})]})]}),(0,a.jsxs)(w.Z,{open:el,onClose:()=>ei(!1),maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{bgcolor:"var(--background)",color:"var(--text-primary)",border:"1px solid var(--border-color)"}},children:[(0,a.jsx)(k.Z,{children:"Group Settings"}),(0,a.jsxs)(D.Z,{children:[(0,a.jsx)(C.Z,{autoFocus:!0,margin:"dense",label:"Group Name",fullWidth:!0,value:ed,onChange:e=>ec(e.target.value),disabled:!eq,sx:{mb:2}}),(0,a.jsxs)(I.Z,{fullWidth:!0,children:[(0,a.jsx)(S.Z,{children:"Reset Frequency"}),(0,a.jsx)(P.Z,{value:ex,label:"Reset Frequency",onChange:e=>eu(e.target.value),disabled:!eq,children:X.map(e=>{let{value:r,label:t}=e;return(0,a.jsx)(B.Z,{value:r,children:t},r)})})]}),!eq&&(0,a.jsx)(u.Z,{color:"var(--text-secondary)",sx:{mt:2},children:"Only the group leader can modify these settings"})]}),(0,a.jsxs)(F.Z,{children:[(0,a.jsx)(c.Z,{onClick:()=>ei(!1),children:"Cancel"}),eq&&(0,a.jsx)(c.Z,{onClick:eR,disabled:eb||!ed.trim(),sx:{color:"var(--beer-amber)","&:hover":{bgcolor:"rgba(251, 192, 45, 0.1)"}},children:eb?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i.Z,{size:20,sx:{mr:1}}),"Saving..."]}):"Save Changes"})]})]}),(0,a.jsx)(G,{open:en,onClose:()=>eo(!1),group:V,onChallengeCreated:eI}),(0,a.jsx)(w.Z,{open:ef,onClose:()=>eZ(!1),maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{bgcolor:"var(--background)",color:"var(--text-primary)",border:"1px solid var(--border-color)"}},children:ey&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(k.Z,{children:(0,a.jsxs)(l.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,a.jsx)(u.Z,{variant:"h6",component:"div",className:"logo-text",children:ey.name}),(0,a.jsx)(Z.Z,{label:(null===(e=Q.find(e=>e.value===ey.type))||void 0===e?void 0:e.label)||"Challenge",color:"primary",sx:{bgcolor:"var(--beer-amber)",color:"black",fontWeight:"bold"}})]})}),(0,a.jsxs)(D.Z,{children:[(0,a.jsx)(u.Z,{variant:"body2",sx:{mb:2,color:"var(--text-secondary)"},children:null===(r=Q.find(e=>e.value===ey.type))||void 0===r?void 0:r.description}),(0,a.jsxs)(u.Z,{variant:"subtitle2",sx:{mb:1,color:"var(--text-primary)"},children:["Ends: ",new Date(1e3*ey.endDate.seconds).toLocaleDateString()]}),(0,a.jsx)(u.Z,{variant:"h6",sx:{mt:3,mb:2,color:"var(--text-primary)"},children:"Leaderboard"}),(0,a.jsx)(l.Z,{sx:{mb:2},children:ey.participants.map((e,r)=>{let t=e.isCurrentUser,s="streak"===ey.type,n=s?"".concat(e.progress," days"):"".concat(e.progress,"/").concat(ey.goal," beers");return(0,a.jsxs)(l.Z,{sx:{display:"flex",alignItems:"center",p:1.5,borderRadius:1,mb:1,bgcolor:t?"rgba(251, 192, 45, 0.1)":"var(--glass-background)",border:"1px solid var(--border-color)"},children:[(0,a.jsx)(l.Z,{sx:{mr:2,width:28,height:28,display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"50%",bgcolor:r<3?Y[r].color:"rgba(255,255,255,0.1)",color:r<3?"black":"var(--text-primary)",fontWeight:"bold"},children:e.rank}),(0,a.jsxs)(l.Z,{sx:{flexGrow:1},children:[(0,a.jsxs)(u.Z,{variant:"body1",sx:{color:"var(--text-primary)",fontWeight:t?"bold":"normal"},children:[e.username,t&&" (You)"]}),(0,a.jsxs)(l.Z,{sx:{display:"flex",alignItems:"center",mt:.5},children:[(0,a.jsx)(l.Z,{sx:{flexGrow:1,height:4,bgcolor:"rgba(255, 255, 255, 0.1)",borderRadius:1,mr:1,overflow:"hidden"},children:(0,a.jsx)(l.Z,{sx:{width:s?"".concat(Math.min(e.progress/30*100,100),"%"):"".concat(Math.min(e.progress/ey.goal*100,100),"%"),height:"100%",bgcolor:"var(--beer-amber)"}})}),(0,a.jsx)(u.Z,{variant:"body2",color:"var(--text-secondary)",children:n})]})]})]},e.userId)})})]}),(0,a.jsx)(F.Z,{children:(0,a.jsx)(c.Z,{onClick:()=>eZ(!1),sx:{color:"var(--text-primary)"},children:"Close"})})]})})]})}},70247:function(e,r,t){"use strict";t.d(r,{f:function(){return o}});var a=t(42498),s=t(90109);class n{async searchUsers(e,r){let t=(0,s.hJ)(a.db,"users"),n=e.toLowerCase(),o=(await (0,s.PL)(t)).docs.map(e=>({id:e.id,...e.data()})),[l,i]=await Promise.all([this.getFriends(r),this.getPendingRequests(r)]),d=new Set(l.map(e=>e.id)),c=new Set(i.map(e=>e.senderId));return o.filter(e=>{var t,a,s;return!(e.id===r||d.has(e.id)||c.has(e.id))&&((null===(t=e.username)||void 0===t?void 0:t.toLowerCase().includes(n))||(null===(a=e.email)||void 0===a?void 0:a.toLowerCase().includes(n))||(null===(s=e.displayName)||void 0===s?void 0:s.toLowerCase().includes(n))||"".concat(e.firstName," ").concat(e.lastName).toLowerCase().includes(n))})}async sendFriendRequest(e,r){if(await this.areFriends(e,r))throw Error("Users are already friends");if(await this.getExistingRequest(e,r))throw Error("A friend request already exists between these users");let t="".concat(e,"_").concat(r),n=(await (0,s.QT)((0,s.JU)(a.db,"users",e))).data();await (0,s.pl)((0,s.JU)(a.db,"friendRequests",t),{senderId:e,receiverId:r,senderUsername:n.username||n.displayName||"",senderEmail:n.email||"",senderPhotoURL:n.photoURL||"",status:"pending",createdAt:(0,s.Bt)()})}async acceptFriendRequest(e){let r=(0,s.JU)(a.db,"friendRequests",e),t=await (0,s.QT)(r);if(!t.exists())throw Error("Friend request not found");let{senderId:n,receiverId:o}=t.data(),l="".concat(n,"_").concat(o);await (0,s.pl)((0,s.JU)(a.db,"friendships",l),{user1:n,user2:o,createdAt:(0,s.Bt)()}),await (0,s.oe)(r)}async rejectFriendRequest(e){await (0,s.oe)((0,s.JU)(a.db,"friendRequests",e))}async getPendingRequests(e){try{let r=(0,s.IO)((0,s.hJ)(a.db,"friendRequests"),(0,s.ar)("receiverId","==",e),(0,s.ar)("status","==","pending"));return(await (0,s.PL)(r)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){return console.error("Error getting pending requests:",e),[]}}async getFriends(e){let r=(0,s.hJ)(a.db,"friendships"),t=(0,s.IO)(r,(0,s.or)((0,s.ar)("user1","==",e),(0,s.ar)("user2","==",e))),n=(await (0,s.PL)(t)).docs.map(e=>e.data()).map(r=>r.user1===e?r.user2:r.user1).map(e=>(0,s.QT)((0,s.JU)(a.db,"users",e)));return(await Promise.all(n)).filter(e=>e.exists()).map(e=>({id:e.id,...e.data(),isFriend:!0}))}async removeFriend(e,r){let t="".concat(e,"_").concat(r),n="".concat(r,"_").concat(e);try{await (0,s.oe)((0,s.JU)(a.db,"friendships",t))}catch(e){await (0,s.oe)((0,s.JU)(a.db,"friendships",n))}}async areFriends(e,r){try{let t="".concat(e,"_").concat(r),n="".concat(r,"_").concat(e),[o,l]=await Promise.all([(0,s.QT)((0,s.JU)(a.db,"friendships",t)),(0,s.QT)((0,s.JU)(a.db,"friendships",n))]);return o.exists()||l.exists()}catch(e){return console.error("Error checking friendship status:",e),!1}}async getSentRequests(e){try{let r=(0,s.IO)((0,s.hJ)(a.db,"friendRequests"),(0,s.ar)("senderId","==",e),(0,s.ar)("status","==","pending"));return(await (0,s.PL)(r)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){return console.error("Error getting sent requests:",e),[]}}async getExistingRequest(e,r){let t=(0,s.hJ)(a.db,"friendRequests"),n=(0,s.IO)(t,(0,s.ar)("senderId","==",e),(0,s.ar)("receiverId","==",r),(0,s.ar)("status","==","pending")),o=(0,s.IO)(t,(0,s.ar)("senderId","==",r),(0,s.ar)("receiverId","==",e),(0,s.ar)("status","==","pending")),[l,i]=await Promise.all([(0,s.PL)(n),(0,s.PL)(o)]),d=[...l.docs,...i.docs];return d.length>0?{id:d[0].id,...d[0].data()}:null}}let o=new n}},function(e){e.O(0,[903,636,846,969,869,386,218,910,774,888,179],function(){return e(e.s=4582)}),_N_E=e.O()}]);