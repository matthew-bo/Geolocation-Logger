(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[71],{28659:function(e,o,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/log-drink",function(){return t(16457)}])},16457:function(e,o,t){"use strict";t.r(o),t.d(o,{default:function(){return L}});var n=t(85893),a=t(67294),l=t(11163),r=t(91440),i=t(5616),c=t(66242),s=t(93946),d=t(15861),u=t(66672),g=t(61903),p=t(94054),h=t(33841),f=t(85945),v=t(18972),m=t(69417),b=t(5970),x=t(46901),y=t(90948),I=t(75244),j=t(63169),w=t(36400),k=t(53630),Z=t(92098),C=t(42498),P=t(90109),N=t(63821);let _=(0,y.ZP)(r.Z)({"& .MuiRating-iconFilled":{color:"var(--beer-amber)"},"& .MuiRating-iconHover":{color:"var(--copper)"}}),D=[{value:.5,label:"Just a Taste (\xbd Pint)"},{value:1,label:"Classic Pint"},{value:1.5,label:"Tall Boy (1\xbd Pints)"},{value:2,label:"Double Fister (2 Pints)"},{value:2.5,label:"Thirsty Thursday (2\xbd Pints)"},{value:3,label:"Weekend Warrior (3 Pints)"},{value:3.5,label:"Challenge Accepted (3\xbd Pints)"},{value:4,label:"Legend Status (4 Pints)"}],S=e=>{let{delay:o,size:t,left:a}=e;return(0,n.jsx)("div",{className:"bubble",style:{width:t,height:t,left:"".concat(a,"%"),bottom:"-100px",animation:"float 3s infinite ease-in-out ".concat(o,"s"),opacity:.5*Math.random()+.1}})};function L(){let e=(0,l.useRouter)(),{user:o}=(0,Z.a)(),[t,r]=(0,a.useState)(null),[y,L]=(0,a.useState)(!1),[B,E]=(0,a.useState)([]),[T,A]=(0,a.useState)(!1),[J,O]=(0,a.useState)({brand:"",drinkType:"",containerType:"",amount:1,rating:0,notes:""}),F=Array.from({length:8},(e,o)=>({id:o,size:20*Math.random()+10,left:100*Math.random(),delay:2*Math.random()}));(0,a.useEffect)(()=>{if(!o){e.push("/login");return}navigator.geolocation&&navigator.geolocation.getCurrentPosition(e=>{r({lat:e.coords.latitude,lng:e.coords.longitude})},e=>{console.error("Error getting location:",e)}),M()},[o,e]);let M=async()=>{try{let e=(0,P.IO)((0,P.hJ)(C.db,"drinks"),(0,P.ar)("userId","==",o.uid)),t=await (0,P.PL)(e),n=[...new Set(t.docs.map(e=>e.data().brand).filter(Boolean))];E(n)}catch(e){console.error("Error fetching previous brands:",e)}},U=async n=>{if(n.preventDefault(),t){L(!0);try{let n=null;try{n=await N.E.getPlaceFromCoordinates(t),console.log("Place info retrieved:",n)}catch(e){console.error("Error getting place info:",e)}await (0,P.ET)((0,P.hJ)(C.db,"drinks"),{...J,userId:o.uid,location:t,timestamp:(0,P.Bt)(),placeInfo:n||null}),await W(o.uid,J.brand),A(!0),setTimeout(()=>{e.push("/profile")},1500)}catch(e){console.error("Error logging drink:",e)}finally{L(!1)}}},W=async(e,o)=>{try{let t;let n=(0,P.IO)((0,P.hJ)(C.db,"groups"),(0,P.ar)("members","array-contains",e)),a=await (0,P.PL)(n);if(a.empty){console.log("User is not in any groups, no challenges to update");return}let l=a.docs.map(e=>e.id);if(0===l.length){console.log("No group IDs found for user, no challenges to update");return}console.log("Found ".concat(l.length," groups for user: ").concat(l.join(", "))),t=1===l.length?(0,P.IO)((0,P.hJ)(C.db,"challenges"),(0,P.ar)("groupId","==",l[0]),(0,P.ar)("status","==","active"),(0,P.ar)("endDate",">",new Date)):(0,P.IO)((0,P.hJ)(C.db,"challenges"),(0,P.ar)("groupId","in",l),(0,P.ar)("status","==","active"),(0,P.ar)("endDate",">",new Date));let r=await (0,P.PL)(t);if(console.log("Found ".concat(r.size," active challenges for user")),r.empty){console.log("No active challenges found for user");return}let i=(0,P.qs)(C.db),c=!1;for(let t of r.docs){let n={id:t.id,...t.data()};console.log("Processing challenge: ".concat(n.id," - ").concat(n.name));let a=n.participants.findIndex(o=>o.userId===e);if(console.log("Participant index for user ".concat(e,": ").concat(a)),-1===a){console.log("User ".concat(e," not found in challenge participants"));continue}let l=!1;if("total_beers"===n.type)console.log("Updating total_beers challenge - before: ".concat(n.participants[a].progress)),n.participants[a].progress+=1,console.log("After update: ".concat(n.participants[a].progress)),l=!0;else if("unique_beers"===n.type&&o){let e=n.participants[a].loggedBrands||[];console.log('Checking if brand "'.concat(o,"\" is in user's logged brands: [").concat(e.join(", "),"]")),e.includes(o)?console.log('Brand "'.concat(o,'" already logged, not incrementing unique beers count')):(console.log('Adding new unique brand "'.concat(o,'" to challenge progress')),n.participants[a].progress+=1,n.participants[a].loggedBrands||(n.participants[a].loggedBrands=[]),n.participants[a].loggedBrands.push(o),l=!0)}else if("streak"===n.type){let e;let o=new Date().toDateString();console.log("Processing streak challenge for ".concat(o));let t=n.participants[a].progress||0;console.log("Current streak: ".concat(t));let r=n.participants[a].lastUpdated;e=r&&r.toDate?r.toDate().toDateString():r?new Date(r).toDateString():null,console.log("Last updated: ".concat(e||"never"));let i=new Date;i.setDate(i.getDate()-1);let c=i.toDateString();console.log("Yesterday: ".concat(c)),e!==o?(e===c?(console.log("Continuing streak"),n.participants[a].progress+=1):(e&&0!==t?console.log("Streak broken, resetting to 1"):console.log("Starting new streak"),n.participants[a].progress=1),l=!0):console.log("Already logged a drink today, streak not updated")}l&&(console.log("Updating challenge ".concat(n.id)),n.participants[a].lastUpdated=new Date,i.update((0,P.JU)(C.db,"challenges",n.id),{participants:n.participants}),c=!0)}c?(console.log("Committing batch updates to challenges"),await i.commit(),console.log("Successfully updated challenges")):console.log("No challenge updates to apply")}catch(e){console.error("Error updating challenges:",e)}},q=e=>{let{name:o,value:t}=e.target;O(e=>({...e,[o]:t}))};return(0,n.jsxs)(i.Z,{sx:{minHeight:"100vh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",position:"relative",overflow:"hidden",pt:10,px:2},children:[F.map(e=>(0,n.jsx)(S,{...e},e.id)),(0,n.jsxs)(c.Z,{className:"glass-card",sx:{width:"100%",maxWidth:500,p:4,position:"relative",zIndex:1},children:[(0,n.jsxs)(i.Z,{sx:{textAlign:"center",mb:4},children:[(0,n.jsx)(s.Z,{sx:{width:80,height:80,mb:2,background:"var(--glass-background)","&:hover":{background:"var(--glass-background)"}},children:(0,n.jsx)(I.Z,{sx:{fontSize:40,color:"var(--beer-amber)"}})}),(0,n.jsx)(d.Z,{variant:"h4",className:"logo-text",gutterBottom:!0,children:"Log Your Beer"})]}),(0,n.jsxs)("form",{onSubmit:U,children:[(0,n.jsx)(u.Z,{freeSolo:!0,options:B,value:J.brand,onChange:(e,o)=>{O(e=>({...e,brand:o}))},renderInput:e=>(0,n.jsx)(g.Z,{...e,label:"Beer Brand",name:"brand",required:!0,sx:{mb:3},onChange:e=>O(o=>({...o,brand:e.target.value}))})}),(0,n.jsxs)(p.Z,{fullWidth:!0,sx:{mb:3},children:[(0,n.jsx)(h.Z,{children:"Beer Type"}),(0,n.jsxs)(f.Z,{name:"drinkType",value:J.drinkType,onChange:q,required:!0,sx:{background:"var(--glass-background)",backdropFilter:"blur(10px)"},children:[(0,n.jsx)(v.Z,{value:"lager",children:"Lager"}),(0,n.jsx)(v.Z,{value:"ale",children:"Ale"}),(0,n.jsx)(v.Z,{value:"ipa",children:"IPA"}),(0,n.jsx)(v.Z,{value:"stout",children:"Stout"}),(0,n.jsx)(v.Z,{value:"porter",children:"Porter"}),(0,n.jsx)(v.Z,{value:"wheat",children:"Wheat Beer"}),(0,n.jsx)(v.Z,{value:"other",children:"Other"})]})]}),(0,n.jsxs)(p.Z,{fullWidth:!0,sx:{mb:3},children:[(0,n.jsx)(h.Z,{children:"Container"}),(0,n.jsxs)(f.Z,{name:"containerType",value:J.containerType,onChange:q,required:!0,sx:{background:"var(--glass-background)",backdropFilter:"blur(10px)"},children:[(0,n.jsx)(v.Z,{value:"pint",children:"Pint Glass"}),(0,n.jsx)(v.Z,{value:"bottle",children:"Bottle"}),(0,n.jsx)(v.Z,{value:"can",children:"Can"}),(0,n.jsx)(v.Z,{value:"mug",children:"Mug"}),(0,n.jsx)(v.Z,{value:"other",children:"Other"})]})]}),(0,n.jsxs)(i.Z,{sx:{mb:3},children:[(0,n.jsx)(d.Z,{gutterBottom:!0,children:"Amount"}),(0,n.jsx)(p.Z,{fullWidth:!0,children:(0,n.jsx)(f.Z,{name:"amount",value:J.amount,onChange:q,sx:{background:"var(--glass-background)",backdropFilter:"blur(10px)"},children:D.map(e=>(0,n.jsx)(v.Z,{value:e.value,children:(0,n.jsxs)(i.Z,{sx:{display:"flex",alignItems:"center"},children:[(0,n.jsx)(j.Z,{sx:{mr:1,color:"var(--beer-amber)"}}),e.label]})},e.value))})})]}),(0,n.jsxs)(i.Z,{sx:{mb:3,textAlign:"center"},children:[(0,n.jsx)(d.Z,{gutterBottom:!0,children:"Rating"}),(0,n.jsx)(_,{name:"rating",value:J.rating,onChange:(e,o)=>O(e=>({...e,rating:o})),icon:(0,n.jsx)(w.Z,{fontSize:"inherit"}),size:"large"})]}),(0,n.jsx)(g.Z,{fullWidth:!0,multiline:!0,rows:3,name:"notes",label:"Tasting Notes",value:J.notes,onChange:q,sx:{mb:3}}),(0,n.jsxs)(i.Z,{sx:{display:"flex",alignItems:"center",mb:3},children:[(0,n.jsx)(k.Z,{sx:{color:t?"var(--beer-amber)":"var(--text-secondary)",mr:1}}),(0,n.jsx)(d.Z,{color:t?"var(--text-primary)":"var(--text-secondary)",children:t?"Location captured":"Acquiring location..."})]}),(0,n.jsx)(m.Z,{type:"submit",fullWidth:!0,variant:"contained",disabled:y||!t,sx:{background:"var(--beer-amber)",color:"var(--dark-wood)","&:hover":{background:"var(--copper)"}},children:y?"Logging...":"Log Beer"})]})]}),(0,n.jsx)(b.Z,{open:T,autoHideDuration:3e3,onClose:()=>A(!1),anchorOrigin:{vertical:"top",horizontal:"center"},children:(0,n.jsx)(x.Z,{onClose:()=>A(!1),severity:"success",sx:{width:"100%",bgcolor:"rgba(46, 125, 50, 0.9)",color:"white","& .MuiAlert-icon":{color:"white"}},children:"\uD83C\uDF7A Beer logged successfully!"})})]})}},63821:function(e,o,t){"use strict";t.d(o,{E:function(){return i}});var n=t(42498),a=t(90109);let l="pk.eyJ1IjoibWJvMTE1NzAiLCJhIjoiY204MmgxZjBuMHh2cjJrb3F3NmlyOXJjNSJ9.9XPT8wv6gvv6axeoIl7wPQ",r=e=>{var o,t,n,a,l,r,i,c,s,d,u,g,p,h,f,v,m;if(console.log("Processing location for drink:",{id:e.id,hasLocation:!!e.location,hasPlaceInfo:!!e.placeInfo,customName:null===(o=e.placeInfo)||void 0===o?void 0:o.customName,placeName:null===(t=e.placeInfo)||void 0===t?void 0:t.placeName,address:null===(n=e.placeInfo)||void 0===n?void 0:n.address,neighborhood:null===(a=e.placeInfo)||void 0===a?void 0:a.neighborhood,city:null===(l=e.placeInfo)||void 0===l?void 0:l.city,region:null===(r=e.placeInfo)||void 0===r?void 0:r.region,coords:e.location?"".concat(e.location.lat,",").concat(e.location.lng):"none"}),null===(i=e.placeInfo)||void 0===i?void 0:i.customName)return e.placeInfo.customName;if(null===(c=e.placeInfo)||void 0===c?void 0:c.placeName)return e.placeInfo.placeName;if(null===(s=e.placeInfo)||void 0===s?void 0:s.address){let o=e.placeInfo.address;if(o.includes("(")&&o.includes(",")){if(null===(p=e.placeInfo)||void 0===p?void 0:p.neighborhood)return e.placeInfo.neighborhood;if((null===(h=e.placeInfo)||void 0===h?void 0:h.city)&&(null===(f=e.placeInfo)||void 0===f?void 0:f.region))return"".concat(e.placeInfo.city,", ").concat(e.placeInfo.region)}return(null===(g=e.placeInfo)||void 0===g?void 0:g.country)&&(o=o.replace(", ".concat(e.placeInfo.country),"")),o}return(null===(d=e.placeInfo)||void 0===d?void 0:d.neighborhood)?e.placeInfo.neighborhood:(null===(u=e.placeInfo)||void 0===u?void 0:u.city)?"".concat(e.placeInfo.city).concat(e.placeInfo.region?", ".concat(e.placeInfo.region):""):e.location&&"number"==typeof e.location.lat&&"number"==typeof e.location.lng?(null===(v=e.placeInfo)||void 0===v?void 0:v.nearestCity)?"Location near ".concat(e.placeInfo.nearestCity):(null===(m=e.placeInfo)||void 0===m?void 0:m.region)?"Location in ".concat(e.placeInfo.region):"Location at (".concat(e.location.lat.toFixed(6),", ").concat(e.location.lng.toFixed(6),")"):"Unknown Location"},i={async getPlaceFromCoordinates(e){if(!e||!e.lat||!e.lng)return console.error("Invalid coordinates provided",e),null;try{var o,t,n,a,r,i,c,s,d;let u="https://api.mapbox.com/geocoding/v5/mapbox.places/".concat(e.lng,",").concat(e.lat,".json?access_token=").concat(l,"&types=poi"),g=await fetch(u),p=await g.json();if(p.features&&p.features.length>0){let e=p.features[0],l=e.place_name,i=e.text,c=(null===(o=e.properties)||void 0===o?void 0:o.category)||"unknown",s=(null===(t=p.features.find(e=>e.place_type.includes("neighborhood")))||void 0===t?void 0:t.text)||"",d=(null===(n=p.features.find(e=>e.place_type.includes("place")))||void 0===n?void 0:n.text)||"",u=(null===(a=p.features.find(e=>e.place_type.includes("region")))||void 0===a?void 0:a.text)||"",g=(null===(r=p.features.find(e=>e.place_type.includes("country")))||void 0===r?void 0:r.text)||"";return{placeName:i,placeType:c,address:l,neighborhood:s,city:d,region:u,country:g,isAutomaticallyGenerated:!0}}let h="https://api.mapbox.com/geocoding/v5/mapbox.places/".concat(e.lng,",").concat(e.lat,".json?access_token=").concat(l),f=await fetch(h),v=await f.json();if(v.features&&v.features.length>0){let e=v.features[0].place_name,o=(null===(i=v.features.find(e=>e.place_type.includes("neighborhood")))||void 0===i?void 0:i.text)||"",t=(null===(c=v.features.find(e=>e.place_type.includes("place")))||void 0===c?void 0:c.text)||"",n=(null===(s=v.features.find(e=>e.place_type.includes("region")))||void 0===s?void 0:s.text)||"",a=(null===(d=v.features.find(e=>e.place_type.includes("country")))||void 0===d?void 0:d.text)||"";return{placeName:"Unknown Location",placeType:"location",address:e,neighborhood:o,city:t,region:n,country:a,isAutomaticallyGenerated:!0}}return null}catch(e){return console.error("Error getting place info from coordinates:",e),null}},async updateDrinkLocation(e,o){try{if(!e)return!1;let t=(0,a.JU)(n.db,"drinks",e);return await (0,a.r7)(t,{placeInfo:o}),!0}catch(e){return console.error("Error updating drink location:",e),!1}},async getLocationStats(e){try{return{topPlaces:[],visitedCities:[],visitedCountries:[]}}catch(e){return console.error("Error getting location stats:",e),null}},getDisplayNameForLocation:r,getLocationStats:e=>{try{console.log("Processing ".concat(e.length," drinks for location stats"));let o=e.reduce((e,o)=>{var t,n,a,l;return e.total++,o.location&&e.withLocation++,o.placeInfo&&e.withPlaceInfo++,(null===(t=o.placeInfo)||void 0===t?void 0:t.customName)&&e.withCustomName++,(null===(n=o.placeInfo)||void 0===n?void 0:n.placeName)&&e.withPlaceName++,(null===(a=o.placeInfo)||void 0===a?void 0:a.address)&&e.withAddress++,(null===(l=o.placeInfo)||void 0===l?void 0:l.city)&&e.withCity++,e},{total:0,withLocation:0,withPlaceInfo:0,withCustomName:0,withPlaceName:0,withAddress:0,withCity:0});console.log("Drink location data summary:",o);let t=e.filter(e=>{var o,t,n;return e.location&&(e.location.lat||e.location.lng||(null===(o=e.placeInfo)||void 0===o?void 0:o.placeName)||(null===(t=e.placeInfo)||void 0===t?void 0:t.address)||(null===(n=e.placeInfo)||void 0===n?void 0:n.city))});if(console.log("Found ".concat(t.length," drinks with usable location data")),0===t.length)return{topPlaces:[],visitedCities:[],visitedStates:[],visitedCountries:[]};let n={},a={},l={},i={},c={};t.forEach(e=>{var o,t,s;let d=r(e);if(c[d]||(c[d]={firstDrinkId:e.id,placeInfo:{...e.placeInfo},coords:e.location?{lat:e.location.lat,lng:e.location.lng}:null}),n[d]=(n[d]||0)+1,null===(o=e.placeInfo)||void 0===o?void 0:o.city){let o=e.placeInfo.city;a[o]=(a[o]||0)+1}if(null===(t=e.placeInfo)||void 0===t?void 0:t.region){let o=e.placeInfo.region;l[o]=(l[o]||0)+1}if(null===(s=e.placeInfo)||void 0===s?void 0:s.country){let o=e.placeInfo.country;i[o]=(i[o]||0)+1}}),console.log("Place name mapping:",c);let s=Object.entries(n).map(e=>{let[o,t]=e;return{name:o,count:t}}).sort((e,o)=>o.count-e.count),d=Object.entries(a).map(e=>{let[o,t]=e;return{name:o,count:t}}).sort((e,o)=>o.count-e.count),u=Object.entries(l).map(e=>{let[o,t]=e;return{name:o,count:t}}).sort((e,o)=>o.count-e.count),g=Object.entries(i).map(e=>{let[o,t]=e;return{name:o,count:t}}).sort((e,o)=>o.count-e.count);return console.log("Top places: ".concat(JSON.stringify(s.slice(0,3)))),{topPlaces:s,visitedCities:d,visitedStates:u,visitedCountries:g}}catch(e){return console.error("Error calculating location stats:",e),{topPlaces:[],visitedCities:[],visitedStates:[],visitedCountries:[]}}}}}},function(e){e.O(0,[903,636,846,970,685,249,774,888,179],function(){return e(e.s=28659)}),_N_E=e.O()}]);