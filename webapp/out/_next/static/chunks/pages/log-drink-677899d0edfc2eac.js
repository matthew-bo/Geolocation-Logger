(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[71],{28659:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/log-drink",function(){return n(16457)}])},16457:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return N}});var a=n(85893),o=n(67294),r=n(11163),l=n(91440),s=n(5616),i=n(66242),c=n(93946),d=n(15861),u=n(66672),g=n(61903),p=n(94054),h=n(33841),m=n(85945),b=n(18972),x=n(69417),f=n(14354),v=n(46901),y=n(90948),j=n(75244),Z=n(36400),w=n(53630),k=n(92098),C=n(42498),D=n(90109),P=n(63821),S=n(91444);let B=(0,y.ZP)(l.Z)({"& .MuiRating-iconFilled":{color:"var(--beer-amber)"},"& .MuiRating-iconHover":{color:"var(--copper)"}}),I=[{value:12,label:"Standard (12 oz)"},{value:16,label:"Guinness (16 oz)"},{value:18,label:"Mid-West Tall Boy (18 oz)"},{value:24,label:"Tall Boy (24 oz)"},{value:0,label:"Other"}],A=e=>{let{delay:t,size:n,left:o}=e;return(0,a.jsx)("div",{className:"bubble",style:{width:n,height:n,left:"".concat(o,"%"),bottom:"-100px",animation:"float 3s infinite ease-in-out ".concat(t,"s"),opacity:.5*Math.random()+.1}})};function N(){var e,t;let n=(0,r.useRouter)(),{user:l}=(0,k.a)(),[y,N]=(0,o.useState)(null),[z,_]=(0,o.useState)(!1),[O,T]=(0,o.useState)([]),[E,L]=(0,o.useState)(!1),[q,M]=(0,o.useState)(""),[W,U]=(0,o.useState)({brand:"",containerType:"",amount:12,rating:0,notes:"",method:""}),F=Array.from({length:8},(e,t)=>({id:t,size:20*Math.random()+10,left:100*Math.random(),delay:2*Math.random()}));(0,o.useEffect)(()=>{if(!l){n.push("/login");return}navigator.geolocation&&navigator.geolocation.getCurrentPosition(e=>{N({lat:e.coords.latitude,lng:e.coords.longitude})},e=>{console.error("Error getting location:",e)}),J()},[l,n]);let J=async()=>{try{let e=(0,D.IO)((0,D.hJ)(C.db,"drinks"),(0,D.ar)("userId","==",l.uid)),t=await (0,D.PL)(e),n=[...new Set(t.docs.map(e=>e.data().brand).filter(Boolean))];T(n)}catch(e){console.error("Error fetching previous brands:",e)}},R=async e=>{if(e.preventDefault(),!y)return;let t=0===W.amount&&q?Number(q):W.amount;if(!W.brand||!W.containerType||0===W.amount&&!q){S.Am.error("Please fill in all required fields",{position:"top-center",autoClose:3e3,theme:"dark"});return}_(!0);try{let e=null;try{e=await P.Z.getPlaceFromCoordinates(y),console.log("Place info retrieved:",e)}catch(e){console.error("Error getting place info:",e)}await (0,D.ET)((0,D.hJ)(C.db,"drinks"),{...W,amount:t,userId:l.uid,location:y,timestamp:(0,D.Bt)(),placeInfo:e||null}),await H(l.uid,W.brand),L(!0),setTimeout(()=>{n.push("/profile")},1500)}catch(e){console.error("Error logging drink:",e)}finally{_(!1)}},H=async(e,t)=>{try{let n;let a=(0,D.IO)((0,D.hJ)(C.db,"groups"),(0,D.ar)("members","array-contains",e)),o=await (0,D.PL)(a);if(o.empty){console.log("User is not in any groups, no challenges to update");return}let r=o.docs.map(e=>e.id);if(0===r.length){console.log("No group IDs found for user, no challenges to update");return}console.log("Found ".concat(r.length," groups for user: ").concat(r.join(", "))),n=1===r.length?(0,D.IO)((0,D.hJ)(C.db,"challenges"),(0,D.ar)("groupId","==",r[0]),(0,D.ar)("status","==","active"),(0,D.ar)("endDate",">",new Date)):(0,D.IO)((0,D.hJ)(C.db,"challenges"),(0,D.ar)("groupId","in",r),(0,D.ar)("status","==","active"),(0,D.ar)("endDate",">",new Date));let l=await (0,D.PL)(n);if(console.log("Found ".concat(l.size," active challenges for user")),l.empty){console.log("No active challenges found for user");return}let s=(0,D.qs)(C.db),i=!1;for(let n of l.docs){let a={id:n.id,...n.data()};console.log("Processing challenge: ".concat(a.id," - ").concat(a.name));let o=a.participants.findIndex(t=>t.userId===e);if(console.log("Participant index for user ".concat(e,": ").concat(o)),-1===o){console.log("User ".concat(e," not found in challenge participants"));continue}let r=!1;if("total_beers"===a.type)console.log("Updating total_beers challenge - before: ".concat(a.participants[o].progress)),a.participants[o].progress+=1,console.log("After update: ".concat(a.participants[o].progress)),r=!0;else if("unique_beers"===a.type&&t){let e=a.participants[o].loggedBrands||[];console.log('Checking if brand "'.concat(t,"\" is in user's logged brands: [").concat(e.join(", "),"]")),e.includes(t)?console.log('Brand "'.concat(t,'" already logged, not incrementing unique beers count')):(console.log('Adding new unique brand "'.concat(t,'" to challenge progress')),a.participants[o].progress+=1,a.participants[o].loggedBrands||(a.participants[o].loggedBrands=[]),a.participants[o].loggedBrands.push(t),r=!0)}else if("streak"===a.type){let e;let t=new Date().toDateString();console.log("Processing streak challenge for ".concat(t));let n=a.participants[o].progress||0;console.log("Current streak: ".concat(n));let l=a.participants[o].lastUpdated;e=l&&l.toDate?l.toDate().toDateString():l?new Date(l).toDateString():null,console.log("Last updated: ".concat(e||"never"));let s=new Date;s.setDate(s.getDate()-1);let i=s.toDateString();console.log("Yesterday: ".concat(i)),e!==t?(e===i?(console.log("Continuing streak"),a.participants[o].progress+=1):(e&&0!==n?console.log("Streak broken, resetting to 1"):console.log("Starting new streak"),a.participants[o].progress=1),r=!0):console.log("Already logged a drink today, streak not updated")}r&&(console.log("Updating challenge ".concat(a.id)),a.participants[o].lastUpdated=new Date,s.update((0,D.JU)(C.db,"challenges",a.id),{participants:a.participants}),i=!0)}i?(console.log("Committing batch updates to challenges"),await s.commit(),console.log("Successfully updated challenges")):console.log("No challenge updates to apply")}catch(e){console.error("Error updating challenges:",e)}},G=e=>{let{name:t,value:n}=e.target;U(e=>({...e,[t]:n}))};return(0,a.jsxs)(s.Z,{sx:{minHeight:"100vh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",position:"relative",overflow:"hidden",pt:10,px:2},children:[F.map(e=>(0,a.jsx)(A,{...e},e.id)),(0,a.jsxs)(i.Z,{className:"glass-card",sx:{width:"100%",maxWidth:500,p:4,position:"relative",zIndex:1},children:[(0,a.jsxs)(s.Z,{sx:{textAlign:"center",mb:4},children:[(0,a.jsx)(c.Z,{sx:{width:80,height:80,mb:2,background:"var(--glass-background)","&:hover":{background:"var(--glass-background)"}},children:(0,a.jsx)(j.Z,{sx:{fontSize:40,color:"var(--beer-amber)"}})}),(0,a.jsx)(d.Z,{variant:"h4",className:"logo-text",gutterBottom:!0,children:"Log Your Beer"})]}),(0,a.jsxs)("form",{onSubmit:R,children:[(0,a.jsx)(u.Z,{freeSolo:!0,options:O,value:W.brand,onChange:(e,t)=>{U(e=>({...e,brand:t}))},renderInput:e=>(0,a.jsx)(g.Z,{...e,label:"Beer Brand",name:"brand",required:!0,inputProps:{...e.inputProps,maxLength:100,pattern:"[A-Za-z0-9 '&-]*",title:"Only letters, numbers, spaces, apostrophes, ampersands, and hyphens are allowed"},sx:{mb:3},onChange:e=>{let t=e.target.value.replace(/[^A-Za-z0-9 '&-]/g,"");U(e=>({...e,brand:t}))}})}),(0,a.jsxs)(p.Z,{fullWidth:!0,sx:{mb:3},children:[(0,a.jsx)(h.Z,{children:"Container"}),(0,a.jsxs)(m.Z,{name:"containerType",value:W.containerType,onChange:G,required:!0,sx:{background:"var(--glass-background)",backdropFilter:"blur(10px)"},children:[(0,a.jsx)(b.Z,{value:"pint",children:"Pint Glass"}),(0,a.jsx)(b.Z,{value:"bottle",children:"Bottle"}),(0,a.jsx)(b.Z,{value:"can",children:"Can"}),(0,a.jsx)(b.Z,{value:"mug",children:"Mug"}),(0,a.jsx)(b.Z,{value:"other",children:"Other"})]})]}),(0,a.jsxs)(p.Z,{fullWidth:!0,sx:{mt:2},children:[(0,a.jsx)(h.Z,{children:"Amount"}),(0,a.jsx)(m.Z,{value:0===W.amount?0:W.amount,onChange:e=>{let t=e.target.value;0===t?U(e=>({...e,amount:0})):U(e=>({...e,amount:t})),M("")},label:"Amount",required:!0,children:I.map(e=>(0,a.jsx)(b.Z,{value:e.value,children:e.label},e.value))})]}),0===W.amount&&(0,a.jsx)(g.Z,{fullWidth:!0,sx:{mt:2},label:"Custom Amount (oz)",type:"number",value:q,onChange:e=>{let t=e.target.value;(""===t||999>=Number(t)&&t.length<=3)&&(M(t),t&&!isNaN(t)&&U(e=>({...e,amount:0})))},InputProps:{inputProps:{min:1,max:999,maxLength:3}},required:!0}),(0,a.jsxs)(s.Z,{sx:{mb:3,textAlign:"center"},children:[(0,a.jsx)(d.Z,{gutterBottom:!0,color:"var(--text-secondary)",children:"Rating (Optional)"}),(0,a.jsx)(B,{name:"rating",value:W.rating,onChange:(e,t)=>U(e=>({...e,rating:t})),icon:(0,a.jsx)(Z.Z,{fontSize:"inherit"}),size:"large"})]}),(0,a.jsx)(g.Z,{fullWidth:!0,multiline:!0,rows:3,name:"notes",label:"Tasting Notes (Optional)",value:W.notes,onChange:G,inputProps:{maxLength:500},helperText:"".concat((null===(e=W.notes)||void 0===e?void 0:e.length)||0,"/500"),sx:{mb:3}}),(0,a.jsx)(g.Z,{fullWidth:!0,name:"method",label:"Method (Optional)",value:W.method,onChange:G,placeholder:"e.g., funnel, shotgun, chug",inputProps:{maxLength:50,pattern:"[A-Za-z0-9 -]*",title:"Only letters, numbers, spaces, and hyphens are allowed"},helperText:"".concat((null===(t=W.method)||void 0===t?void 0:t.length)||0,"/50"),sx:{mb:3}}),(0,a.jsxs)(s.Z,{sx:{display:"flex",alignItems:"center",mb:3},children:[(0,a.jsx)(w.Z,{sx:{color:y?"var(--beer-amber)":"var(--text-secondary)",mr:1}}),(0,a.jsx)(d.Z,{color:y?"var(--text-primary)":"var(--text-secondary)",children:y?"Location captured":"Acquiring location..."})]}),(0,a.jsx)(x.Z,{type:"submit",fullWidth:!0,variant:"contained",disabled:z||!y,sx:{background:"var(--beer-amber)",color:"var(--dark-wood)","&:hover":{background:"var(--copper)"}},children:z?"Logging...":"Log Beer"})]})]}),(0,a.jsx)(f.Z,{open:E,autoHideDuration:3e3,onClose:()=>L(!1),anchorOrigin:{vertical:"top",horizontal:"center"},children:(0,a.jsx)(v.Z,{onClose:()=>L(!1),severity:"success",sx:{width:"100%",bgcolor:"rgba(46, 125, 50, 0.9)",color:"white","& .MuiAlert-icon":{color:"white"}},children:"\uD83C\uDF7A Beer logged successfully!"})})]})}}},function(e){e.O(0,[903,294,699,358,893,821,774,888,179],function(){return e(e.s=28659)}),_N_E=e.O()}]);