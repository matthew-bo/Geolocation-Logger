(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[538],{64284:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/map",function(){return n(12957)}])},12957:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return J}});var a=n(85893),o=n(67294),r=n(5616),i=n(98456),l=n(66242),s=n(46656),d=n(65582),c=n(15861),u=n(61903),p=n(94054),h=n(85945),m=n(18972),v=n(50480),g=n(45843),f=n(69417),x=n(64666),b=n(37645),y=n(6514),w=n(58951),j=n(31425),I=n(5970),Z=n(46901),k=n(7415),C=n(50720),N=n(17389),S=n(92098),T=n(90109),L=n(42498);n(70247),n(53140);var D=n(63821),A=n(56143),E=n(90948),P=n(5152);let _=n.n(P)()(()=>Promise.all([n.e(634),n.e(815),n.e(742)]).then(n.bind(n,63742)),{loadableGenerated:{webpack:()=>[63742]},ssr:!1,loading:()=>(0,a.jsx)(r.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:600,bgcolor:"#121212"},children:(0,a.jsx)(i.Z,{sx:{color:"var(--beer-amber)"}})})}),R=["can","bottle","solo cup","shotgun","funnel","pint glass","martini glass","wine glass","other"],F=(0,E.ZP)(l.Z)(e=>{let{theme:t}=e;return{position:"absolute",top:100,right:20,zIndex:1,padding:t.spacing(3),width:300,background:"var(--glass-background)",backdropFilter:"blur(10px)",border:"1px solid var(--glass-border)"}});(0,E.ZP)(s.ZP)({color:"var(--beer-amber)","& .MuiSlider-thumb":{backgroundColor:"var(--beer-amber)"},"& .MuiSlider-track":{backgroundColor:"var(--beer-amber)"},"& .MuiSlider-rail":{backgroundColor:"var(--glass-border)"}});let U=e=>{let{delay:t,size:n,left:o}=e;return(0,a.jsx)("div",{className:"bubble",style:{width:n,height:n,left:"".concat(o,"%"),bottom:"-100px",animation:"float 3s infinite ease-in-out ".concat(t,"s"),opacity:.5*Math.random()+.1}})};function J(){let{user:e}=(0,S.a)(),[t,n]=(0,o.useState)([]),[l,s]=(0,o.useState)([]),[E,P]=(0,o.useState)([]),[J,O]=(0,o.useState)(!0),[M,B]=(0,o.useState)([]),[q,z]=(0,o.useState)(!0),[W,Q]=(0,o.useState)(null),[H,G]=(0,o.useState)(null),[X,V]=(0,o.useState)({drinkType:"all",container:"",brand:"",rating:"",startDate:null,endDate:null}),[Y,K]=(0,o.useState)(!1),[$,ee]=(0,o.useState)(null),[et,en]=(0,o.useState)(""),[ea,eo]=(0,o.useState)(!1),[er,ei]=(0,o.useState)({open:!1,message:"",severity:"success"}),[el,es]=(0,o.useState)(!0),[ed,ec]=(0,o.useState)(""),[eu,ep]=(0,o.useState)({x:0,y:0}),[eh,em]=(0,o.useState)(!1),ev=Array.from({length:8},(e,t)=>({id:t,size:20*Math.random()+10,left:100*Math.random(),delay:2*Math.random()}));(0,o.useEffect)(()=>{e&&(async()=>{es(!0);try{await Promise.all([eg(),ef()]),console.log("Map data loaded successfully")}catch(e){console.error("Error loading map data:",e),ei({open:!0,message:"Error loading map data. Please try again.",severity:"error"})}finally{es(!1)}})()},[e]);let eg=async()=>{try{let t=(0,T.IO)((0,T.hJ)(L.db,"drinks"),(0,T.ar)("userId","==",e.uid)),a=(await (0,T.PL)(t)).docs.map(e=>{var t;let n=e.data(),a=(null===(t=n.timestamp)||void 0===t?void 0:t.toDate)?n.timestamp.toDate():null;return{id:e.id,...n,timestamp:a}});return console.log("Fetched ".concat(a.length," drinks")),n(a),a}catch(e){throw console.error("Error fetching drinks:",e),e}},ef=async()=>{try{let e=(await (0,T.PL)((0,T.hJ)(L.db,"users"))).docs.map(e=>({id:e.id,...e.data()})).filter(e=>e.id!==e.uid);if(e.length>0&&q){let t=e.map(async e=>{let t=(0,T.IO)((0,T.hJ)(L.db,"drinks"),(0,T.ar)("userId","==",e.id));return(await (0,T.PL)(t)).docs.map(t=>({id:t.id,...t.data(),friendId:e.id,friendUsername:e.username||e.displayName||"Anonymous Beer Lover"}))}),n=await Promise.all(t);P(n.flat())}else P([])}catch(e){console.error("Error fetching friends:",e)}},ex=(e,t)=>{V(n=>({...n,[e]:t}))},eb=e=>Math.max(15,Math.min(40,2*e)),ey=async()=>{if($&&et.trim()){eo(!0);try{let e={...$.placeInfo||{},customName:et,isCustom:!0};await D.E.updateDrinkLocation($.id,e),n(t=>t.map(t=>t.id===$.id?{...t,placeInfo:e}:t)),ei({open:!0,message:"Location updated successfully!",severity:"success"})}catch(e){console.error("Error updating location:",e),ei({open:!0,message:"Failed to update location.",severity:"error"})}finally{eo(!1),K(!1),ee(null)}}},ew=e=>{let t=new Date().getHours();return eb(24)},ej=t.filter(e=>{var t;return!("all"!==X.drinkType&&e.drinkType!==X.drinkType||X.container&&e.containerType!==X.container||X.brand&&!(null===(t=e.brand)||void 0===t?void 0:t.toLowerCase().includes(X.brand.toLowerCase()))||X.rating&&e.rating<parseInt(X.rating)||X.startDate&&e.timestamp&&new Date(e.timestamp)<X.startDate||X.endDate&&e.timestamp&&new Date(e.timestamp)>X.endDate)}),eI=q?E.filter(e=>{var t;return!("all"!==X.drinkType&&e.drinkType!==X.drinkType||X.container&&e.containerType!==X.container||X.brand&&!(null===(t=e.brand)||void 0===t?void 0:t.toLowerCase().includes(X.brand.toLowerCase()))||X.rating&&e.rating<parseInt(X.rating)||X.startDate&&e.timestamp&&new Date(e.timestamp)<X.startDate||X.endDate&&e.timestamp&&new Date(e.timestamp)>X.endDate)}):[];return(0,a.jsxs)(d.Z,{maxWidth:!1,disableGutters:!0,sx:{height:"calc(100vh - 64px)",mt:"64px",position:"relative",overflow:"hidden"},children:[ev.map(e=>(0,a.jsx)(U,{...e},e.id)),el?(0,a.jsx)(r.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",bgcolor:"#121212"},children:(0,a.jsx)(i.Z,{sx:{color:"var(--beer-amber)"}})}):(0,a.jsxs)(r.Z,{sx:{height:"100%",width:"100%",position:"relative",overflow:"hidden"},children:[(0,a.jsx)(_,{drinks:ej,friendDrinks:eI,selectedDrink:W,setSelectedDrink:Q,handleMouseMove:e=>{e.lngLat&&(ec(e.lngLat.lng.toFixed(4)+", "+e.lngLat.lat.toFixed(4)),ep({x:e.lngLat.lng,y:e.lngLat.lat}))},getMarkerSize:e=>eh?ew(e):24,getMarkerColor:(e,t)=>"friend"===t?"var(--friend-marker)":"var(--beer-amber)",onEditLocation:e=>{var t,n;ee(e),en((null===(t=e.placeInfo)||void 0===t?void 0:t.customName)||(null===(n=e.placeInfo)||void 0===n?void 0:n.placeName)||""),K(!0)}}),H&&(0,a.jsxs)(r.Z,{sx:{position:"absolute",bottom:8,left:8,backgroundColor:"rgba(0, 0, 0, 0.7)",color:"white",padding:"4px 8px",borderRadius:1,fontSize:"0.875rem",zIndex:10},children:[H.lat,", ",H.lng]}),ed&&(0,a.jsx)(r.Z,{sx:{position:"absolute",left:eu.x+10,top:eu.y+10,backgroundColor:"rgba(0, 0, 0, 0.8)",color:"white",padding:1,borderRadius:1,fontSize:"0.8rem",pointerEvents:"none",zIndex:1e3,maxWidth:200},children:(0,a.jsx)(c.Z,{variant:"body2",sx:{fontSize:"0.8rem"},children:ed})}),(0,a.jsxs)(F,{children:[(0,a.jsx)(c.Z,{variant:"h6",gutterBottom:!0,children:"Map Controls"}),(0,a.jsxs)(r.Z,{sx:{mb:3},children:[(0,a.jsx)(c.Z,{variant:"subtitle2",gutterBottom:!0,color:"var(--text-secondary)",children:"Date Range"}),(0,a.jsx)(C._,{dateAdapter:k.H,children:(0,a.jsxs)(r.Z,{sx:{display:"flex",gap:2,flexDirection:"column"},children:[(0,a.jsx)(N.M,{label:"Start Date",value:X.startDate,onChange:e=>ex("startDate",e),renderInput:e=>(0,a.jsx)(u.Z,{...e,size:"small",fullWidth:!0})}),(0,a.jsx)(N.M,{label:"End Date",value:X.endDate,onChange:e=>ex("endDate",e),renderInput:e=>(0,a.jsx)(u.Z,{...e,size:"small",fullWidth:!0})})]})})]}),(0,a.jsxs)(r.Z,{sx:{mb:3},children:[(0,a.jsx)(c.Z,{variant:"subtitle2",gutterBottom:!0,color:"var(--text-secondary)",children:"Container Type"}),(0,a.jsx)(p.Z,{fullWidth:!0,size:"small",children:(0,a.jsxs)(h.Z,{value:X.container,onChange:e=>ex("container",e.target.value),displayEmpty:!0,children:[(0,a.jsx)(m.Z,{value:"",children:"All Containers"}),R.map(e=>(0,a.jsx)(m.Z,{value:e,children:e.charAt(0).toUpperCase()+e.slice(1)},e))]})})]}),(0,a.jsxs)(r.Z,{sx:{mb:3},children:[(0,a.jsx)(c.Z,{variant:"subtitle2",gutterBottom:!0,color:"var(--text-secondary)",children:"Brand"}),(0,a.jsx)(u.Z,{fullWidth:!0,size:"small",placeholder:"Search by brand",value:X.brand||"",onChange:e=>ex("brand",e.target.value)})]}),(0,a.jsxs)(r.Z,{sx:{mb:3},children:[(0,a.jsx)(c.Z,{variant:"subtitle2",gutterBottom:!0,color:"var(--text-secondary)",children:"Drink Type"}),(0,a.jsx)(p.Z,{fullWidth:!0,size:"small",children:(0,a.jsxs)(h.Z,{value:X.drinkType,onChange:e=>ex("drinkType",e.target.value),displayEmpty:!0,children:[(0,a.jsx)(m.Z,{value:"all",children:"All Types"}),(0,a.jsx)(m.Z,{value:"lager",children:"Lager"}),(0,a.jsx)(m.Z,{value:"ale",children:"Ale"}),(0,a.jsx)(m.Z,{value:"ipa",children:"IPA"}),(0,a.jsx)(m.Z,{value:"stout",children:"Stout"}),(0,a.jsx)(m.Z,{value:"porter",children:"Porter"}),(0,a.jsx)(m.Z,{value:"wheat",children:"Wheat"}),(0,a.jsx)(m.Z,{value:"other",children:"Other"})]})})]}),(0,a.jsxs)(r.Z,{sx:{mb:3},children:[(0,a.jsx)(c.Z,{variant:"subtitle2",gutterBottom:!0,color:"var(--text-secondary)",children:"Minimum Rating"}),(0,a.jsx)(p.Z,{fullWidth:!0,size:"small",children:(0,a.jsxs)(h.Z,{value:X.rating,onChange:e=>ex("rating",e.target.value),displayEmpty:!0,children:[(0,a.jsx)(m.Z,{value:"",children:"Any Rating"}),(0,a.jsx)(m.Z,{value:"5",children:"5 Stars"}),(0,a.jsx)(m.Z,{value:"4",children:"4+ Stars"}),(0,a.jsx)(m.Z,{value:"3",children:"3+ Stars"}),(0,a.jsx)(m.Z,{value:"2",children:"2+ Stars"}),(0,a.jsx)(m.Z,{value:"1",children:"1+ Star"})]})})]}),(0,a.jsxs)(r.Z,{sx:{mb:3},children:[(0,a.jsx)(c.Z,{variant:"subtitle2",gutterBottom:!0,color:"var(--text-secondary)",children:"Show Friends' Drinks"}),(0,a.jsx)(v.Z,{control:(0,a.jsx)(g.Z,{checked:q,onChange:e=>z(e.target.checked),sx:{"& .MuiSwitch-switchBase.Mui-checked":{color:"var(--beer-amber)"},"& .MuiSwitch-switchBase.Mui-checked + .MuiSwitch-track":{backgroundColor:"var(--beer-amber)"}}}),label:"Show Friends"})]}),(0,a.jsxs)(r.Z,{sx:{mb:3},children:[(0,a.jsx)(c.Z,{variant:"subtitle2",gutterBottom:!0,color:"var(--text-secondary)",children:"Map Legend"}),(0,a.jsxs)(r.Z,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,a.jsxs)(r.Z,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,a.jsx)(r.Z,{sx:{width:16,height:16,borderRadius:"50%",bgcolor:"#F9A825"}}),(0,a.jsx)(c.Z,{variant:"body2",children:"Lager"})]}),(0,a.jsxs)(r.Z,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,a.jsx)(r.Z,{sx:{width:16,height:16,borderRadius:"50%",bgcolor:"#D84315"}}),(0,a.jsx)(c.Z,{variant:"body2",children:"Ale"})]}),(0,a.jsxs)(r.Z,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,a.jsx)(r.Z,{sx:{width:16,height:16,borderRadius:"50%",bgcolor:"#EF6C00"}}),(0,a.jsx)(c.Z,{variant:"body2",children:"IPA"})]}),(0,a.jsxs)(r.Z,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,a.jsx)(r.Z,{sx:{width:16,height:16,borderRadius:"50%",bgcolor:"#3E2723"}}),(0,a.jsx)(c.Z,{variant:"body2",children:"Stout"})]}),(0,a.jsxs)(r.Z,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,a.jsx)(r.Z,{sx:{width:16,height:16,borderRadius:"50%",bgcolor:"#4E342E"}}),(0,a.jsx)(c.Z,{variant:"body2",children:"Porter"})]}),(0,a.jsxs)(r.Z,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,a.jsx)(r.Z,{sx:{width:16,height:16,borderRadius:"50%",bgcolor:"#FFD54F"}}),(0,a.jsx)(c.Z,{variant:"body2",children:"Wheat"})]}),(0,a.jsxs)(r.Z,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,a.jsx)(r.Z,{sx:{width:16,height:16,borderRadius:"50%",bgcolor:"#FBC02D"}}),(0,a.jsx)(c.Z,{variant:"body2",children:"Other"})]})]})]}),(0,a.jsx)(f.Z,{variant:"outlined",onClick:()=>{V({drinkType:"all",container:"",brand:"",rating:"",startDate:null,endDate:null})},fullWidth:!0,sx:{borderColor:"var(--beer-amber)",color:"var(--beer-amber)","&:hover":{borderColor:"var(--copper)",background:"rgba(255,255,255,0.03)"}},startIcon:(0,a.jsx)(A.Z,{}),children:"Clear Filters"})]})]}),(0,a.jsxs)(x.Z,{open:Y,onClose:()=>!ea&&K(!1),children:[(0,a.jsx)(b.Z,{children:"Edit Location Name"}),(0,a.jsxs)(y.Z,{children:[(0,a.jsx)(w.Z,{sx:{mb:2},children:'Enter a descriptive name for this location (e.g., "Home", "Joe\'s Bar", etc.)'}),(0,a.jsx)(u.Z,{autoFocus:!0,margin:"dense",label:"Location Name",fullWidth:!0,value:et,onChange:e=>en(e.target.value),disabled:ea})]}),(0,a.jsxs)(j.Z,{children:[(0,a.jsx)(f.Z,{onClick:()=>K(!1),disabled:ea,children:"Cancel"}),(0,a.jsx)(f.Z,{onClick:ey,disabled:ea||!et.trim(),sx:{color:"var(--beer-amber)"},children:ea?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i.Z,{size:20,sx:{mr:1}}),"Saving..."]}):"Save"})]})]}),(0,a.jsx)(I.Z,{open:er.open,autoHideDuration:4e3,onClose:()=>ei({...er,open:!1}),anchorOrigin:{vertical:"top",horizontal:"center"},children:(0,a.jsx)(Z.Z,{onClose:()=>ei({...er,open:!1}),severity:er.severity,sx:{width:"100%"},children:er.message})})]})}},53140:function(e,t,n){"use strict";n.d(t,{a:function(){return o}});var a=n(84105);let o={safeFormatTimestamp(e){try{let t;if(!e)return"N/A";if("function"==typeof e.toDate)t=e.toDate();else if(e._seconds)t=new Date(1e3*e._seconds);else if("string"==typeof e)t=new Date(e);else if(e instanceof Date)t=e;else{if("number"!=typeof e)return"N/A";t=new Date(e)}if(isNaN(t.getTime()))return"N/A";return t.toISOString()}catch(e){return console.warn("Error formatting timestamp:",e),"N/A"}},exportToExcel(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{if(!e||0===e.length){console.warn("No data to export");return}let n=new Date().toISOString().split("T")[0];t=t||"".concat(n,"-drink-log.xlsx");let o=e.map(e=>{var t,n,a,o,r,i;let l=this.safeFormatTimestamp(e.timestamp),s="N/A"!==l?l.split("T")[0]:"N/A",d="N/A"!==l?l.split("T")[1].split(".")[0]:"N/A",c=(null===(t=e.location)||void 0===t?void 0:t.lat)||(null===(a=e.location)||void 0===a?void 0:null===(n=a.coordinates)||void 0===n?void 0:n[1])||"N/A",u=(null===(o=e.location)||void 0===o?void 0:o.lng)||(null===(i=e.location)||void 0===i?void 0:null===(r=i.coordinates)||void 0===r?void 0:r[0])||"N/A";return{Brand:e.brand||"Unknown",Type:e.drinkType||"Unknown",Container:e.containerType||e.container||"Unknown",Amount:e.amount||"Unknown",Rating:e.rating||"N/A",Date:s,Time:d,Timestamp:l,Latitude:c,Longitude:u,Notes:e.notes||"","Added By":e.username||"Me"}}),r=a.P6.json_to_sheet(o),i=a.P6.book_new();a.P6.book_append_sheet(i,r,"Drinks");let l=(0,a.cW)(i,{bookType:"xlsx",type:"array"}),s=new Blob([l],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),d=window.URL.createObjectURL(s),c=document.createElement("a");c.href=d,c.setAttribute("download",t),document.body.appendChild(c),c.click(),document.body.removeChild(c)}catch(e){console.error("Error exporting to Excel:",e)}},exportToCsv:e=>{try{if(!e||0===e.length){console.warn("No data to export");return}let t=new Date().toISOString().split("T")[0],n=e.map(e=>{var t,n,a,o,r,i;let l=(void 0).safeFormatTimestamp(e.timestamp),s="N/A"!==l?l.split("T")[0]:"N/A",d="N/A"!==l?l.split("T")[1].split(".")[0]:"N/A",c=(null===(t=e.location)||void 0===t?void 0:t.lat)||(null===(a=e.location)||void 0===a?void 0:null===(n=a.coordinates)||void 0===n?void 0:n[1])||"N/A",u=(null===(o=e.location)||void 0===o?void 0:o.lng)||(null===(i=e.location)||void 0===i?void 0:null===(r=i.coordinates)||void 0===r?void 0:r[0])||"N/A";return{Brand:e.brand||"Unknown",Type:e.drinkType||"Unknown",Container:e.containerType||e.container||"Unknown",Amount:e.amount||"Unknown",Rating:e.rating||"N/A",Date:s,Time:d,Timestamp:l,Latitude:c,Longitude:u,Notes:(e.notes||"").replace(/,/g," ")}}),a=Object.keys(n[0]).join(","),o=n.map(e=>Object.values(e).join(",")),r="data:text/csv;charset=utf-8,"+[a,...o].join("\n"),i=encodeURI(r),l=document.createElement("a");l.setAttribute("href",i),l.setAttribute("download","".concat(t,"-drink-log.csv")),document.body.appendChild(l),l.click(),document.body.removeChild(l)}catch(e){console.error("Error exporting to CSV:",e)}},exportToJson:e=>{try{if(!e||0===e.length){console.warn("No data to export");return}let t=new Date().toISOString().split("T")[0],n=e.map(e=>{let t=(void 0).safeFormatTimestamp(e.timestamp),n="N/A"!==t?t.split("T")[0]:null,a="N/A"!==t?t.split("T")[1].split(".")[0]:null,o={};if(e.location){var r,i;o.lat=e.location.lat||(null===(r=e.location.coordinates)||void 0===r?void 0:r[1])||null,o.lng=e.location.lng||(null===(i=e.location.coordinates)||void 0===i?void 0:i[0])||null}return{id:e.id,brand:e.brand||null,drinkType:e.drinkType||null,containerType:e.containerType||e.container||null,amount:e.amount||null,rating:e.rating||null,date:n,time:a,timestamp:"N/A"!==t?t:null,location:e.location?o:null,notes:e.notes||null}}),a=JSON.stringify(n,null,2),o=new Blob([a],{type:"application/json"}),r=URL.createObjectURL(o),i=document.createElement("a");i.setAttribute("href",r),i.setAttribute("download","".concat(t,"-drink-log.json")),document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(r)}catch(e){console.error("Error exporting to JSON:",e)}}}},70247:function(e,t,n){"use strict";n.d(t,{f:function(){return i}});var a=n(42498),o=n(90109);class r{async searchUsers(e,t){let n=(0,o.hJ)(a.db,"users"),r=e.toLowerCase(),i=(await (0,o.PL)(n)).docs.map(e=>({id:e.id,...e.data()})),[l,s]=await Promise.all([this.getFriends(t),this.getPendingRequests(t)]),d=new Set(l.map(e=>e.id)),c=new Set(s.map(e=>e.senderId));return i.filter(e=>{var n,a;return!(e.id===t||d.has(e.id)||c.has(e.id))&&((null===(n=e.username)||void 0===n?void 0:n.toLowerCase().includes(r))||(null===(a=e.displayName)||void 0===a?void 0:a.toLowerCase().includes(r))||"".concat(e.firstName," ").concat(e.lastName).toLowerCase().includes(r))})}async sendFriendRequest(e,t){if(await this.areFriends(e,t))throw Error("Users are already friends");if(await this.getExistingRequest(e,t))throw Error("A friend request already exists between these users");let n="".concat(e,"_").concat(t),r=(await (0,o.QT)((0,o.JU)(a.db,"users",e))).data();await (0,o.pl)((0,o.JU)(a.db,"friendRequests",n),{senderId:e,receiverId:t,senderUsername:r.username||r.displayName||"",senderPhotoURL:r.photoURL||"",status:"pending",createdAt:(0,o.Bt)()})}async acceptFriendRequest(e){let t=(0,o.JU)(a.db,"friendRequests",e),n=await (0,o.QT)(t);if(!n.exists())throw Error("Friend request not found");let{senderId:r,receiverId:i}=n.data(),l="".concat(r,"_").concat(i);await (0,o.pl)((0,o.JU)(a.db,"friendships",l),{user1:r,user2:i,createdAt:(0,o.Bt)()}),await (0,o.oe)(t)}async rejectFriendRequest(e){await (0,o.oe)((0,o.JU)(a.db,"friendRequests",e))}async getPendingRequests(e){try{let t=(0,o.IO)((0,o.hJ)(a.db,"friendRequests"),(0,o.ar)("receiverId","==",e),(0,o.ar)("status","==","pending"));return(await (0,o.PL)(t)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){return console.error("Error getting pending requests:",e),[]}}async getFriends(e){let t=(0,o.hJ)(a.db,"friendships"),n=(0,o.IO)(t,(0,o.or)((0,o.ar)("user1","==",e),(0,o.ar)("user2","==",e))),r=(await (0,o.PL)(n)).docs.map(e=>e.data()).map(t=>t.user1===e?t.user2:t.user1).map(e=>(0,o.QT)((0,o.JU)(a.db,"users",e)));return(await Promise.all(r)).filter(e=>e.exists()).map(e=>({id:e.id,...e.data(),isFriend:!0}))}async removeFriend(e,t){let n="".concat(e,"_").concat(t),r="".concat(t,"_").concat(e);try{await (0,o.oe)((0,o.JU)(a.db,"friendships",n))}catch(e){await (0,o.oe)((0,o.JU)(a.db,"friendships",r))}}async areFriends(e,t){try{let n="".concat(e,"_").concat(t),r="".concat(t,"_").concat(e),[i,l]=await Promise.all([(0,o.QT)((0,o.JU)(a.db,"friendships",n)),(0,o.QT)((0,o.JU)(a.db,"friendships",r))]);return i.exists()||l.exists()}catch(e){return console.error("Error checking friendship status:",e),!1}}async getSentRequests(e){try{let t=(0,o.IO)((0,o.hJ)(a.db,"friendRequests"),(0,o.ar)("senderId","==",e),(0,o.ar)("status","==","pending"));return(await (0,o.PL)(t)).docs.map(e=>({id:e.id,...e.data()}))}catch(e){return console.error("Error getting sent requests:",e),[]}}async getExistingRequest(e,t){let n=(0,o.hJ)(a.db,"friendRequests"),r=(0,o.IO)(n,(0,o.ar)("senderId","==",e),(0,o.ar)("receiverId","==",t),(0,o.ar)("status","==","pending")),i=(0,o.IO)(n,(0,o.ar)("senderId","==",t),(0,o.ar)("receiverId","==",e),(0,o.ar)("status","==","pending")),[l,s]=await Promise.all([(0,o.PL)(r),(0,o.PL)(i)]),d=[...l.docs,...s.docs];return d.length>0?{id:d[0].id,...d[0].data()}:null}}let i=new r},63821:function(e,t,n){"use strict";n.d(t,{E:function(){return l}});var a=n(42498),o=n(90109);let r="pk.eyJ1IjoibWJvMTE1NzAiLCJhIjoiY204MmgxZjBuMHh2cjJrb3F3NmlyOXJjNSJ9.9XPT8wv6gvv6axeoIl7wPQ",i=e=>{var t,n,a,o,r,i,l,s,d,c,u,p,h,m,v,g,f;if(console.log("Processing location for drink:",{id:e.id,hasLocation:!!e.location,hasPlaceInfo:!!e.placeInfo,customName:null===(t=e.placeInfo)||void 0===t?void 0:t.customName,placeName:null===(n=e.placeInfo)||void 0===n?void 0:n.placeName,address:null===(a=e.placeInfo)||void 0===a?void 0:a.address,neighborhood:null===(o=e.placeInfo)||void 0===o?void 0:o.neighborhood,city:null===(r=e.placeInfo)||void 0===r?void 0:r.city,region:null===(i=e.placeInfo)||void 0===i?void 0:i.region,coords:e.location?"".concat(e.location.lat,",").concat(e.location.lng):"none"}),null===(l=e.placeInfo)||void 0===l?void 0:l.customName)return e.placeInfo.customName;if(null===(s=e.placeInfo)||void 0===s?void 0:s.placeName)return e.placeInfo.placeName;if(null===(d=e.placeInfo)||void 0===d?void 0:d.address){let t=e.placeInfo.address;if(t.includes("(")&&t.includes(",")){if(null===(h=e.placeInfo)||void 0===h?void 0:h.neighborhood)return e.placeInfo.neighborhood;if((null===(m=e.placeInfo)||void 0===m?void 0:m.city)&&(null===(v=e.placeInfo)||void 0===v?void 0:v.region))return"".concat(e.placeInfo.city,", ").concat(e.placeInfo.region)}return(null===(p=e.placeInfo)||void 0===p?void 0:p.country)&&(t=t.replace(", ".concat(e.placeInfo.country),"")),t}return(null===(c=e.placeInfo)||void 0===c?void 0:c.neighborhood)?e.placeInfo.neighborhood:(null===(u=e.placeInfo)||void 0===u?void 0:u.city)?"".concat(e.placeInfo.city).concat(e.placeInfo.region?", ".concat(e.placeInfo.region):""):e.location&&"number"==typeof e.location.lat&&"number"==typeof e.location.lng?(null===(g=e.placeInfo)||void 0===g?void 0:g.nearestCity)?"Location near ".concat(e.placeInfo.nearestCity):(null===(f=e.placeInfo)||void 0===f?void 0:f.region)?"Location in ".concat(e.placeInfo.region):"Location at (".concat(e.location.lat.toFixed(6),", ").concat(e.location.lng.toFixed(6),")"):"Unknown Location"},l={async getPlaceFromCoordinates(e){if(!e||!e.lat||!e.lng)return console.error("Invalid coordinates provided",e),null;try{var t,n,a,o,i,l,s,d,c;let u="https://api.mapbox.com/geocoding/v5/mapbox.places/".concat(e.lng,",").concat(e.lat,".json?access_token=").concat(r,"&types=poi"),p=await fetch(u),h=await p.json();if(h.features&&h.features.length>0){let e=h.features[0],r=e.place_name,l=e.text,s=(null===(t=e.properties)||void 0===t?void 0:t.category)||"unknown",d=(null===(n=h.features.find(e=>e.place_type.includes("neighborhood")))||void 0===n?void 0:n.text)||"",c=(null===(a=h.features.find(e=>e.place_type.includes("place")))||void 0===a?void 0:a.text)||"",u=(null===(o=h.features.find(e=>e.place_type.includes("region")))||void 0===o?void 0:o.text)||"",p=(null===(i=h.features.find(e=>e.place_type.includes("country")))||void 0===i?void 0:i.text)||"";return{placeName:l,placeType:s,address:r,neighborhood:d,city:c,region:u,country:p,isAutomaticallyGenerated:!0}}let m="https://api.mapbox.com/geocoding/v5/mapbox.places/".concat(e.lng,",").concat(e.lat,".json?access_token=").concat(r),v=await fetch(m),g=await v.json();if(g.features&&g.features.length>0){let e=g.features[0].place_name,t=(null===(l=g.features.find(e=>e.place_type.includes("neighborhood")))||void 0===l?void 0:l.text)||"",n=(null===(s=g.features.find(e=>e.place_type.includes("place")))||void 0===s?void 0:s.text)||"",a=(null===(d=g.features.find(e=>e.place_type.includes("region")))||void 0===d?void 0:d.text)||"",o=(null===(c=g.features.find(e=>e.place_type.includes("country")))||void 0===c?void 0:c.text)||"";return{placeName:"Unknown Location",placeType:"location",address:e,neighborhood:t,city:n,region:a,country:o,isAutomaticallyGenerated:!0}}return null}catch(e){return console.error("Error getting place info from coordinates:",e),null}},async updateDrinkLocation(e,t){try{if(!e)return!1;let n=(0,o.JU)(a.db,"drinks",e);return await (0,o.r7)(n,{placeInfo:t}),!0}catch(e){return console.error("Error updating drink location:",e),!1}},async getLocationStats(e){try{return{topPlaces:[],visitedCities:[],visitedCountries:[]}}catch(e){return console.error("Error getting location stats:",e),null}},getDisplayNameForLocation:i,getLocationStats:e=>{try{console.log("Processing ".concat(e.length," drinks for location stats"));let t=e.reduce((e,t)=>{var n,a,o,r;return e.total++,t.location&&e.withLocation++,t.placeInfo&&e.withPlaceInfo++,(null===(n=t.placeInfo)||void 0===n?void 0:n.customName)&&e.withCustomName++,(null===(a=t.placeInfo)||void 0===a?void 0:a.placeName)&&e.withPlaceName++,(null===(o=t.placeInfo)||void 0===o?void 0:o.address)&&e.withAddress++,(null===(r=t.placeInfo)||void 0===r?void 0:r.city)&&e.withCity++,e},{total:0,withLocation:0,withPlaceInfo:0,withCustomName:0,withPlaceName:0,withAddress:0,withCity:0});console.log("Drink location data summary:",t);let n=e.filter(e=>{var t,n,a;return e.location&&(e.location.lat||e.location.lng||(null===(t=e.placeInfo)||void 0===t?void 0:t.placeName)||(null===(n=e.placeInfo)||void 0===n?void 0:n.address)||(null===(a=e.placeInfo)||void 0===a?void 0:a.city))});if(console.log("Found ".concat(n.length," drinks with usable location data")),0===n.length)return{topPlaces:[],visitedCities:[],visitedStates:[],visitedCountries:[]};let a={},o={},r={},l={},s={};n.forEach(e=>{var t,n,d;let c=i(e);if(s[c]||(s[c]={firstDrinkId:e.id,placeInfo:{...e.placeInfo},coords:e.location?{lat:e.location.lat,lng:e.location.lng}:null}),a[c]=(a[c]||0)+1,null===(t=e.placeInfo)||void 0===t?void 0:t.city){let t=e.placeInfo.city;o[t]=(o[t]||0)+1}if(null===(n=e.placeInfo)||void 0===n?void 0:n.region){let t=e.placeInfo.region;r[t]=(r[t]||0)+1}if(null===(d=e.placeInfo)||void 0===d?void 0:d.country){let t=e.placeInfo.country;l[t]=(l[t]||0)+1}}),console.log("Place name mapping:",s);let d=Object.entries(a).map(e=>{let[t,n]=e;return{name:t,count:n}}).sort((e,t)=>t.count-e.count),c=Object.entries(o).map(e=>{let[t,n]=e;return{name:t,count:n}}).sort((e,t)=>t.count-e.count),u=Object.entries(r).map(e=>{let[t,n]=e;return{name:t,count:n}}).sort((e,t)=>t.count-e.count),p=Object.entries(l).map(e=>{let[t,n]=e;return{name:t,count:n}}).sort((e,t)=>t.count-e.count);return console.log("Top places: ".concat(JSON.stringify(d.slice(0,3)))),{topPlaces:d,visitedCities:c,visitedStates:u,visitedCountries:p}}catch(e){return console.error("Error calculating location stats:",e),{topPlaces:[],visitedCities:[],visitedStates:[],visitedCountries:[]}}}}},20067:function(){},72061:function(){}},function(e){e.O(0,[251,903,636,846,969,869,970,468,887,774,888,179],function(){return e(e.s=64284)}),_N_E=e.O()}]);