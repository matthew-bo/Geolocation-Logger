(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[538],{64284:function(e,r,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/map",function(){return n(7143)}])},7143:function(e,r,n){"use strict";n.r(r),n.d(r,{default:function(){return U}});var t=n(85893),a=n(67294),l=n(5616),i=n(98456),o=n(86886),s=n(46656),d=n(69417),c=n(2734),h=n(61730),u=n(15861),p=n(65582),x=n(57922),g=n(94054),m=n(33841),b=n(85945),v=n(18972),j=n(61903),Z=n(50480),f=n(45843),k=n(64666),y=n(37645),C=n(6514),D=n(58951),w=n(31425),P=n(14354),A=n(46901),S=n(7415),M=n(50720),T=n(17389),O=n(59655),I=n(91680),E=n(6571),_=n(56143),z=n(90948),R=n(24641),B=n(5152),F=n.n(B),W=n(90109),H=n(42498),L=n(92098);let N=F()(()=>n.e(62).then(n.bind(n,97062)),{loadableGenerated:{webpack:()=>[97062]},ssr:!1,loading:()=>(0,t.jsx)(l.Z,{sx:{width:"100%",height:"100vh",display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"var(--background)"},children:(0,t.jsx)(i.Z,{sx:{color:"var(--beer-amber)"}})})}),V=(0,z.ZP)(l.Z)(e=>{let{theme:r}=e;return{position:"absolute",top:r.spacing(2),right:r.spacing(2),zIndex:1,backgroundColor:"var(--background)",padding:r.spacing(2),borderRadius:r.shape.borderRadius,boxShadow:r.shadows[4],border:"1px solid var(--border-color)",maxWidth:"300px",width:"90%"}}),X=(0,z.ZP)(o.ZP)(e=>{let{theme:r}=e;return{gap:r.spacing(2),[r.breakpoints.down("sm")]:{gap:r.spacing(1)}}});(0,z.ZP)(s.ZP)({color:"var(--beer-amber)","& .MuiSlider-thumb":{backgroundColor:"var(--beer-amber)"},"& .MuiSlider-track":{backgroundColor:"var(--beer-amber)"},"& .MuiSlider-rail":{backgroundColor:"var(--glass-border)"}});let J=(0,z.ZP)(d.Z)(e=>{let{theme:r}=e;return{width:"100%",marginBottom:r.spacing(2),justifyContent:"flex-start",padding:r.spacing(1,2),background:"var(--glass-background)",backdropFilter:"blur(10px)",border:"1px solid var(--glass-border)",borderRadius:"12px",color:"var(--text-primary)","&:hover":{background:"var(--glass-background)",opacity:.9}}});function U(){let{user:e}=(0,L.a)(),[r,n]=(0,a.useState)([]),[s,z]=(0,a.useState)([]),[B,F]=(0,a.useState)(null),[U,G]=(0,a.useState)(!0),[q,K]=(0,a.useState)(null),[Q,Y]=(0,a.useState)([]),[$,ee]=(0,a.useState)([]),[er,en]=(0,a.useState)({drinkType:["All Drink Types"],container:["All Containers"],brand:["All Brands"],rating:["All Ratings"],startDate:null,endDate:null,method:["All Methods"]}),[et,ea]=(0,a.useState)(!1),[el,ei]=(0,a.useState)(0),[eo,es]=(0,a.useState)(!1),[ed,ec]=(0,a.useState)([]),[eh,eu]=(0,a.useState)(""),[ep,ex]=(0,a.useState)([]),[eg,em]=(0,a.useState)(!0),[eb,ev]=(0,a.useState)({drinkType:null,container:null,brand:null,method:null,rating:null}),ej=(0,c.Z)();(0,h.Z)(ej.breakpoints.down("sm"));let[eZ,ef]=(0,a.useState)([0,100]),[ek,ey]=(0,a.useState)(!1),[eC,eD]=(0,a.useState)(!1),[ew,eP]=(0,a.useState)("");(0,a.useEffect)(()=>{e&&eA()},[e]);let eA=async()=>{G(!0),K(null);try{let r=(0,W.IO)((0,W.hJ)(H.db,"drinks"),(0,W.ar)("userId","==",e.uid),(0,W.Xo)("timestamp","desc")),t=(await (0,W.PL)(r)).docs.map(e=>{var r;return{id:e.id,...e.data(),timestamp:null===(r=e.data().timestamp)||void 0===r?void 0:r.toDate()}});n(t);let a=[];if(e.friends&&e.friends.length>0){let r=(0,W.IO)((0,W.hJ)(H.db,"drinks"),(0,W.ar)("userId","in",e.friends));a=(await (0,W.PL)(r)).docs.map(e=>({id:e.id,...e.data()}))}if(z(a),t.length>0){let e=[...new Set(t.map(e=>e.brand).filter(e=>e&&""!==e.trim()))].sort();ec(e),ex(e);let r=[...new Set(t.map(e=>e.containerType).filter(e=>e&&""!==e.trim()))].sort();Y(r);let n=[...new Set(t.map(e=>e.method).filter(e=>e&&""!==e.trim()))].sort();ee(n)}}catch(e){console.error("Error fetching drinks:",e),K("Failed to load drink locations. Please try again.")}finally{G(!1)}},eS=(e,r)=>{en(n=>{let t={...n};return Array.isArray(r)?t[e]=r:t[e]=[r],t})},eM=(e,r)=>{ev(n=>({...n,[r]:e.currentTarget}))},eT=e=>{ev(r=>({...r,[e]:null}))},eO=r.filter(e=>(er.drinkType.includes("All Drink Types")||er.drinkType.includes(e.type))&&(er.container.includes("All Containers")||er.container.includes(e.containerType))&&(er.brand.includes("All Brands")||er.brand.includes(e.brand))&&(er.rating.includes("All Ratings")||er.rating.includes(e.rating))&&(er.method.includes("All Methods")||er.method.includes(e.method))&&(!er.startDate||new Date(e.timestamp.toDate())>=er.startDate)&&(!er.endDate||new Date(e.timestamp.toDate())<=er.endDate)),eI=s.filter(e=>{var r;return!("All Drink Types"!==er.drinkType&&e.type!==er.drinkType||er.container&&e.container!==er.container||er.brand&&!(null===(r=e.brand)||void 0===r?void 0:r.toLowerCase().includes(er.brand.toLowerCase()))||er.rating&&e.rating!==parseInt(er.rating)||er.startDate&&new Date(e.timestamp)<er.startDate||er.endDate&&new Date(e.timestamp)>er.endDate)});return U?(0,t.jsx)(R.Z,{children:(0,t.jsx)(l.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"calc(100vh - 64px)",bgcolor:"#121212"},children:(0,t.jsx)(i.Z,{sx:{color:"var(--beer-amber)"}})})}):q?(0,t.jsx)(R.Z,{children:(0,t.jsxs)(l.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"calc(100vh - 64px)",bgcolor:"#121212",color:"var(--text-primary)",flexDirection:"column",gap:2,p:3},children:[(0,t.jsx)(u.Z,{variant:"h6",align:"center",children:q}),(0,t.jsx)(u.Z,{variant:"body2",align:"center",color:"var(--text-secondary)",children:"Please try refreshing the page or contact support if the problem persists."}),(0,t.jsx)(d.Z,{variant:"outlined",startIcon:(0,t.jsx)(O.Z,{}),onClick:eA,sx:{borderColor:"var(--glass-border)",color:"var(--text-primary)",backgroundColor:"var(--glass-background)","&:hover":{borderColor:"var(--beer-amber)",color:"var(--beer-amber)",backgroundColor:"var(--glass-background)"}},children:"Retry"})]})}):(0,t.jsxs)(R.Z,{children:[(0,t.jsx)(p.Z,{maxWidth:"xl",sx:{py:2},children:(0,t.jsxs)(l.Z,{sx:{width:"100%",display:"flex",flexDirection:"column",gap:2},children:[(0,t.jsxs)(J,{onClick:()=>ea(!et),startIcon:et?(0,t.jsx)(I.Z,{}):(0,t.jsx)(E.Z,{}),endIcon:(0,t.jsx)(_.Z,{}),children:["Filters ",el>0&&"(".concat(el,")")]}),(0,t.jsx)(x.Z,{in:et,children:(0,t.jsx)(V,{children:(0,t.jsxs)(X,{container:!0,spacing:2,children:[(0,t.jsx)(o.ZP,{item:!0,xs:12,sm:6,md:4,children:(0,t.jsxs)(g.Z,{fullWidth:!0,children:[(0,t.jsx)(m.Z,{children:"Drink Type"}),(0,t.jsxs)(b.Z,{multiple:!0,value:er.drinkType,onChange:e=>eS("drinkType",e.target.value),label:"Drink Type",renderValue:e=>e.join(", "),onOpen:e=>eM(e,"drinkType"),onClose:()=>eT("drinkType"),MenuProps:{PaperProps:{style:{maxHeight:300,width:250}},anchorEl:eb.drinkType,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"}},children:[(0,t.jsx)(v.Z,{value:"All Drink Types",children:"All Drink Types"}),(0,t.jsx)(v.Z,{value:"beer",children:"Beer"}),(0,t.jsx)(v.Z,{value:"wine",children:"Wine"}),(0,t.jsx)(v.Z,{value:"spirits",children:"Spirits"}),(0,t.jsx)(v.Z,{value:"cocktail",children:"Cocktail"})]})]})}),(0,t.jsx)(o.ZP,{item:!0,xs:12,sm:6,md:4,children:(0,t.jsxs)(g.Z,{fullWidth:!0,children:[(0,t.jsx)(m.Z,{children:"Container"}),(0,t.jsxs)(b.Z,{multiple:!0,value:er.container,onChange:e=>eS("container",e.target.value),label:"Container",renderValue:e=>e.join(", "),onOpen:e=>eM(e,"container"),onClose:()=>eT("container"),MenuProps:{PaperProps:{style:{maxHeight:300,width:250}},anchorEl:eb.container,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"}},children:[(0,t.jsx)(v.Z,{value:"All Containers",children:"All Containers"}),Q.map(e=>(0,t.jsx)(v.Z,{value:e,children:e.charAt(0).toUpperCase()+e.slice(1)},e))]})]})}),(0,t.jsx)(o.ZP,{item:!0,xs:12,sm:6,md:4,children:(0,t.jsxs)(g.Z,{fullWidth:!0,children:[(0,t.jsx)(m.Z,{children:"Brand"}),(0,t.jsxs)(b.Z,{multiple:!0,value:er.brand,onChange:e=>eS("brand",e.target.value),label:"Brand",renderValue:e=>e.join(", "),onOpen:e=>eM(e,"brand"),onClose:()=>eT("brand"),MenuProps:{PaperProps:{style:{maxHeight:300,width:250}},anchorEl:eb.brand,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"}},children:[(0,t.jsx)(v.Z,{value:"All Brands",children:"All Brands"}),ed.map(e=>(0,t.jsx)(v.Z,{value:e,children:e},e))]})]})}),(0,t.jsx)(o.ZP,{item:!0,xs:12,sm:6,md:4,children:(0,t.jsxs)(g.Z,{fullWidth:!0,children:[(0,t.jsx)(m.Z,{children:"Method"}),(0,t.jsxs)(b.Z,{multiple:!0,value:er.method,onChange:e=>eS("method",e.target.value),label:"Method",renderValue:e=>e.join(", "),onOpen:e=>eM(e,"method"),onClose:()=>eT("method"),MenuProps:{PaperProps:{style:{maxHeight:300,width:250}},anchorEl:eb.method,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"}},children:[(0,t.jsx)(v.Z,{value:"All Methods",children:"All Methods"}),$.map(e=>(0,t.jsx)(v.Z,{value:e,children:e},e))]})]})}),(0,t.jsx)(o.ZP,{item:!0,xs:12,sm:6,md:4,children:(0,t.jsxs)(g.Z,{fullWidth:!0,children:[(0,t.jsx)(m.Z,{children:"Rating"}),(0,t.jsxs)(b.Z,{multiple:!0,value:er.rating,onChange:e=>eS("rating",e.target.value),label:"Rating",renderValue:e=>e.join(", "),onOpen:e=>eM(e,"rating"),onClose:()=>eT("rating"),MenuProps:{PaperProps:{style:{maxHeight:300,width:250}},anchorEl:eb.rating,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"}},children:[(0,t.jsx)(v.Z,{value:"All Ratings",children:"All Ratings"}),[1,2,3,4,5].map(e=>(0,t.jsxs)(v.Z,{value:e,children:[e," Stars"]},e))]})]})}),(0,t.jsx)(o.ZP,{item:!0,xs:12,sm:6,md:4,children:(0,t.jsx)(M._,{dateAdapter:S.H,children:(0,t.jsx)(T.M,{label:"Start Date",value:er.startDate,onChange:e=>eS("startDate",e),renderInput:e=>(0,t.jsx)(j.Z,{...e,fullWidth:!0})})})}),(0,t.jsx)(o.ZP,{item:!0,xs:12,sm:6,md:4,children:(0,t.jsx)(M._,{dateAdapter:S.H,children:(0,t.jsx)(T.M,{label:"End Date",value:er.endDate,onChange:e=>eS("endDate",e),renderInput:e=>(0,t.jsx)(j.Z,{...e,fullWidth:!0})})})}),(0,t.jsx)(o.ZP,{item:!0,xs:12,sm:6,md:4,children:(0,t.jsx)(Z.Z,{control:(0,t.jsx)(f.Z,{checked:eg,onChange:()=>em(!eg),sx:{color:"var(--beer-amber)","&.Mui-checked":{color:"var(--beer-amber)"}}}),label:"Show Friend Logs",sx:{color:"var(--text-primary)","& .MuiFormControlLabel-label":{color:"var(--text-primary)"}}})}),(0,t.jsx)(o.ZP,{item:!0,xs:12,children:(0,t.jsx)(l.Z,{sx:{display:"flex",justifyContent:"flex-end",gap:1,mt:2},children:(0,t.jsx)(d.Z,{variant:"outlined",startIcon:(0,t.jsx)(O.Z,{}),onClick:()=>{ey(!0)},disabled:0===el,sx:{borderColor:"var(--glass-border)",color:"var(--text-primary)",backgroundColor:"var(--glass-background)","&:hover":{borderColor:"var(--beer-amber)",color:"var(--beer-amber)",backgroundColor:"var(--glass-background)"},"&.Mui-disabled":{color:"var(--text-secondary)"}},children:"Clear Filters"})})})]})})}),(0,t.jsx)(l.Z,{sx:{height:"calc(100vh - 300px)",width:"100%",position:"relative",bgcolor:"#121212",borderRadius:"12px",overflow:"hidden"},children:(0,t.jsx)(N,{drinks:eO,friendDrinks:eg?eI:[],selectedDrink:B,setSelectedDrink:F,handleMouseMove:e=>{},getMarkerSize:e=>Math.max(20,Math.min(40,2*e)),getMarkerColor:function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"user";return"friend"===r?"#4CAF50":"#FBC02D"},onError:e=>{K(e.message)},onLocationUpdate:()=>{eP("Location updated successfully"),eD(!0),eA()}})})]})}),(0,t.jsxs)(k.Z,{open:ek,onClose:()=>ey(!1),PaperProps:{sx:{bgcolor:"var(--background)",color:"var(--text-primary)",border:"1px solid var(--border-color)"}},children:[(0,t.jsx)(y.Z,{children:"Clear Filters?"}),(0,t.jsx)(C.Z,{children:(0,t.jsx)(D.Z,{sx:{color:"var(--text-secondary)"},children:"Are you sure you want to clear all filters? This will show all drinks on the map."})}),(0,t.jsxs)(w.Z,{children:[(0,t.jsx)(d.Z,{onClick:()=>ey(!1),children:"Cancel"}),(0,t.jsx)(d.Z,{onClick:()=>{ef([0,100]),ey(!1),eP("Filters cleared successfully"),eD(!0),en({drinkType:["All Drink Types"],container:["All Containers"],brand:["All Brands"],rating:["All Ratings"],startDate:null,endDate:null,method:["All Methods"]}),eA()},color:"primary",children:"Clear"})]})]}),(0,t.jsx)(P.Z,{open:eC,autoHideDuration:3e3,onClose:()=>eD(!1),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:(0,t.jsx)(A.Z,{onClose:()=>eD(!1),severity:"success",sx:{width:"100%"},children:ew})})]})}}},function(e){e.O(0,[903,354,969,294,886,869,842,457,774,888,179],function(){return e(e.s=64284)}),_N_E=e.O()}]);