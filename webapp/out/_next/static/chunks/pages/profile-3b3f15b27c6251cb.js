(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[277],{19344:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/profile",function(){return r(52797)}])},52797:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return J}});var o=r(85893),n=r(67294),a=r(11163);r(41664);var l=r(5616),i=r(98456),s=r(46901),c=r(65582),d=r(66242),u=r(69661),x=r(15861),m=r(86886),p=r(78462),h=r(9875),v=r(93946),b=r(67720),g=r(64666),f=r(37645),y=r(6514),j=r(58951),Z=r(31425),w=r(69417),k=r(75244),N=r(36400),S=r(53630),A=r(46761),T=r(92098),C=r(42498),D=r(90109),E=r(99656),I=r(84105);let O={safeFormatTimestamp(e){try{let t;if(!e)return"N/A";if("function"==typeof e.toDate)t=e.toDate();else if(e._seconds)t=new Date(1e3*e._seconds);else if("string"==typeof e)t=new Date(e);else if(e instanceof Date)t=e;else{if("number"!=typeof e)return"N/A";t=new Date(e)}if(isNaN(t.getTime()))return"N/A";return t.toISOString()}catch(e){return console.warn("Error formatting timestamp:",e),"N/A"}},exportToExcel(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{if(!e||0===e.length){console.warn("No data to export");return}let r=new Date().toISOString().split("T")[0];t=t||"".concat(r,"-drink-log.xlsx");let o=e.map(e=>{var t,r,o,n,a,l;let i=this.safeFormatTimestamp(e.timestamp),s="N/A"!==i?i.split("T")[0]:"N/A",c="N/A"!==i?i.split("T")[1].split(".")[0]:"N/A",d=(null===(t=e.location)||void 0===t?void 0:t.lat)||(null===(o=e.location)||void 0===o?void 0:null===(r=o.coordinates)||void 0===r?void 0:r[1])||"N/A",u=(null===(n=e.location)||void 0===n?void 0:n.lng)||(null===(l=e.location)||void 0===l?void 0:null===(a=l.coordinates)||void 0===a?void 0:a[0])||"N/A";return{Brand:e.brand||"Unknown",Type:e.drinkType||"Unknown",Container:e.containerType||e.container||"Unknown",Amount:e.amount||"Unknown",Rating:e.rating||"N/A",Date:s,Time:c,Timestamp:i,Latitude:d,Longitude:u,Notes:e.notes||"","Added By":e.username||"Me"}}),n=I.P6.json_to_sheet(o),a=I.P6.book_new();I.P6.book_append_sheet(a,n,"Drinks");let l=(0,I.cW)(a,{bookType:"xlsx",type:"array"}),i=new Blob([l],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),s=window.URL.createObjectURL(i),c=document.createElement("a");c.href=s,c.setAttribute("download",t),document.body.appendChild(c),c.click(),document.body.removeChild(c)}catch(e){console.error("Error exporting to Excel:",e)}},exportToCsv:e=>{try{if(!e||0===e.length){console.warn("No data to export");return}let t=new Date().toISOString().split("T")[0],r=e.map(e=>{var t,r,o,n,a,l;let i=(void 0).safeFormatTimestamp(e.timestamp),s="N/A"!==i?i.split("T")[0]:"N/A",c="N/A"!==i?i.split("T")[1].split(".")[0]:"N/A",d=(null===(t=e.location)||void 0===t?void 0:t.lat)||(null===(o=e.location)||void 0===o?void 0:null===(r=o.coordinates)||void 0===r?void 0:r[1])||"N/A",u=(null===(n=e.location)||void 0===n?void 0:n.lng)||(null===(l=e.location)||void 0===l?void 0:null===(a=l.coordinates)||void 0===a?void 0:a[0])||"N/A";return{Brand:e.brand||"Unknown",Type:e.drinkType||"Unknown",Container:e.containerType||e.container||"Unknown",Amount:e.amount||"Unknown",Rating:e.rating||"N/A",Date:s,Time:c,Timestamp:i,Latitude:d,Longitude:u,Notes:(e.notes||"").replace(/,/g," ")}}),o=Object.keys(r[0]).join(","),n=r.map(e=>Object.values(e).join(",")),a="data:text/csv;charset=utf-8,"+[o,...n].join("\n"),l=encodeURI(a),i=document.createElement("a");i.setAttribute("href",l),i.setAttribute("download","".concat(t,"-drink-log.csv")),document.body.appendChild(i),i.click(),document.body.removeChild(i)}catch(e){console.error("Error exporting to CSV:",e)}},exportToJson:e=>{try{if(!e||0===e.length){console.warn("No data to export");return}let t=new Date().toISOString().split("T")[0],r=e.map(e=>{let t=(void 0).safeFormatTimestamp(e.timestamp),r="N/A"!==t?t.split("T")[0]:null,o="N/A"!==t?t.split("T")[1].split(".")[0]:null,n={};if(e.location){var a,l;n.lat=e.location.lat||(null===(a=e.location.coordinates)||void 0===a?void 0:a[1])||null,n.lng=e.location.lng||(null===(l=e.location.coordinates)||void 0===l?void 0:l[0])||null}return{id:e.id,brand:e.brand||null,drinkType:e.drinkType||null,containerType:e.containerType||e.container||null,amount:e.amount||null,rating:e.rating||null,date:r,time:o,timestamp:"N/A"!==t?t:null,location:e.location?n:null,notes:e.notes||null}}),o=JSON.stringify(r,null,2),n=new Blob([o],{type:"application/json"}),a=URL.createObjectURL(n),l=document.createElement("a");l.setAttribute("href",a),l.setAttribute("download","".concat(t,"-drink-log.json")),document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(a)}catch(e){console.error("Error exporting to JSON:",e)}}};var L=r(7982),U=r(61903),_=r(34386),B=r(14354),P=r(47835),z=r(51797),F=r(63821);function R(e){let{placeInfo:t,onLocationUpdated:r}=e,{user:a}=(0,T.a)(),[c,d]=(0,n.useState)(!1),[u,m]=(0,n.useState)(""),[p,h]=(0,n.useState)(""),[b,g]=(0,n.useState)(""),[f,y]=(0,n.useState)(!1),[j,Z]=(0,n.useState)(null),[w,k]=(0,n.useState)(!0);(0,n.useEffect)(()=>{N()},[t]);let N=async()=>{if(!t||!a){k(!1);return}try{k(!0);let e=t.address;g(e||"");let r=await F.Z.getLocationDisplayName(a.uid,t);h(r),m(r)}catch(e){console.error("Error loading location name:",e),Z("Failed to load location name")}finally{k(!1)}},S=async()=>{if(!b||!a)return;let e=u.trim();if(0===e.length||e.length>40){Z("Location name must be between 1 and 40 characters");return}y(!0),Z(null);try{e===b?await F.Z.removeLocationAlias(a.uid,b):await F.Z.setLocationAlias(a.uid,b,e),h(e),d(!1),r&&r()}catch(e){console.error("Error saving location alias:",e),Z("Failed to save location name")}finally{y(!1)}},A=async()=>{if(b&&a){y(!0),Z(null);try{await F.Z.removeLocationAlias(a.uid,b),h(b),m(b),d(!1),r&&r()}catch(e){console.error("Error restoring location name:",e),Z("Failed to restore original location name")}finally{y(!1)}}},C=()=>{Z(null)};return t?w?(0,o.jsxs)(l.Z,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,o.jsx)(i.Z,{size:16,sx:{color:"var(--beer-amber)"}}),(0,o.jsx)(x.Z,{variant:"body2",color:"var(--text-secondary)",children:"Loading location..."})]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(l.Z,{sx:{display:"flex",alignItems:"center",gap:1,flexWrap:"wrap",width:"100%"},children:c?(0,o.jsx)(L.d,{onClickAway:()=>!f&&d(!1),children:(0,o.jsxs)(l.Z,{sx:{display:"flex",alignItems:"center",gap:1,width:"100%",flexWrap:{xs:"wrap",sm:"nowrap"}},children:[(0,o.jsx)(U.Z,{size:"small",value:u,onChange:e=>m(e.target.value),inputProps:{maxLength:40,style:{fontSize:"0.875rem"}},placeholder:"Enter location name",disabled:f,autoFocus:!0,sx:{flexGrow:1,minWidth:{xs:"180px",sm:"auto"},"& .MuiInputBase-input":{color:"var(--text-primary)",height:"1.5rem",padding:"4px 8px"},"& .MuiOutlinedInput-root":{backgroundColor:"var(--glass-background)","& fieldset":{borderColor:"var(--border-color)",borderWidth:"1px"},"&:hover fieldset":{borderColor:"var(--beer-amber)"},"&.Mui-focused fieldset":{borderColor:"var(--beer-amber)",borderWidth:"1px"}}}}),(0,o.jsxs)(l.Z,{sx:{display:"flex",alignItems:"center",gap:.5,ml:{xs:0,sm:1}},children:[(0,o.jsx)(_.Z,{title:f?"Saving...":"Save",children:(0,o.jsx)("span",{children:(0,o.jsx)(v.Z,{size:"small",onClick:S,disabled:f,sx:{color:"var(--beer-amber)",bgcolor:"var(--glass-background)","&:hover":{bgcolor:"var(--glass-background-hover)"},"&.Mui-disabled":{color:"var(--text-disabled)"}},children:f?(0,o.jsx)(i.Z,{size:16,sx:{color:"var(--beer-amber)"}}):(0,o.jsx)(P.Z,{fontSize:"small"})})})}),p!==b&&(0,o.jsx)(_.Z,{title:f?"Restoring...":"Restore original address",children:(0,o.jsx)(x.Z,{variant:"caption",sx:{color:f?"var(--text-disabled)":"var(--text-secondary)",cursor:f?"default":"pointer",px:1,py:.5,borderRadius:1,bgcolor:"var(--glass-background)",fontSize:"0.75rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:{xs:"120px",sm:"200px"},"&:hover":{bgcolor:f?"var(--glass-background)":"var(--glass-background-hover)",textDecoration:f?"none":"underline"}},onClick:()=>!f&&A(),children:b})})]})]})}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(x.Z,{variant:"body2",color:"var(--text-secondary)",sx:{maxWidth:"100%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:p}),(0,o.jsx)(_.Z,{title:"Edit location name",children:(0,o.jsx)(v.Z,{size:"small",onClick:()=>d(!0),sx:{color:"var(--text-secondary)",bgcolor:"var(--glass-background)","&:hover":{bgcolor:"var(--glass-background-hover)",color:"var(--beer-amber)"}},children:(0,o.jsx)(z.Z,{fontSize:"small"})})})]})}),(0,o.jsx)(B.Z,{open:!!j,autoHideDuration:6e3,onClose:C,anchorOrigin:{vertical:"bottom",horizontal:"center"},sx:{"& .MuiSnackbarContent-root":{bgcolor:"var(--background)",color:"var(--text-primary)"}},children:(0,o.jsx)(s.Z,{onClose:C,severity:"error",variant:"filled",sx:{width:"100%",bgcolor:"var(--background)",color:"var(--text-primary)","& .MuiAlert-icon":{color:"#f44336"},"& .MuiAlert-action":{color:"var(--text-secondary)"}},children:j})})]}):null}function J(){var e,t,r,I,L;let{user:U}=(0,T.a)(),{userId:_}=(0,a.useRouter)().query,[B,P]=(0,n.useState)({totalDrinks:0,uniqueBeers:0,favoriteBeer:null,totalOunces:0,friends:0}),[z,F]=(0,n.useState)(null),[J,W]=(0,n.useState)([]),[M,q]=(0,n.useState)(!0),[H,X]=(0,n.useState)(null),[V,G]=(0,n.useState)(!1),[Q,K]=(0,n.useState)(null),[Y,$]=(0,n.useState)(!1),[ee,et]=(0,n.useState)([]),er=!_||_===(null==U?void 0:U.uid),eo=_||(null==U?void 0:U.uid);(0,n.useEffect)(()=>{eo&&(en(),ei())},[eo]);let en=async()=>{q(!0),X(null);try{await Promise.all([ea(),ed(),el()])}catch(e){console.error("Error fetching user data:",e),X("Failed to load profile data. Please try again later.")}finally{q(!1)}},ea=async()=>{try{let e=(0,D.JU)(C.db,"users",eo),t=await (0,D.QT)(e);t.exists()&&F(t.data())}catch(e){throw console.error("Error fetching user profile:",e),e}},el=async()=>{try{let e=(0,D.IO)((0,D.hJ)(C.db,"drinks"),(0,D.ar)("userId","==",eo),(0,D.Xo)("timestamp","desc"),(0,D.b9)(10)),t=(await (0,D.PL)(e)).docs.map(e=>{let t;let r=e.data();return t=r.timestamp?"function"==typeof r.timestamp.toDate?r.timestamp.toDate():new Date(r.timestamp._seconds?1e3*r.timestamp._seconds:r.timestamp):new Date,{id:e.id,...r,timestamp:t}});W(t)}catch(e){throw console.error("Error fetching recent drinks:",e),e}},ei=async()=>{try{let e=(0,D.IO)((0,D.hJ)(C.db,"drinks"),(0,D.ar)("userId","==",eo)),t=(await (0,D.PL)(e)).docs.map(e=>{let t;let r=e.data();return t=r.timestamp?"function"==typeof r.timestamp.toDate?r.timestamp.toDate():new Date(r.timestamp._seconds?1e3*r.timestamp._seconds:r.timestamp):new Date,{id:e.id,...r,timestamp:t.toISOString()}});et(t)}catch(e){throw console.error("Error fetching all drinks:",e),e}},es=e=>{K(e),G(!0)},ec=async()=>{if(Q){$(!0);try{await (0,D.oe)((0,D.JU)(C.db,"drinks",Q.id)),W(J.filter(e=>e.id!==Q.id)),ed()}catch(e){console.error("Error deleting drink:",e),X("Failed to delete drink. Please try again.")}finally{$(!1),G(!1),K(null)}}},ed=async()=>{try{var e;let t=(0,D.IO)((0,D.hJ)(C.db,"drinks"),(0,D.ar)("userId","==",eo)),r=(await (0,D.PL)(t)).docs.map(e=>e.data()),o=[...new Set(r.map(e=>e.brand))],n=r.reduce((e,t)=>(e[t.brand]=(e[t.brand]||0)+1,e),{}),a=r.reduce((e,t)=>e+(t.amount||0),0),l=(null===(e=Object.entries(n).sort((e,t)=>{let[,r]=e,[,o]=t;return o-r})[0])||void 0===e?void 0:e[0])||null;P({totalDrinks:r.length,uniqueBeers:o.length,favoriteBeer:l,totalOunces:a,friends:0})}catch(e){throw console.error("Error fetching user stats:",e),e}},eu=e=>{switch(e){case"excel":O.exportToExcel(ee);break;case"csv":O.exportToCsv(ee);break;case"json":O.exportToJson(ee);break;default:console.error("Unsupported export format")}};return M?(0,o.jsx)(l.Z,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"80vh",children:(0,o.jsx)(i.Z,{})}):H?(0,o.jsx)(s.Z,{severity:"error",sx:{mt:2},children:H}):(0,o.jsx)(l.Z,{sx:{minHeight:"100vh",pt:10,px:2},children:(0,o.jsxs)(c.Z,{maxWidth:"lg",children:[(0,o.jsx)(d.Z,{className:"glass-card",sx:{mb:4,position:"relative"},children:(0,o.jsxs)(l.Z,{sx:{p:3,textAlign:"center"},children:[(0,o.jsx)(u.Z,{sx:{width:120,height:120,mx:"auto",mb:2,bgcolor:"var(--beer-amber)",fontSize:"2.5rem"},children:(null==z?void 0:null===(t=z.username)||void 0===t?void 0:null===(e=t[0])||void 0===e?void 0:e.toUpperCase())||(null==z?void 0:null===(I=z.email)||void 0===I?void 0:null===(r=I[0])||void 0===r?void 0:r.toUpperCase())}),(0,o.jsx)(x.Z,{variant:"h4",gutterBottom:!0,children:(null==z?void 0:z.username)||"Anonymous Beer Lover"}),(0,o.jsxs)(x.Z,{variant:"body1",color:"textSecondary",children:["Member since ",(L=null==z?void 0:z.createdAt)?new Date(L).toLocaleDateString():"N/A"]})]})}),(0,o.jsxs)(m.ZP,{container:!0,spacing:3,mb:4,children:[(0,o.jsx)(m.ZP,{item:!0,xs:12,sm:6,md:3,children:(0,o.jsxs)(l.Z,{className:"stat-card",children:[(0,o.jsx)(k.Z,{sx:{fontSize:40,color:"var(--beer-amber)",mb:1}}),(0,o.jsx)(x.Z,{className:"stat-value",children:B.totalDrinks}),(0,o.jsx)(x.Z,{className:"stat-label",children:"Total Beers"})]})}),(0,o.jsx)(m.ZP,{item:!0,xs:12,sm:6,md:3,children:(0,o.jsxs)(l.Z,{className:"stat-card",children:[(0,o.jsx)(k.Z,{sx:{fontSize:40,color:"var(--beer-amber)",mb:1}}),(0,o.jsx)(x.Z,{className:"stat-value",children:B.uniqueBeers}),(0,o.jsx)(x.Z,{className:"stat-label",children:"Unique Beers"})]})}),(0,o.jsx)(m.ZP,{item:!0,xs:12,sm:6,md:3,children:(0,o.jsxs)(l.Z,{className:"stat-card",children:[(0,o.jsx)(k.Z,{sx:{fontSize:40,color:"var(--beer-amber)",mb:1}}),(0,o.jsx)(x.Z,{className:"stat-value",children:B.totalOunces}),(0,o.jsx)(x.Z,{className:"stat-label",children:"Total Ounces"})]})}),(0,o.jsx)(m.ZP,{item:!0,xs:12,sm:6,md:3,children:(0,o.jsxs)(l.Z,{className:"stat-card",children:[(0,o.jsx)(N.Z,{sx:{fontSize:40,color:"var(--beer-amber)",mb:1}}),(0,o.jsx)(x.Z,{className:"stat-value",children:B.favoriteBeer||"None"}),(0,o.jsx)(x.Z,{className:"stat-label",children:"Favorite Beer"})]})})]}),(0,o.jsxs)(l.Z,{sx:{mt:4,mb:4},children:[(0,o.jsx)(x.Z,{variant:"h5",gutterBottom:!0,children:"Drink Analytics"}),(0,o.jsx)(E.Z,{drinks:J})]}),(0,o.jsxs)(l.Z,{className:"premium-card",sx:{p:4},children:[(0,o.jsx)(l.Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:(0,o.jsx)(x.Z,{variant:"h6",color:"var(--beer-amber)",children:"Recent Activity"})}),J.length>0?(0,o.jsx)(p.Z,{sx:{p:0},children:J.map((e,t)=>(0,o.jsxs)(n.Fragment,{children:[(0,o.jsx)(h.ZP,{alignItems:"flex-start",sx:{flexDirection:"column"},children:(0,o.jsxs)(l.Z,{sx:{display:"flex",width:"100%",justifyContent:"space-between",alignItems:"flex-start"},children:[(0,o.jsxs)(l.Z,{children:[(0,o.jsx)(x.Z,{color:"var(--text-primary)",sx:{fontWeight:"bold"},children:e.brand||"Unknown Brand"}),(0,o.jsx)(x.Z,{variant:"body2",color:"var(--text-secondary)",children:new Date(e.timestamp).toLocaleString()}),e.placeInfo&&(0,o.jsxs)(l.Z,{sx:{display:"flex",alignItems:"center",mt:.5},children:[(0,o.jsx)(S.Z,{sx:{fontSize:"0.9rem",color:"var(--text-secondary)",mr:.5}}),er?(0,o.jsx)(R,{placeInfo:e.placeInfo,onLocationUpdated:()=>{el(),ei()}}):(0,o.jsx)(x.Z,{variant:"body2",color:"var(--text-secondary)",children:e.placeInfo.neighborhood?"".concat(e.placeInfo.neighborhood,", ").concat(e.placeInfo.city):e.placeInfo.address||"Unknown Location"})]})]}),er&&(0,o.jsx)(v.Z,{edge:"end","aria-label":"delete",onClick:()=>es(e),sx:{color:"var(--text-secondary)"},children:(0,o.jsx)(A.Z,{})})]})}),t<J.length-1&&(0,o.jsx)(b.Z,{component:"li",sx:{bgcolor:"var(--border-color)"}})]},e.id))}):(0,o.jsx)(x.Z,{color:"var(--text-secondary)",sx:{fontStyle:"italic"},children:"No beers logged yet. Start logging your beer journey!"})]}),(0,o.jsxs)(g.Z,{open:V,onClose:()=>G(!1),PaperProps:{sx:{bgcolor:"var(--background)",color:"var(--text-primary)",border:"1px solid var(--border-color)"}},children:[(0,o.jsx)(f.Z,{children:"Delete Beer Entry"}),(0,o.jsx)(y.Z,{children:(0,o.jsx)(j.Z,{sx:{color:"var(--text-secondary)"},children:"Are you sure you want to delete this beer entry? This action cannot be undone."})}),(0,o.jsxs)(Z.Z,{children:[(0,o.jsx)(w.Z,{onClick:()=>G(!1),disabled:Y,sx:{color:"var(--text-primary)"},children:"Cancel"}),(0,o.jsx)(w.Z,{onClick:ec,disabled:Y,sx:{color:"rgb(211, 47, 47)"},startIcon:Y?(0,o.jsx)(i.Z,{size:20}):(0,o.jsx)(A.Z,{}),children:Y?"Deleting...":"Delete"})]})]}),er&&(0,o.jsxs)(d.Z,{className:"glass-card",sx:{mt:4,p:2},children:[(0,o.jsx)(x.Z,{variant:"h6",gutterBottom:!0,children:"Export Drink History"}),(0,o.jsxs)(l.Z,{sx:{display:"flex",gap:2},children:[(0,o.jsx)(w.Z,{variant:"contained",onClick:()=>eu("excel"),sx:{bgcolor:"var(--beer-amber)"},children:"Export to Excel"}),(0,o.jsx)(w.Z,{variant:"contained",onClick:()=>eu("csv"),sx:{bgcolor:"var(--beer-amber)"},children:"Export to CSV"}),(0,o.jsx)(w.Z,{variant:"contained",onClick:()=>eu("json"),sx:{bgcolor:"var(--beer-amber)"},children:"Export to JSON"})]})]})]})})}},20067:function(){},72061:function(){}},function(e){e.O(0,[196,251,903,738,294,699,739,886,358,801,156,326,656,821,774,888,179],function(){return e(e.s=19344)}),_N_E=e.O()}]);