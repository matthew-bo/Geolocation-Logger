(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[277],{19344:function(e,r,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/profile",function(){return t(52797)}])},52797:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return X}});var s=t(85893),a=t(67294),n=t(11163);t(41664);var i=t(5616),o=t(98456),l=t(65582),c=t(46901),d=t(69417),x=t(66242),u=t(69661),m=t(15861),h=t(86886),b=t(93946),j=t(57922),y=t(78462),p=t(9875),Z=t(59334),f=t(67720),v=t(64666),g=t(37645),k=t(6514),I=t(58951),S=t(31425),w=t(14354),C=t(75244),P=t(6571),z=t(73227),D=t(63525),E=t(233),L=t(53630),N=t(46761),A=t(92098),B=t(42498),F=t(90109),O=t(99656);t(84105);var _=t(7982),T=t(61903),U=t(34386),R=t(47835),J=t(83759),M=t(51797),W=t(63821);function q(e){let{placeInfo:r,onLocationUpdated:t}=e,{user:n}=(0,A.a)(),[l,x]=(0,a.useState)(!1),[u,h]=(0,a.useState)(""),[j,y]=(0,a.useState)(""),[p,Z]=(0,a.useState)(""),[f,C]=(0,a.useState)(!1),[P,z]=(0,a.useState)(null),[D,E]=(0,a.useState)(!0),[L,N]=(0,a.useState)(!1),[B,F]=(0,a.useState)(!1);(0,a.useEffect)(()=>{O()},[r]);let O=async()=>{if(!r||!n){E(!1);return}try{E(!0);let e=r.address;Z(e||"");let t=await W.Z.getLocationDisplayName(n.uid,r);y(t),h(t)}catch(e){console.error("Error loading location name:",e),z("Failed to load location name. Please try again.")}finally{E(!1)}},q=async()=>{if(!u.trim()){z("Please enter a location name");return}C(!0),z(null);try{await W.Z.setLocationAlias(n.uid,p,u.trim()),y(u),x(!1),N(!0),t&&t()}catch(e){console.error("Error saving location name:",e),z("Failed to save location name. Please try again.")}finally{C(!1)}},X=async()=>{C(!0),z(null);try{await W.Z.removeLocationAlias(n.uid,p),y(p),h(p),x(!1),N(!0),t&&t()}catch(e){console.error("Error restoring location name:",e),z("Failed to restore original name. Please try again.")}finally{C(!1)}F(!1)};return D?(0,s.jsxs)(i.Z,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,s.jsx)(o.Z,{size:20,sx:{color:"var(--beer-amber)"}}),(0,s.jsx)(m.Z,{variant:"body2",color:"text.secondary",children:"Loading location..."})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.Z,{sx:{display:"flex",alignItems:"center",gap:1},children:l?(0,s.jsx)(_.d,{onClickAway:()=>!f&&x(!1),children:(0,s.jsxs)(i.Z,{sx:{display:"flex",alignItems:"center",gap:1,flex:1},children:[(0,s.jsx)(T.Z,{size:"small",value:u,onChange:e=>h(e.target.value),disabled:f,error:!!P,helperText:P,autoFocus:!0,fullWidth:!0,sx:{"& .MuiInputBase-root":{color:"var(--text-primary)",bgcolor:"rgba(255,255,255,0.05)"}}}),(0,s.jsx)(U.Z,{title:"Save",children:(0,s.jsx)(b.Z,{onClick:q,disabled:f||!u.trim(),size:"small",children:f?(0,s.jsx)(o.Z,{size:20,sx:{color:"var(--beer-amber)"}}):(0,s.jsx)(R.Z,{sx:{color:"var(--beer-amber)"}})})}),j!==p&&(0,s.jsx)(U.Z,{title:"Restore original",children:(0,s.jsx)(b.Z,{onClick:()=>F(!0),disabled:f,size:"small",children:(0,s.jsx)(J.Z,{})})})]})}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(m.Z,{variant:"body2",sx:{color:j===p?"text.secondary":"text.primary",fontStyle:j===p?"italic":"normal"},children:j||"Unknown Location"}),(0,s.jsx)(U.Z,{title:"Edit location name",children:(0,s.jsx)(b.Z,{onClick:()=>x(!0),size:"small",children:(0,s.jsx)(M.Z,{fontSize:"small"})})})]})}),(0,s.jsx)(w.Z,{open:L,autoHideDuration:3e3,onClose:()=>N(!1),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:(0,s.jsx)(c.Z,{onClose:()=>N(!1),severity:"success",sx:{width:"100%"},children:"Location name updated successfully"})}),(0,s.jsxs)(v.Z,{open:B,onClose:()=>F(!1),PaperProps:{sx:{bgcolor:"var(--background)",color:"var(--text-primary)",border:"1px solid var(--border-color)"}},children:[(0,s.jsx)(g.Z,{children:"Restore Original Name?"}),(0,s.jsx)(k.Z,{children:(0,s.jsx)(I.Z,{sx:{color:"var(--text-secondary)"},children:"This will remove your custom name and restore the original address. Are you sure?"})}),(0,s.jsxs)(S.Z,{children:[(0,s.jsx)(d.Z,{onClick:()=>F(!1),disabled:f,children:"Cancel"}),(0,s.jsx)(d.Z,{onClick:X,disabled:f,sx:{color:"var(--beer-amber)"},children:f?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.Z,{size:20,sx:{mr:1}}),"Restoring..."]}):"Restore"})]})]})]})}function X(){var e,r,t,_,T;let{user:U}=(0,A.a)(),{userId:R}=(0,n.useRouter)().query,[J,M]=(0,a.useState)({totalDrinks:0,uniqueBeers:0,favoriteBeer:null,totalOunces:0,friends:0}),[W,X]=(0,a.useState)(null),[H,Q]=(0,a.useState)([]),[G,K]=(0,a.useState)(!0),[V,Y]=(0,a.useState)(null),[$,ee]=(0,a.useState)(!1),[er,et]=(0,a.useState)(null),[es,ea]=(0,a.useState)(!1),[en,ei]=(0,a.useState)([]),[eo,el]=(0,a.useState)({profile:!0,stats:!0,recent:!0,calendar:!0}),[ec,ed]=(0,a.useState)(!1),[ex,eu]=(0,a.useState)(""),[em,eh]=(0,a.useState)({cities:new Set,states:new Set,countries:new Set}),[eb,ej]=(0,a.useState)(!1),ey=!R||R===(null==U?void 0:U.uid),ep=R||(null==U?void 0:U.uid);(0,a.useEffect)(()=>{ep&&(eZ(),eg())},[ep]);let eZ=async()=>{K(!0),Y(null);try{await Promise.all([ef(),eS(),ev()])}catch(e){console.error("Error fetching user data:",e),Y("Failed to load profile data. Please try again later.")}finally{K(!1)}},ef=async()=>{el(e=>({...e,profile:!0}));try{let e=(0,F.JU)(B.db,"users",ep),r=await (0,F.QT)(e);r.exists()?X(r.data()):Y("User profile not found.")}catch(e){throw console.error("Error fetching user profile:",e),e}finally{el(e=>({...e,profile:!1}))}},ev=async()=>{el(e=>({...e,recent:!0}));try{let e=(0,F.IO)((0,F.hJ)(B.db,"drinks"),(0,F.ar)("userId","==",ep),(0,F.Xo)("timestamp","desc"),(0,F.b9)(10)),r=(await (0,F.PL)(e)).docs.map(e=>{var r;return{id:e.id,...e.data(),timestamp:null===(r=e.data().timestamp)||void 0===r?void 0:r.toDate()}});Q(r)}catch(e){throw console.error("Error fetching recent drinks:",e),e}finally{el(e=>({...e,recent:!1}))}},eg=async()=>{el(e=>({...e,calendar:!0}));try{let e=(0,F.IO)((0,F.hJ)(B.db,"drinks"),(0,F.ar)("userId","==",ep),(0,F.Xo)("timestamp","desc")),r=(await (0,F.PL)(e)).docs.map(e=>{var r;return{id:e.id,...e.data(),timestamp:null===(r=e.data().timestamp)||void 0===r?void 0:r.toDate()}});ei(r)}catch(e){console.error("Error fetching all drinks:",e),Y("Failed to load drink history. Please try again later.")}finally{el(e=>({...e,calendar:!1}))}},ek=e=>{et(e),ee(!0)},eI=async()=>{if(er){ea(!0);try{await (0,F.oe)((0,F.JU)(B.db,"drinks",er.id)),Q(e=>e.filter(e=>e.id!==er.id)),ei(e=>e.filter(e=>e.id!==er.id)),eu("Drink deleted successfully"),ed(!0),await eS()}catch(e){console.error("Error deleting drink:",e),Y("Failed to delete drink. Please try again.")}finally{ea(!1),ee(!1),et(null)}}},eS=async()=>{el(e=>({...e,stats:!0}));try{var e;let r=(0,F.IO)((0,F.hJ)(B.db,"drinks"),(0,F.ar)("userId","==",ep)),t=(await (0,F.PL)(r)).docs.map(e=>e.data()),s=t.length,a=new Set(t.map(e=>e.brand)).size,n=t.reduce((e,r)=>e+(r.amount||0),0),i=t.reduce((e,r)=>(e[r.brand]=(e[r.brand]||0)+1,e),{}),o=null===(e=Object.entries(i).sort((e,r)=>{let[,t]=e,[,s]=r;return s-t})[0])||void 0===e?void 0:e[0],l=new Set,c=new Set,d=new Set;t.forEach(e=>{e.placeInfo&&(e.placeInfo.city&&l.add(e.placeInfo.city),e.placeInfo.state&&c.add(e.placeInfo.state),e.placeInfo.country&&d.add(e.placeInfo.country))}),eh({cities:Array.from(l).sort(),states:Array.from(c).sort(),countries:Array.from(d).sort()}),M({totalDrinks:s,uniqueBeers:a,favoriteBeer:o,totalOunces:n})}catch(e){throw console.error("Error fetching user stats:",e),e}finally{el(e=>({...e,stats:!1}))}};return G?(0,s.jsx)(i.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",bgcolor:"var(--background)"},children:(0,s.jsx)(o.Z,{sx:{color:"var(--beer-amber)"}})}):V?(0,s.jsx)(l.Z,{maxWidth:"lg",sx:{py:4},children:(0,s.jsx)(c.Z,{severity:"error",action:(0,s.jsx)(d.Z,{color:"inherit",size:"small",onClick:eZ,children:"Retry"}),sx:{mb:2},children:V})}):(0,s.jsxs)(l.Z,{maxWidth:"lg",sx:{py:4},children:[(0,s.jsxs)(x.Z,{sx:{mb:4,position:"relative"},children:[eo.profile&&(0,s.jsx)(i.Z,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,bgcolor:"rgba(0,0,0,0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1},children:(0,s.jsx)(o.Z,{sx:{color:"var(--beer-amber)"}})}),(0,s.jsxs)(i.Z,{sx:{p:3,textAlign:"center"},children:[(0,s.jsx)(u.Z,{sx:{width:120,height:120,mx:"auto",mb:2,bgcolor:"var(--beer-amber)",fontSize:"2.5rem"},children:(null==W?void 0:null===(r=W.username)||void 0===r?void 0:null===(e=r[0])||void 0===e?void 0:e.toUpperCase())||(null==W?void 0:null===(_=W.email)||void 0===_?void 0:null===(t=_[0])||void 0===t?void 0:t.toUpperCase())}),(0,s.jsx)(m.Z,{variant:"h4",gutterBottom:!0,children:(null==W?void 0:W.username)||"Anonymous Beer Lover"}),(0,s.jsxs)(m.Z,{variant:"body1",color:"textSecondary",children:["Member since ",(T=null==W?void 0:W.createdAt)?new Date(T).toLocaleDateString():"N/A"]})]})]}),(0,s.jsx)(h.ZP,{container:!0,spacing:3,sx:{mb:4},children:[{key:"totalDrinks",label:"Total Drinks"},{key:"uniqueBeers",label:"Unique Beers"},{key:"totalOunces",label:"Total Ounces"},{key:"favoriteBeer",label:"Favorite Beer",value:J.favoriteBeer||"None yet"}].map(e=>(0,s.jsx)(h.ZP,{item:!0,xs:12,sm:6,md:3,children:(0,s.jsxs)(x.Z,{sx:{position:"relative"},children:[eo.stats&&(0,s.jsx)(i.Z,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,bgcolor:"rgba(0,0,0,0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1},children:(0,s.jsx)(o.Z,{size:24,sx:{color:"var(--beer-amber)"}})}),(0,s.jsxs)(i.Z,{className:"stat-card",children:[(0,s.jsx)(C.Z,{sx:{fontSize:40,color:"var(--beer-amber)",mb:1}}),(0,s.jsx)(m.Z,{className:"stat-value",children:void 0!==e.value?e.value:J[e.key]}),(0,s.jsx)(m.Z,{className:"stat-label",children:e.label})]})]})},e.key))}),(0,s.jsxs)(x.Z,{sx:{mb:4,position:"relative"},children:[eo.stats&&(0,s.jsx)(i.Z,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,bgcolor:"rgba(0,0,0,0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1},children:(0,s.jsx)(o.Z,{sx:{color:"var(--beer-amber)"}})}),(0,s.jsxs)(i.Z,{className:"premium-card",sx:{p:4},children:[(0,s.jsxs)(i.Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:eb?2:0},children:[(0,s.jsx)(m.Z,{variant:"h6",color:"var(--beer-amber)",children:"Location Stats"}),(0,s.jsx)(b.Z,{onClick:()=>ej(!eb),sx:{transform:eb?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.3s",color:"var(--beer-amber)"},children:(0,s.jsx)(P.Z,{})})]}),(0,s.jsx)(h.ZP,{container:!0,spacing:3,sx:{mb:eb?3:0},children:[{key:"cities",label:"Cities",icon:z.Z,count:em.cities.length},{key:"states",label:"States",icon:D.Z,count:em.states.length},{key:"countries",label:"Countries",icon:E.Z,count:em.countries.length}].map(e=>(0,s.jsx)(h.ZP,{item:!0,xs:12,sm:4,children:(0,s.jsxs)(x.Z,{sx:{p:2,bgcolor:"var(--background-light)",border:"1px solid var(--border-color)",display:"flex",alignItems:"center",gap:2},children:[(0,s.jsx)(e.icon,{sx:{fontSize:40,color:"var(--beer-amber)"}}),(0,s.jsxs)(i.Z,{children:[(0,s.jsx)(m.Z,{variant:"h4",sx:{color:"var(--text-primary)",fontWeight:"bold"},children:e.count}),(0,s.jsx)(m.Z,{variant:"body2",sx:{color:"var(--text-secondary)"},children:e.label})]})]})},e.key))}),(0,s.jsx)(j.Z,{in:eb,children:(0,s.jsxs)(h.ZP,{container:!0,spacing:3,children:[(0,s.jsxs)(h.ZP,{item:!0,xs:12,sm:4,children:[(0,s.jsx)(m.Z,{variant:"subtitle1",color:"var(--beer-amber)",gutterBottom:!0,children:"Cities"}),(0,s.jsx)(y.Z,{dense:!0,children:em.cities.map(e=>(0,s.jsx)(p.ZP,{children:(0,s.jsx)(Z.Z,{primary:e,sx:{"& .MuiListItemText-primary":{color:"var(--text-primary)"}}})},e))})]}),(0,s.jsxs)(h.ZP,{item:!0,xs:12,sm:4,children:[(0,s.jsx)(m.Z,{variant:"subtitle1",color:"var(--beer-amber)",gutterBottom:!0,children:"States"}),(0,s.jsx)(y.Z,{dense:!0,children:em.states.map(e=>(0,s.jsx)(p.ZP,{children:(0,s.jsx)(Z.Z,{primary:e,sx:{"& .MuiListItemText-primary":{color:"var(--text-primary)"}}})},e))})]}),(0,s.jsxs)(h.ZP,{item:!0,xs:12,sm:4,children:[(0,s.jsx)(m.Z,{variant:"subtitle1",color:"var(--beer-amber)",gutterBottom:!0,children:"Countries"}),(0,s.jsx)(y.Z,{dense:!0,children:em.countries.map(e=>(0,s.jsx)(p.ZP,{children:(0,s.jsx)(Z.Z,{primary:e,sx:{"& .MuiListItemText-primary":{color:"var(--text-primary)"}}})},e))})]})]})})]})]}),(0,s.jsxs)(x.Z,{sx:{mb:4,position:"relative"},children:[eo.calendar&&(0,s.jsx)(i.Z,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,bgcolor:"rgba(0,0,0,0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1},children:(0,s.jsx)(o.Z,{sx:{color:"var(--beer-amber)"}})}),(0,s.jsxs)(i.Z,{className:"premium-card",sx:{p:4},children:[(0,s.jsx)(i.Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:(0,s.jsx)(m.Z,{variant:"h6",color:"var(--beer-amber)",children:"Drink Analytics"})}),(0,s.jsx)(O.Z,{drinks:H})]})]}),(0,s.jsxs)(x.Z,{sx:{mb:4,position:"relative"},children:[eo.recent&&(0,s.jsx)(i.Z,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,bgcolor:"rgba(0,0,0,0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1},children:(0,s.jsx)(o.Z,{sx:{color:"var(--beer-amber)"}})}),(0,s.jsxs)(i.Z,{className:"premium-card",sx:{p:4},children:[(0,s.jsx)(i.Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:(0,s.jsx)(m.Z,{variant:"h6",color:"var(--beer-amber)",children:"Recent Activity"})}),H.length>0?(0,s.jsx)(y.Z,{sx:{p:0},children:H.map((e,r)=>(0,s.jsxs)(a.Fragment,{children:[(0,s.jsx)(p.ZP,{alignItems:"flex-start",sx:{flexDirection:"column"},children:(0,s.jsxs)(i.Z,{sx:{display:"flex",width:"100%",justifyContent:"space-between",alignItems:"flex-start"},children:[(0,s.jsxs)(i.Z,{children:[(0,s.jsx)(m.Z,{color:"var(--text-primary)",sx:{fontWeight:"bold"},children:e.brand||"Unknown Brand"}),(0,s.jsx)(m.Z,{variant:"body2",color:"var(--text-secondary)",children:new Date(e.timestamp).toLocaleString()}),e.placeInfo&&(0,s.jsxs)(i.Z,{sx:{display:"flex",alignItems:"center",mt:.5},children:[(0,s.jsx)(L.Z,{sx:{fontSize:"0.9rem",color:"var(--text-secondary)",mr:.5}}),ey?(0,s.jsx)(q,{placeInfo:e.placeInfo,onLocationUpdated:()=>{ev(),eg()}}):(0,s.jsx)(m.Z,{variant:"body2",color:"var(--text-secondary)",children:e.placeInfo.neighborhood?"".concat(e.placeInfo.neighborhood,", ").concat(e.placeInfo.city):e.placeInfo.address||"Unknown Location"})]})]}),ey&&(0,s.jsx)(b.Z,{edge:"end","aria-label":"delete",onClick:()=>ek(e),sx:{color:"var(--text-secondary)"},children:(0,s.jsx)(N.Z,{})})]})}),r<H.length-1&&(0,s.jsx)(f.Z,{component:"li",sx:{bgcolor:"var(--border-color)"}})]},e.id))}):(0,s.jsx)(m.Z,{color:"var(--text-secondary)",sx:{fontStyle:"italic"},children:"No beers logged yet. Start logging your beer journey!"})]})]}),(0,s.jsxs)(v.Z,{open:$,onClose:()=>ee(!1),PaperProps:{sx:{bgcolor:"var(--background)",color:"var(--text-primary)",border:"1px solid var(--border-color)"}},children:[(0,s.jsx)(g.Z,{children:"Delete Drink?"}),(0,s.jsx)(k.Z,{children:(0,s.jsx)(I.Z,{sx:{color:"var(--text-secondary)"},children:"Are you sure you want to delete this drink? This action cannot be undone."})}),(0,s.jsxs)(S.Z,{children:[(0,s.jsx)(d.Z,{onClick:()=>ee(!1),disabled:es,children:"Cancel"}),(0,s.jsx)(d.Z,{onClick:eI,disabled:es,color:"error",children:es?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.Z,{size:20,sx:{mr:1}}),"Deleting..."]}):"Delete"})]})]}),(0,s.jsx)(w.Z,{open:ec,autoHideDuration:3e3,onClose:()=>ed(!1),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:(0,s.jsx)(c.Z,{onClose:()=>ed(!1),severity:"success",sx:{width:"100%"},children:ex})})]})}},20067:function(){},72061:function(){}},function(e){e.O(0,[196,251,903,354,969,294,886,279,386,156,725,656,821,774,888,179],function(){return e(e.s=19344)}),_N_E=e.O()}]);