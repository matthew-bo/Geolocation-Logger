(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[186],{54367:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/share/stats",function(){return a(32377)}])},32377:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return A}});var l=a(85893),n=a(67294),i=a(11163),s=a(65582),r=a(15861),c=a(5616),o=a(29009),d=a(28935),u=a(14195),h=a(3023),x=a(75358),j=a(26050),Z=a(33558),y=a(18242),v=a(66242),p=a(44267),f=a(51233),m=a(34386),b=a(93946),g=a(591),w=a(47120),S=a(61903),C=a(18972),k=a(69417),M=a(46901),D=a(98456),E=a(64666),_=a(37645),R=a(6514),L=a(31425),N=a(52649),P=a(49718),U=a(75108),O=a(22400),T=a(17389),B=a(7069),I=a(54559),W=a(23855),q=a(32912),F=a(92098),J=a(99656);let K=[{value:"day",label:"Daily"},{value:"week",label:"Weekly"},{value:"month",label:"Monthly"}],V=[{value:"7d",label:"Past Week",fn:e=>(0,B.Z)(e,7)},{value:"1m",label:"Past Month",fn:e=>(0,I.Z)(e,1)},{value:"3m",label:"Past 3 Months",fn:e=>(0,I.Z)(e,3)},{value:"1y",label:"Past Year",fn:e=>(0,I.Z)(e,12)}],X=[{value:"total",label:"Total Beers",color:"#8884d8"},{value:"unique",label:"Unique Beers",color:"#82ca9d"},{value:"rating",label:"Average Rating",color:"#ffc658"}];function z(e){let{initialView:t,initialTimeUnit:a,initialStartDate:i,initialEndDate:s,initialMetrics:I,initialLocation:z,isShared:A=!1}=e,{user:Y}=(0,F.a)(),[$,G]=(0,n.useState)(t||"bar"),[H,Q]=(0,n.useState)(a||"day"),[ee,et]=(0,n.useState)(()=>i?(0,W.Z)(i):(0,B.Z)(new Date,7)),[ea,el]=(0,n.useState)(()=>s?(0,W.Z)(s):new Date),[en,ei]=(0,n.useState)(I||["total"]),[es,er]=(0,n.useState)(z||null),[ec,eo]=(0,n.useState)(!1),[ed,eu]=(0,n.useState)(""),[eh,ex]=(0,n.useState)(!0),[ej,eZ]=(0,n.useState)(null),[ey,ev]=(0,n.useState)([]),ep=(0,n.useCallback)(async()=>{try{ex(!0),eZ(null);let e=new URLSearchParams({startDate:(0,q.Z)(ee,"yyyy-MM-dd"),endDate:(0,q.Z)(ea,"yyyy-MM-dd"),timeUnit:H});es&&e.append("location",JSON.stringify(es));let t=await fetch("/api/stats?".concat(e.toString()));if(!t.ok)throw Error("Failed to fetch statistics");let a=await t.json();ev(a)}catch(e){eZ(e.message),console.error("Error fetching stats:",e)}finally{ex(!1)}},[ee,ea,H,es]);(0,n.useEffect)(()=>{ep()},[ep]);let ef=e=>{let t=new Date;et(e.fn(t)),el(t)},em=(0,n.useCallback)(()=>{let e=new URLSearchParams({view:$,timeUnit:H,start:(0,q.Z)(ee,"yyyy-MM-dd"),end:(0,q.Z)(ea,"yyyy-MM-dd"),metrics:en.join(",")});es&&e.append("location",JSON.stringify(es)),eu("".concat(window.location.origin,"/share/stats?").concat(e.toString())),eo(!0)},[$,H,ee,ea,en,es]),eb=(0,n.useCallback)(()=>{let e=ey.map(e=>{let t=[e.date];return en.forEach(a=>t.push(e[a])),t.join(",")}).join("\n"),t=["date",...en].join(","),a=new Blob([t+"\n"+e],{type:"text/csv"}),l=window.URL.createObjectURL(a),n=document.createElement("a");n.href=l,n.download="drink-stats-".concat((0,q.Z)(new Date,"yyyy-MM-dd"),".csv"),document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(l)},[ey,en]);return(0,l.jsxs)(v.Z,{children:[(0,l.jsx)(p.Z,{children:(0,l.jsxs)(f.Z,{spacing:3,children:[(0,l.jsxs)(c.Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,l.jsx)(r.Z,{variant:"h5",children:"Drink Statistics"}),!A&&(0,l.jsxs)(f.Z,{direction:"row",spacing:1,children:[(0,l.jsx)(m.Z,{title:"Share",children:(0,l.jsx)(b.Z,{onClick:em,children:(0,l.jsx)(N.Z,{})})}),(0,l.jsx)(m.Z,{title:"Export CSV",children:(0,l.jsx)(b.Z,{onClick:eb,children:(0,l.jsx)(P.Z,{})})})]})]}),(0,l.jsxs)(f.Z,{direction:{xs:"column",sm:"row"},spacing:2,children:[(0,l.jsxs)(g.Z,{value:$,exclusive:!0,onChange:(e,t)=>t&&G(t),children:[(0,l.jsx)(w.Z,{value:"bar",children:(0,l.jsx)(U.Z,{})}),(0,l.jsx)(w.Z,{value:"heatmap",children:(0,l.jsx)(O.Z,{})})]}),(0,l.jsx)(g.Z,{value:en,onChange:(e,t)=>{t.length&&ei(t)},"aria-label":"metrics",multiple:!0,children:X.map(e=>(0,l.jsx)(w.Z,{value:e.value,children:e.label},e.value))}),(0,l.jsx)(S.Z,{select:!0,label:"Time Unit",value:H,onChange:e=>Q(e.target.value),sx:{minWidth:120},children:K.map(e=>(0,l.jsx)(C.Z,{value:e.value,children:e.label},e.value))})]}),(0,l.jsxs)(f.Z,{direction:{xs:"column",sm:"row"},spacing:2,children:[(0,l.jsx)(T.M,{label:"Start Date",value:ee,onChange:et,renderInput:e=>(0,l.jsx)(S.Z,{...e})}),(0,l.jsx)(T.M,{label:"End Date",value:ea,onChange:el,renderInput:e=>(0,l.jsx)(S.Z,{...e})}),(0,l.jsx)(f.Z,{direction:"row",spacing:1,children:V.map(e=>(0,l.jsx)(k.Z,{variant:"outlined",size:"small",onClick:()=>ef(e),children:e.label},e.value))})]}),(0,l.jsxs)(S.Z,{label:"Location Filter",select:!0,value:(null==es?void 0:es.type)||"",onChange:e=>{e.target.value?er({type:e.target.value,value:""}):er(null)},children:[(0,l.jsx)(C.Z,{value:"",children:"None"}),(0,l.jsx)(C.Z,{value:"city",children:"City"}),(0,l.jsx)(C.Z,{value:"state",children:"State"}),(0,l.jsx)(C.Z,{value:"country",children:"Country"})]}),es&&(0,l.jsx)(S.Z,{label:"Select ".concat(es.type),value:es.value,onChange:e=>er({...es,value:e.target.value})}),ej&&(0,l.jsx)(M.Z,{severity:"error",onClose:()=>eZ(null),children:ej}),eh?(0,l.jsx)(c.Z,{sx:{display:"flex",justifyContent:"center",p:3},children:(0,l.jsx)(D.Z,{})}):(0,l.jsx)(l.Fragment,{children:"bar"===$?(0,l.jsx)(o.h,{width:"100%",height:400,children:(0,l.jsxs)(d.v,{data:ey,children:[(0,l.jsx)(u.q,{strokeDasharray:"3 3"}),(0,l.jsx)(h.K,{dataKey:"date",tickFormatter:e=>(0,q.Z)((0,W.Z)(e),"MMM d")}),(0,l.jsx)(x.B,{}),(0,l.jsx)(j.u,{content:e=>{let{active:t,payload:a,label:n}=e;return t&&a&&a.length?(0,l.jsx)(v.Z,{children:(0,l.jsxs)(p.Z,{children:[(0,l.jsx)(r.Z,{variant:"subtitle2",children:(0,q.Z)((0,W.Z)(n),"MMM d, yyyy")}),a.map(e=>(0,l.jsxs)(r.Z,{variant:"body2",children:[e.name,": ",e.value]},e.name))]})}):null}}),(0,l.jsx)(Z.D,{}),en.map(e=>{let t=X.find(t=>t.value===e);return(0,l.jsx)(y.$,{dataKey:e,name:t.label,fill:t.color},e)})]})}):(0,l.jsx)(c.Z,{sx:{height:{xs:300,sm:350},width:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,l.jsx)(J.Z,{drinks:ey})})})]})}),!A&&(0,l.jsxs)(E.Z,{open:ec,onClose:()=>eo(!1),children:[(0,l.jsx)(_.Z,{children:"Share Statistics"}),(0,l.jsx)(R.Z,{children:(0,l.jsx)(S.Z,{fullWidth:!0,value:ed,InputProps:{readOnly:!0},margin:"normal"})}),(0,l.jsxs)(L.Z,{children:[(0,l.jsx)(k.Z,{onClick:()=>eo(!1),children:"Close"}),(0,l.jsx)(k.Z,{variant:"contained",onClick:()=>{navigator.clipboard.writeText(ed),eo(!1)},children:"Copy Link"})]})]})]})}function A(){let e=(0,i.useRouter)(),{view:t,timeUnit:a,start:o,end:d,metrics:u,location:h}=e.query;return((0,n.useEffect)(()=>{if(e.isReady){if(!o||!d||!u){e.push("/404");return}try{(0,W.Z)(o),(0,W.Z)(d)}catch(t){e.push("/404")}}},[e,o,d,u]),e.isReady)?(0,l.jsxs)(s.Z,{maxWidth:"lg",sx:{py:4},children:[(0,l.jsx)(r.Z,{variant:"h4",gutterBottom:!0,children:"Shared Drink Statistics"}),(0,l.jsx)(c.Z,{sx:{mt:3},children:(0,l.jsx)(z,{initialView:t||"bar",initialTimeUnit:a||"day",initialStartDate:o,initialEndDate:d,initialMetrics:u.split(","),initialLocation:h?JSON.parse(h):null,isShared:!0})})]}):null}}},function(e){e.O(0,[196,903,354,969,294,886,869,279,386,156,842,8,656,774,888,179],function(){return e(e.s=54367)}),_N_E=e.O()}]);